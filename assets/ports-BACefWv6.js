import{H as D,F as o,a2 as te,I as B,a5 as ne,G,M as $,X as F,a3 as y,$ as e,D as W,T as ae}from"./DarkTheme-DoxdKMtD.js";const k={analyticsChanges:{}};k.initialize=function(v){const _=this,L=[{name:"MSP",groups:["configuration","msp"],maxPorts:2},{name:"GPS",groups:["sensors"],maxPorts:1,dependsOn:"USE_GPS"},{name:"TELEMETRY_FRSKY",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1,dependsOn:"USE_TELEMETRY_FRSKY_HUB"},{name:"TELEMETRY_HOTT",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1,dependsOn:"USE_TELEMETRY_HOTT"},{name:"TELEMETRY_SMARTPORT",groups:["telemetry"],maxPorts:1,dependsOn:"USE_TELEMETRY_SMARTPORT"},{name:"RX_SERIAL",groups:["rx"],maxPorts:1},{name:"BLACKBOX",groups:["peripherals"],sharableWith:["msp"],notSharableWith:["telemetry"],maxPorts:1},{name:"TELEMETRY_LTM",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1,dependsOn:"USE_TELEMETRY_LTM"},{name:"TELEMETRY_MAVLINK",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1,dependsOn:"USE_TELEMETRY_MAVLINK"},{name:"IRC_TRAMP",groups:["peripherals"],maxPorts:1,dependsOn:"USE_VTX"},{name:"ESC_SENSOR",groups:["sensors"],maxPorts:1},{name:"TBS_SMARTAUDIO",groups:["peripherals"],maxPorts:1,dependsOn:"USE_VTX"},{name:"TELEMETRY_IBUS",groups:["telemetry"],maxPorts:1,dependsOn:"USE_TELEMETRY_IBUS_EXTENDED"},{name:"RUNCAM_DEVICE_CONTROL",groups:["peripherals"],maxPorts:1,dependsOn:"USE_CAMERA_CONTROL"},{name:"LIDAR_TF",groups:["peripherals"],maxPorts:1},{name:"FRSKY_OSD",groups:["peripherals"],maxPorts:1,dependsOn:"USE_FRSKYOSD"}];D.gte(o.CONFIG.apiVersion,te)&&L.push({name:"VTX_MSP",groups:["peripherals"],sharableWith:["msp"],maxPorts:1});for(const p of L)p.displayName=B.getMessage(`portsFunction_${p.name}`);let K=["9600","19200","38400","57600","115200","230400","250000","500000","1000000"];const V=["AUTO","9600","19200","38400","57600","115200"],H=["AUTO","9600","19200","38400","57600","115200"],w=["AUTO","19200","38400","57600","115200","230400","250000","1500000","2000000","2470000"];D.gte(o.CONFIG.apiVersion,ne)&&V.push("230400");const X=["configuration","peripherals","sensors","telemetry","rx"];G.active_tab="ports",z();function z(){$.promise(F.MSP_VTX_CONFIG).then(function(){y.loadSerialConfig(p)});function p(){e("#content").load("./tabs/ports.html",q)}}function j(){_.analyticsChanges={},e(".tab-ports").addClass("supported");const p=20,A={0:"UART1",1:"UART2",2:"UART3",3:"UART4",4:"UART5",5:"UART6",6:"UART7",7:"UART8",8:"UART9",9:"UART10",20:"USB VCP",30:"SOFTSERIAL1",31:"SOFTSERIAL2",40:"LPUART1",50:"UART0",51:"UART1",52:"UART2",53:"UART3",54:"UART4",55:"UART5",56:"UART6",57:"UART7",58:"UART8",59:"UART9",60:"UART10"};let m=e("select.gps_baudrate");for(const t of V)m.append(`<option value="${t}">${t}</option>`);let E=e("select.msp_baudrate");for(const t of K)E.append(`<option value="${t}">${t}</option>`);let T=e("select.telemetry_baudrate");for(const t of H)T.append(`<option value="${t}">${t}</option>`);let l=e("select.blackbox_baudrate");for(const t of w)l.append(`<option value="${t}">${t}</option>`);let x,C;const I=e(".tab-ports .ports"),a=e("#tab-ports-templates .portIdentifier"),U=e("#tab-ports-templates .portConfiguration");for(let t=0;t<o.SERIAL_CONFIG.ports.length;t++){const c=a.clone(),s=U.clone(),n=o.SERIAL_CONFIG.ports[t];s.data("serialPort",n),E=s.find("select.msp_baudrate"),E.val(n.msp_baudrate),T=s.find("select.telemetry_baudrate"),T.val(n.telemetry_baudrate);let r;n.functions.indexOf("GPS")>=0?r=n.gps_baudrate:r="AUTO",m=s.find("select.gps_baudrate"),m.val(r);let h;n.functions.indexOf("BLACKBOX")>=0?h=n.blackbox_baudrate:h="AUTO",l=s.find("select.blackbox_baudrate"),l.val(h),c.find(".identifier").text(A[n.identifier]),s.find(".identifier").text(A[n.identifier]),s.data("index",t),s.data("port",n);for(let R=0;R<X.length;R++){const d=X[R],O=e(s).find(`.functionsCell-${d}`);for(let N=0;N<L.length;N++){const P=L[N],i=P.name;if(P.groups.indexOf(d)===-1)continue;let u;if(d!=="telemetry"&&d!=="sensors"&&d!=="peripherals"){const f=`functionCheckbox-${t}-${R}-${N}`;let M='<span class="function"><input type="checkbox" class="togglemedium" id=';if(M+=`"${f}" value="${i}" /><label for="${f}"></label></span>`,O.prepend(M),n.functions.indexOf(i)>=0&&O.find(`#${f}`).prop("checked",!0),n.identifier===p&&i==="MSP"){const g=O.find(`#${f}`);g.prop("checked",!0),g.prop("disabled",!0)}}else{const f=`function-${d}`,M=`select[name=${f}]`;u=O.find(M);const g=B.getMessage("portsTelemetryDisabled");u.length===0&&(O.prepend(`<span class="function"><select name="${f}" /></span>`),u=O.find(M),u.append(`<option value="">${g}</option>`));const Q=o.CONFIG.buildOptions.length&&P.dependsOn!==void 0&&!o.CONFIG.buildOptions.includes(P.dependsOn)?"disabled":"";if(u.append(`<option value="${i}" ${Q}>${P.displayName}</option>`),u.sortSelect(g),n.functions.indexOf(i)>=0&&(u.val(i),d==="peripherals"&&(i==="TBS_SMARTAUDIO"||i==="IRC_TRAMP")&&(x=i),d==="peripherals"&&i.includes("MSP")&&(C=i)),d==="telemetry"){const Z=i;u.on("change",function(){const ee=e(this).val();let Y;ee!==Z&&(Y=e(this).find("option:selected").text()),_.analyticsChanges.Telemetry=Y})}}}}I.find("tbody").append(c),I.find("tbody").append(s)}const b=o.VTX_CONFIG.vtx_table_available&&(o.VTX_CONFIG.vtx_table_bands===0||o.VTX_CONFIG.vtx_table_channels===0||o.VTX_CONFIG.vtx_table_powerlevels===0),S=e('select[name="function-peripherals"]');S.on("change",function(){let t,c;S.each(function(s,n){const r=e(n).val();(r==="TBS_SMARTAUDIO"||r==="IRC_TRAMP")&&(t=r),r.includes("MSP")&&(c=r,e(".tab-ports .portConfiguration").each(function(h,R){e(R).find("select[name=function-peripherals]").val().includes("MSP")&&s===h&&e(`#functionCheckbox-${h}-0-0`).prop("checked",!0).trigger("change")}))}),x!==t&&(_.analyticsChanges.VtxControl=t,x=t),C!==c&&(_.analyticsChanges.MspControl=c,C=c),e(".vtxTableNotSet").toggle(t&&b)}),S.trigger("change")}function q(){B.localizePage(),j(),e("a.save").on("click",J),G.interval_add("status_pull",function(){$.send_message(F.MSP_STATUS)},250,!0),G.content_ready(v)}function J(){W.sendSaveAndChangeEvents(W.EVENT_CATEGORIES.FLIGHT_CONTROLLER,_.analyticsChanges,"ports"),_.analyticsChanges={},o.SERIAL_CONFIG.ports=[],e(".tab-ports .portConfiguration").each(function(I,a){const U=e(a).data("serialPort"),b=e(a).find("input:checkbox:checked").map(function(){return this.value}).get(),S=e(a).find("select[name=function-telemetry]").val();S&&b.push(S);const t=e(a).find("select[name=function-sensors]").val();t&&b.push(t);const c=e(a).find("select[name=function-peripherals]").val();c&&b.push(c);let s=e(a).find(".gps_baudrate").val();s==="AUTO"&&(s="57600");let n=e(a).find(".blackbox_baudrate").val();n==="AUTO"&&(n="115200");const r={functions:b,msp_baudrate:e(a).find(".msp_baudrate").val(),telemetry_baudrate:e(a).find(".telemetry_baudrate").val(),gps_baudrate:s,blackbox_baudrate:n,identifier:U.identifier};o.SERIAL_CONFIG.ports.push(r)});let p=!1,A=!1,m=!1,E=!1,T=!1;for(const I of o.SERIAL_CONFIG.ports){const a=I.functions;a.includes("RX_SERIAL")&&(p=!0),a.some(U=>U.startsWith("TELEMETRY"))&&(A=!0),a.includes("BLACKBOX")&&(m=!0),a.includes("ESC_SENSOR")&&(E=!0),a.includes("GPS")&&(T=!0)}const l=o.FEATURE_CONFIG.features;p?l.enable("RX_SERIAL"):l.disable("RX_SERIAL"),A&&l.enable("TELEMETRY"),m?l.enable("BLACKBOX"):l.disable("BLACKBOX"),E?l.enable("ESC_SENSOR"):l.disable("ESC_SENSOR"),T?l.enable("GPS"):l.disable("GPS"),y.sendSerialConfig(x);function x(){$.send_message(F.MSP_SET_FEATURE_CONFIG,y.crunch(F.MSP_SET_FEATURE_CONFIG),!1,C)}function C(){y.writeConfiguration(!0)}}};k.cleanup=function(v){v&&v()};ae.ports=k;export{k as ports};
