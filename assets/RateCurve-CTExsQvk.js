import{F as u}from"./DarkTheme-x8aAi6Mp.js";const d=1e3,C=1500,w=2e3,g=function(o){this.useLegacyCurve=o,this.maxAngularVel=null,this.constrain=function(e,s,t){return Math.max(s,Math.min(e,t))},this.rcCommand=function(e,s,t){let i=Math.min(Math.max(Math.abs(e-C)-t,0),500)*s;return e<C&&(i=-i),i},this.drawRateCurve=function(e,s,t,a,i,r,n,_,l,c){const T=c/(2*n),R=_.lineWidth;_.save(),_.translate(l/2,c/2),_.beginPath();let h=d;for(_.moveTo(-500,-T*this.rcCommandRawToDegreesPerSecond(h,e,s,t,a,i,r)),h=h+R;h<=w;)_.lineTo(h-C,-T*this.rcCommandRawToDegreesPerSecond(h,e,s,t,a,i,r)),h=h+R;_.stroke(),_.restore()},this.drawLegacyRateCurve=function(e,s,t,a,i,r){let n=r*s;n=n+1/(1-n/r*e),a.beginPath(),a.moveTo(0,r),a.quadraticCurveTo(i*11/20,r-n/2*(1-t),i,r-n),a.stroke()},this.drawStickPosition=function(e,s,t,a,i,r,n,_,l,c){const R=l.canvas.height/2/_,h=this.rcCommandRawToDegreesPerSecond(e,s,t,a,i,r,n);return e!=null&&(l.save(),l.fillStyle=c||"#000000",l.translate(l.canvas.width/2,l.canvas.height/2),l.beginPath(),l.arc(e-1500,-R*h,l.canvas.height/60,0,2*Math.PI),l.fill(),l.restore()),Math.abs(h)<.5?0:h.toFixed(0)},this.getOvobotRates=function(e,s,t,a,i,r,n){let _;a>2&&(a=a+(a-2)*14.54);let l,c;if(l=3,c=200,i>0&&(e=e*Math.pow(s,l)*i+e*(1-i)),r){const T=1/this.constrain(1-s*t,.01,1);_=c*a*e,_=_*T}else _=(t*100+27)*e/16/4.1;return _=this.constrain(_,-1*n,n),_},this.getRaceflightRates=function(e,s,t,a){let i=(1+.01*a*(e*e-1))*e;return i=i*(t+Math.abs(i)*t*s*.01),i},this.getKISSRates=function(e,s,t,a,i){const r=1-s*t,n=e*e;return e=(e*n*i+e*(1-i))*(a/10),2e3*(1/r)*e},this.getActualRates=function(e,s,t,a,i){let r;const n=s*(Math.pow(e,5)*i+e*(1-i));return r=Math.max(0,t-a),r=e*a+r*n,r},this.getQuickRates=function(e,s,t,a,i){a=a*200,t=Math.max(t,a);let r;const n=(t/a-1)/(t/a);return r=1/(1-(Math.pow(s,3)*i+s*(1-i))*n),r=e*a*r,r},this.getCurrentRates=function(){const e={roll_rate:u.RC_TUNING.roll_rate,pitch_rate:u.RC_TUNING.pitch_rate,yaw_rate:u.RC_TUNING.yaw_rate,rc_rate:u.RC_TUNING.RC_RATE,rc_rate_yaw:u.RC_TUNING.rcYawRate,rc_expo:u.RC_TUNING.RC_EXPO,rc_yaw_expo:u.RC_TUNING.RC_YAW_EXPO,rc_rate_pitch:u.RC_TUNING.rcPitchRate,rc_pitch_expo:u.RC_TUNING.RC_PITCH_EXPO,superexpo:u.FEATURE_CONFIG.features.isEnabled("SUPEREXPO_RATES"),deadband:u.RC_DEADBAND_CONFIG.deadband,yawDeadband:u.RC_DEADBAND_CONFIG.yaw_deadband,roll_rate_limit:u.RC_TUNING.roll_rate_limit,pitch_rate_limit:u.RC_TUNING.pitch_rate_limit,yaw_rate_limit:u.RC_TUNING.yaw_rate_limit};switch(e.superexpo=!0,u.RC_TUNING.rates_type){case u.RATES_TYPE.RACEFLIGHT:e.roll_rate*=100,e.pitch_rate*=100,e.yaw_rate*=100,e.rc_rate*=1e3,e.rc_rate_yaw*=1e3,e.rc_rate_pitch*=1e3,e.rc_expo*=100,e.rc_yaw_expo*=100,e.rc_pitch_expo*=100;break;case u.RATES_TYPE.ACTUAL:e.roll_rate*=1e3,e.pitch_rate*=1e3,e.yaw_rate*=1e3,e.rc_rate*=1e3,e.rc_rate_yaw*=1e3,e.rc_rate_pitch*=1e3;break;case u.RATES_TYPE.QUICKRATES:e.roll_rate*=1e3,e.pitch_rate*=1e3,e.yaw_rate*=1e3;break}return e}};g.prototype.rcCommandRawToDegreesPerSecond=function(o,e,s,t,a,i,r){let n;if(e!==void 0&&s!==void 0&&t!==void 0){let _=this.rcCommand(o,1,i);_/=500-i;const l=Math.abs(_);switch(u.RC_TUNING.rates_type){case u.RATES_TYPE.RACEFLIGHT:n=this.getRaceflightRates(_,e,s,t);break;case u.RATES_TYPE.KISS:n=this.getKISSRates(_,l,e,s,t);break;case u.RATES_TYPE.ACTUAL:n=this.getActualRates(_,l,e,s,t);break;case u.RATES_TYPE.QUICKRATES:n=this.getQuickRates(_,l,e,s,t);break;default:n=this.getOvobotRates(_,l,e,s,t,a,r);break}}return n};g.prototype.getMaxAngularVel=function(o,e,s,t,a,i){let r;return this.useLegacyCurve||(r=this.rcCommandRawToDegreesPerSecond(w,o,e,s,t,a,i)),r};g.prototype.setMaxAngularVel=function(o){return this.maxAngularVel=Math.ceil(o/200)*200,this.maxAngularVel};g.prototype.draw=function(o,e,s,t,a,i,r,n){if(o!==void 0&&e!==void 0&&s!==void 0){const _=n.canvas.height,l=n.canvas.width;this.useLegacyCurve?this.drawLegacyRateCurve(o,e,s,n,l,_):this.drawRateCurve(o,e,s,t,a,i,r,n,l,_)}};export{g as R};
