import{G as o,T as Me,I as $e,aa as Ge,M as d,X as f,F as a,ab as Re,g as de}from"./DarkTheme-DoxdKMtD.js";const H={};H.initialize=function(E){o.active_tab!="auto_test"&&(o.active_tab="auto_test");function fe(){ue()}function ue(){$("#content").load("./tabs/auto_test.html",re)}fe();function re(){$e.localizePage();const J=$("#auto-test-button"),v=$("#model-gyro-status"),N=$("#model-adpter-status"),h=$("#model-fan-status"),S=$("#model-motor-status"),r=$("#model-cliff-status"),A=$(".test-result-empty"),c=$(".test-under-testing"),g=$(".test-result-passed"),C=$(".test-result-failed"),ce=$(".yes-spray-btn"),_e=$(".no-spary-btn"),me=$(".yes-voice-btn"),pe=$(".no-voice-btn"),_=$("#model-waterpump-status"),m=$("#model-voice-status");let u=[],t=[0,0,0,0,0,0,0],p=new Array(2),y=new Array(2),L=[],D=[],F=[],P=[],I=[],U=[],w=!1,x=!1,n,R=!0,V=!1,j=0;const X=$(".dialogConfirmUnderingTest-Spary")[0],Z=$(".dialogConfirmUnderingTest-Voice")[0];let K,Q;function ee(){let e;$("dialog").filter(function(){if($(this).prop("open"))return e=$(this),$(this).prop("open")}).length>0&&(K=$("#"+e.find("div.buttons").attr("id")+" a.yes"),Q=$("#"+e.find("div.buttons").attr("id")+" a.no"),$(document).keydown(function(l){(l.key==="Y"||l.key==="y")&&K.trigger("click")}),$(document).keydown(function(l){(l.key==="N"||l.key==="n")&&Q.trigger("click")}))}J.on("click",function(){if(!$(this).hasClass("no-click")){$(this).find("a").addClass("no-click"),Ce(),c.removeClass("model-display"),z(),o.interval_add("setup_auto_test_gyro_fast",ie,50,!0),o.interval_add("setup_auto_test_cliff_fast",q,50,!0),o.interval_add("setup_auto_test_fast",ye,50,!0);let e=setTimeout(()=>{o.interval_remove("setup_auto_test_gyro_fast"),V=!0,Oe()},1e3);u.push(e),M()}}),$(".retest-btn a").on("click",function(){$(this).hasClass("no-click")||(n=$(this).closest(".grid-row-content").attr("id"),Ge.isEmptyObject(n)==!1&&n!=null&&(n.indexOf("gyro")!==-1?(s(v,0),t[3]=0,L=[],D=[],F=[],P=[],I=[],U=[],o.interval_add("setup_auto_test_gyro_fast",ie,50,!0),setTimeout(function(){o.interval_remove("setup_auto_test_gyro_fast"),V=!0},1e3)):n.indexOf("adpter")!==-1?(t[0]=0,s(N,0),te()):n.indexOf("fan")!==-1?(t[1]=0,s(h,0),se()):n.indexOf("motor")!==-1?(t[2]=0,s(S,0),ae()):n.indexOf("cliff")!==-1?(t[5]=0,p=[],y=[],s(r,0),o.interval_add("setup_auto_test_cliff_fast",q,50,!0),setTimeout(function(){o.interval_remove("setup_auto_test_cliff_fast"),V=!0},1e3)):n.indexOf("waterpump")!==-1?(t[4]=0,s(_,0),R=!1,z(),le()):n.indexOf("voice")!==-1&&(t[6]=0,s(m,0),R=!1,z(),W()),M(n)))}),ce.on("click",function(){t[4]=2,s(_,2),X.close(),R&&W(),M(n)}),_e.on("click",function(){t[4]=3,s(_,3),X.close(),R&&W(),M(n)}),me.on("click",function(){t[6]=2,s(m,2),Z.close(),M(n)}),pe.on("click",function(){t[6]=3,s(m,3),Z.close(),M(n)});function ye(){te(),q()}function Oe(){le(),se(),ae()}Ae();function Ae(){d.send_message(f.MSP_GET_AUTO_TEST_RESULT,!1,!1,function(){a.OVOBOT_FUNCTION.autoTestResult==0?(A.removeClass("model-display"),c.addClass("model-display"),g.addClass("model-display"),C.addClass("model-display")):a.OVOBOT_FUNCTION.autoTestResult==2?(A.addClass("model-display"),c.addClass("model-display"),g.removeClass("model-display"),C.addClass("model-display")):a.OVOBOT_FUNCTION.autoTestResult==3&&(A.addClass("model-display"),c.addClass("model-display"),g.addClass("model-display"),C.removeClass("model-display"))})}function ge(e){d.send_message(f.MSP_SET_AUTO_TEST_RESULT,[e],!1,function(){})}function Ce(){Ne(),t=[0,0,0,0,0,0,0],L=[],D=[],F=[],P=[],I=[],U=[],n=void 0,p=[],y=[],w=!1,x=!1,R=!0,s(v,0),s(N,0),s(h,0),s(S,0),s(r,0),s(_,0),s(m,0),A.removeClass("model-display"),c.addClass("model-display"),g.addClass("model-display"),C.addClass("model-display")}function M(e){let i=setTimeout(()=>{V&&(e==v.attr("id")||e==null)&&(t[3]==2?s(v,2):t[3]==3&&s(v,3))},1010);u.push(i);let l=setTimeout(()=>{if((e==N.attr("id")||e==null)&&(t[0]==2?s(N,2):t[0]==3&&s(N,3)),(e==h.attr("id")||e==null)&&(t[1]==2?s(h,2):t[1]==3&&s(h,3)),(e==S.attr("id")||e==null)&&(t[2]==2?s(S,2):t[2]==3&&s(S,3)),e==r.attr("id")||e==null){let b=p[0]==null?!0:p[0].includes(0),k=p[1]==null?!0:p[1].includes(1);if(b||k?(t[5]=3,s(r,3)):(t[5]=2,s(r,2)),a.CONFIG.isCollision==1){let B=y[0]==null?!0:y[0].includes(0),Y=y[1]==null?!0:y[1].includes(1);b||k||B||Y?(t[5]=3,s(r,3)):(t[5]=2,s(r,2))}}he()},3010);u.push(l)}function z(){d.send_message(f.MSP_GET_FUNCTION,!1,!1,function(){a.OVOBOT_FUNCTION.isSprayFun==1?(w=!0,_.closest(".grid-row").removeClass("model-display")):(w=!1,t[4]=2,_.closest(".grid-row").addClass("model-display")),a.OVOBOT_FUNCTION.isVoiceFun==1?(x=!0,m.closest(".grid-row").removeClass("model-display")):(x=!1,t[6]=2,m.closest(".grid-row").addClass("model-display"))})}function te(){s(N,1),d.send_message(f.MSP_ADAPTER,!1,!1,function(){a.ANALOG.adapter>=18&&a.ANALOG.adapter<=26?t[0]=2:t[0]=3})}function se(){s(h,1),T(1);let e=setTimeout(()=>{if(t[1]==2){d.send_message(f.MSP_SET_FAN,[60],!1,function(){T(1)});let i=setTimeout(()=>{d.send_message(f.MSP_SET_FAN,[0],!1,function(){T(1)})},2e3);u.push(i)}},100);u.push(e)}function ae(){s(S,1),T(2);let e=setTimeout(()=>{if(t[2]==2){d.send_message(f.MSP_SET_MOTOR,[1],!1,function(){T(2)});let i=setTimeout(()=>{d.send_message(f.MSP_SET_MOTOR,[2],!1,function(){T(2)})},1e3);u.push(i);let l=setTimeout(()=>{d.send_message(f.MSP_SET_MOTOR,[0],!1,function(){T(2)})},2e3);u.push(l)}},100);u.push(e)}function T(e){d.send_message(f.MSP_ANALOG,!1,!1,function(){e==1&&(a.ANALOG.fanAdc<2500||a.ANALOG.fanAdc>3100)?t[1]=3:t[1]=2,e==2&&(a.ANALOG.leftMotorAdc<2500||a.ANALOG.leftMotorAdc>3100||a.ANALOG.rightMotorAdc<2500||a.ANALOG.rightMotorAdc>3100)?t[2]=3:t[2]=2})}function ie(){s(v,1),d.send_message(f.MSP_RAW_IMU,!1,!1,function(){L.push(a.SENSOR_DATA.gyroscope[0]),D.push(a.SENSOR_DATA.gyroscope[1]),F.push(a.SENSOR_DATA.gyroscope[2]),P.push(a.SENSOR_DATA.accelerometer[0]),I.push(a.SENSOR_DATA.accelerometer[1]),U.push(a.SENSOR_DATA.accelerometer[2]),G(L,20,-20)||G(D,20,-20)||G(F,20,-20)||G(P,300,-300)||G(I,300,-300)||G(U,4396,3797)?t[3]=3:t[3]=2})}function G(e,i,l){return!!(Te(e)||ve(e[e.length-1],i,l)==!1)}function Te(e){let i=!1;return e.length>=2?i=e.every(l=>l===e[0])&&e[e.length-2]==e[e.length-1]:i=!0,i}function ve(e,i,l){return!(e<l||e>i)}function le(){s(_,1);let e=setTimeout(()=>{w?d.send_message(f.MSP_SET_SPRAY,[1],!1,function(){X.showModal(),ee()}):s(_,0)},200);u.push(e)}function W(){s(m,1);let e=setTimeout(()=>{x?d.send_message(f.MSP_SET_AUTO_PLAY_VOICE,[a.OVOBOT_FUNCTION.voiceIndex],!1,function(){Z.showModal(),ee()}):s(m,0)},200);u.push(e)}function q(){s(r,1),d.send_message(f.MSP_FOURCORNER,!1,!1,function(){const e=O(a.ANALOG.corner,3)?0:1,i=O(a.ANALOG.corner,2)?0:1,l=O(a.ANALOG.corner,1)?0:1,b=O(a.ANALOG.corner,0)?0:1;if(a.ANALOG.corner==15&&(p[0]=[e,i,l,b]),a.ANALOG.corner==0&&(p[1]=[e,i,l,b]),a.CONFIG.isCollision==1){const k=O(a.ANALOG.hitCorner,3)?0:1,B=O(a.ANALOG.hitCorner,2)?0:1,Y=O(a.ANALOG.hitCorner,1)?0:1,ne=O(a.ANALOG.hitCorner,0)?0:1;a.ANALOG.hitCorner==15&&(y[0]=[k,B,Y,ne]),a.ANALOG.hitCorner==0&&(y[1]=[k,B,Y,ne])}})}function O(e,i){return(e>>i&1)!=1}function s(e,i){if(e!=null)switch(i==0?e.find(".not-tested").removeClass("model-display"):e.find(".not-tested").addClass("model-display"),i==1?e.find(".under-testing").removeClass("model-display"):e.find(".under-testing").addClass("model-display"),i==2?e.find(".test-passed").removeClass("model-display"):e.find(".test-passed").addClass("model-display"),i==3?e.find(".test-failed").removeClass("model-display"):e.find(".test-failed").addClass("model-display"),i){case 0:e.find("a").removeClass("no-click");break;case 1:e.find("a").addClass("no-click");break;case 2:e.find("a").addClass("no-click");break;case 3:e.find("a").removeClass("no-click");break}}function Ne(){u.forEach(e=>clearTimeout(e)),u=[]}function he(){let e;t.includes(3)?(e=3,A.addClass("model-display"),c.addClass("model-display"),C.removeClass("model-display"),g.addClass("model-display")):t.includes(1)||t.includes(0)?(e=0,A.removeClass("model-display"),c.addClass("model-display"),g.addClass("model-display"),C.addClass("model-display")):(e=2,A.addClass("model-display"),c.addClass("model-display"),g.removeClass("model-display"),C.addClass("model-display")),ge(e),o.interval_remove("setup_auto_test_fast"),o.interval_remove("setup_auto_test_cliff_fast"),o.interval_add("setup_getRec_fast",oe,500,!0)}function oe(){d.callbacks=[],d.send_message(f.CMD_BUILD_INFO,!1,!1,function(e){j==0&&(o.connected_to||Re(),j=a.CONFIG.buildInfo,de("autoTest").autoTest,j!=0&&de("autoTest").autoTest==!0&&(o.interval_remove("setup_getRec_fast"),J.trigger("click")))})}function Se(){o.interval_add("setup_getRec_fast",oe,500,!0)}setTimeout(function(){Se()},100),o.content_ready(E)}};H.cleanup=function(E){E&&E()};Me.auto_test=H;export{H as auto_test};
