import{G as l,T as Se,I as Me,aa as Ee,M as f,X as d,F as i,ab as Ge,g as le}from"./DarkTheme-B0yFoytb.js";const J={};J.initialize=function(b){l.active_tab!="auto_test"&&(l.active_tab="auto_test");function ne(){fe()}function fe(){$("#content").load("./tabs/auto_test.html",de)}ne();function de(){Me.localizePage();const Q=$("#auto-test-button"),C=$("#model-gyro-status"),v=$("#model-adpter-status"),N=$("#model-fan-status"),h=$("#model-motor-status"),r=$("#model-cliff-status"),A=$(".test-result-empty"),T=$(".test-result-passed"),y=$(".test-result-failed"),ue=$(".yes-spray-btn"),re=$(".no-spary-btn"),ce=$(".yes-voice-btn"),_e=$(".no-voice-btn"),c=$("#model-waterpump-status"),_=$("#model-voice-status");let u=[],s=[0,0,0,0,0,0,0],m=new Array(2),p=new Array(2),L=[],k=[],P=[],D=[],F=[],I=[],U=!1,w=!1,n,G=!0,V=!1,Y=0;const X=$(".dialogConfirmUnderingTest-Spary")[0],Z=$(".dialogConfirmUnderingTest-Voice")[0];x();function x(){let e,t,o=0;$("dialog").filter(function(){if($(this).prop("open"))return e=$(this),$(this).prop("open")}).length>0?t=$("#"+e.find("div.buttons").attr("id")+" a"):t=$("#auto-test-button a"),o=z(o,t),o=me(o,t)}function z(e,t){return t.removeClass("focused"),t.eq(e).hasClass("no-click")?(e+=1,z(e,t)):(t.eq(e).addClass("focused"),t.eq(e).focus()),e}function me(e,t){return t.on("keydown",function(o){o.key==="Tab"&&(o.preventDefault(),o.stopPropagation(),e=(e+1)%t.length,e=z(e,t))}),e}$(document).keydown(function(e){(e.which===13||e.key==="Enter")&&(e.preventDefault(),e.stopPropagation(),$(":focus").click(),x())}),Q.on("click",function(){ye(),W(),l.interval_add("setup_auto_test_gyro_fast",se,50,!0),l.interval_add("setup_auto_test_cliff_fast",K,50,!0),l.interval_add("setup_auto_test_fast",pe,50,!0);let e=setTimeout(()=>{l.interval_remove("setup_auto_test_gyro_fast"),V=!0,Oe()},1e3);u.push(e),S()}),$(".retest-btn a").on("click",function(){$(this).hasClass("no-click")||(n=$(this).closest(".grid-row-content").attr("id"),Ee.isEmptyObject(n)==!1&&n!=null&&(n.indexOf("gyro")!==-1?(a(C,0),s[3]=0,L=[],k=[],P=[],D=[],F=[],I=[],l.interval_add("setup_auto_test_gyro_fast",se,50,!0),setTimeout(function(){l.interval_remove("setup_auto_test_gyro_fast"),V=!0},1e3)):n.indexOf("adpter")!==-1?(s[0]=0,a(v,0),j()):n.indexOf("fan")!==-1?(s[1]=0,a(N,0),ee()):n.indexOf("motor")!==-1?(s[2]=0,a(h,0),te()):n.indexOf("cliff")!==-1?(s[5]=0,m=[],p=[],a(r,0),l.interval_add("setup_auto_test_cliff_fast",K,50,!0),setTimeout(function(){l.interval_remove("setup_auto_test_cliff_fast"),V=!0},1e3)):n.indexOf("waterpump")!==-1?(s[4]=0,a(c,0),G=!1,W(),ae()):n.indexOf("voice")!==-1&&(s[6]=0,a(_,0),G=!1,W(),H()),S(n)))}),ue.on("click",function(){s[4]=2,a(c,2),X.close(),G&&H(),S(n)}),re.on("click",function(){s[4]=3,a(c,3),X.close(),G&&H(),S(n)}),ce.on("click",function(){s[6]=2,a(_,2),Z.close(),S(n)}),_e.on("click",function(){s[6]=3,a(_,3),Z.close(),S(n)});function pe(){j(),K()}function Oe(){ae(),ee(),te()}Ae();function Ae(){f.send_message(d.MSP_GET_AUTO_TEST_RESULT,!1,!1,function(){i.OVOBOT_FUNCTION.autoTestResult==0?(A.removeClass("model-display"),T.addClass("model-display"),y.addClass("model-display")):i.OVOBOT_FUNCTION.autoTestResult==2?(A.addClass("model-display"),T.removeClass("model-display"),y.addClass("model-display")):i.OVOBOT_FUNCTION.autoTestResult==3&&(A.addClass("model-display"),T.addClass("model-display"),y.removeClass("model-display"))})}function Te(e){f.send_message(d.MSP_SET_AUTO_TEST_RESULT,[e],!1,function(){})}function ye(){ve(),s=[0,0,0,0,0,0,0],L=[],k=[],P=[],D=[],F=[],I=[],n=void 0,m=[],p=[],U=!1,w=!1,G=!0,a(C,0),a(v,0),a(N,0),a(h,0),a(r,0),a(c,0),a(_,0),A.removeClass("model-display"),T.addClass("model-display"),y.addClass("model-display")}function S(e){let t=setTimeout(()=>{V&&(e==C.attr("id")||e==null)&&(s[3]==2?a(C,2):s[3]==3&&a(C,3))},1010);u.push(t);let o=setTimeout(()=>{if((e==v.attr("id")||e==null)&&(s[0]==2?a(v,2):s[0]==3&&a(v,3)),(e==N.attr("id")||e==null)&&(s[1]==2?a(N,2):s[1]==3&&a(N,3)),(e==h.attr("id")||e==null)&&(s[2]==2?a(h,2):s[2]==3&&a(h,3)),e==r.attr("id")||e==null){let E=m[0]==null?!0:m[0].includes(0),R=m[1]==null?!0:m[1].includes(1);if(E||R?(s[5]=3,a(r,3)):(s[5]=2,a(r,2)),i.CONFIG.isCollision==1){let B=p[0]==null?!0:p[0].includes(0),q=p[1]==null?!0:p[1].includes(1);E||R||B||q?(s[5]=3,a(r,3)):(s[5]=2,a(r,2))}}Ne()},3010);u.push(o)}function W(){f.send_message(d.MSP_GET_FUNCTION,!1,!1,function(){i.OVOBOT_FUNCTION.isSprayFun==1?(U=!0,c.closest(".grid-row").removeClass("model-display")):(U=!1,s[4]=2,c.closest(".grid-row").addClass("model-display")),i.OVOBOT_FUNCTION.isVoiceFun==1?(w=!0,_.closest(".grid-row").removeClass("model-display")):(w=!1,s[6]=2,_.closest(".grid-row").addClass("model-display"))})}function j(){a(v,1),f.send_message(d.MSP_ADAPTER,!1,!1,function(){i.ANALOG.adapter>=18&&i.ANALOG.adapter<=26?s[0]=2:s[0]=3})}function ee(){a(N,1),g(1);let e=setTimeout(()=>{if(s[1]==2){f.send_message(d.MSP_SET_FAN,[60],!1,function(){g(1)});let t=setTimeout(()=>{f.send_message(d.MSP_SET_FAN,[0],!1,function(){g(1)})},2e3);u.push(t)}},100);u.push(e)}function te(){a(h,1),g(2);let e=setTimeout(()=>{if(s[2]==2){f.send_message(d.MSP_SET_MOTOR,[1],!1,function(){g(2)});let t=setTimeout(()=>{f.send_message(d.MSP_SET_MOTOR,[2],!1,function(){g(2)})},1e3);u.push(t);let o=setTimeout(()=>{f.send_message(d.MSP_SET_MOTOR,[0],!1,function(){g(2)})},2e3);u.push(o)}},100);u.push(e)}function g(e){f.send_message(d.MSP_ANALOG,!1,!1,function(){e==1&&(i.ANALOG.fanAdc<2500||i.ANALOG.fanAdc>3100)?s[1]=3:s[1]=2,e==2&&(i.ANALOG.leftMotorAdc<2500||i.ANALOG.leftMotorAdc>3100||i.ANALOG.rightMotorAdc<2500||i.ANALOG.rightMotorAdc>3100)?s[2]=3:s[2]=2})}function se(){a(C,1),f.send_message(d.MSP_RAW_IMU,!1,!1,function(){L.push(i.SENSOR_DATA.gyroscope[0]),k.push(i.SENSOR_DATA.gyroscope[1]),P.push(i.SENSOR_DATA.gyroscope[2]),D.push(i.SENSOR_DATA.accelerometer[0]),F.push(i.SENSOR_DATA.accelerometer[1]),I.push(i.SENSOR_DATA.accelerometer[2]),M(L,20,-20)||M(k,20,-20)||M(P,20,-20)||M(D,300,-300)||M(F,300,-300)||M(I,4396,3797)?s[3]=3:s[3]=2})}function M(e,t,o){return!!(ge(e)||Ce(e[e.length-1],t,o)==!1)}function ge(e){let t=!1;return e.length>=2?t=e.every(o=>o===e[0])&&e[e.length-2]==e[e.length-1]:t=!0,t}function Ce(e,t,o){return!(e<o||e>t)}function ae(){a(c,1);let e=setTimeout(()=>{U?f.send_message(d.MSP_SET_SPRAY,[1],!1,function(){X.showModal(),x()}):a(c,0)},200);u.push(e)}function H(){a(_,1);let e=setTimeout(()=>{w?f.send_message(d.MSP_SET_AUTO_PLAY_VOICE,[i.OVOBOT_FUNCTION.voiceIndex],!1,function(){Z.showModal(),x()}):a(_,0)},200);u.push(e)}function K(){a(r,1),f.send_message(d.MSP_FOURCORNER,!1,!1,function(){const e=O(i.ANALOG.corner,3)?0:1,t=O(i.ANALOG.corner,2)?0:1,o=O(i.ANALOG.corner,1)?0:1,E=O(i.ANALOG.corner,0)?0:1;if(i.ANALOG.corner==15&&(m[0]=[e,t,o,E]),i.ANALOG.corner==0&&(m[1]=[e,t,o,E]),i.CONFIG.isCollision==1){const R=O(i.ANALOG.hitCorner,3)?0:1,B=O(i.ANALOG.hitCorner,2)?0:1,q=O(i.ANALOG.hitCorner,1)?0:1,oe=O(i.ANALOG.hitCorner,0)?0:1;i.ANALOG.hitCorner==15&&(p[0]=[R,B,q,oe]),i.ANALOG.hitCorner==0&&(p[1]=[R,B,q,oe])}})}function O(e,t){return(e>>t&1)!=1}function a(e,t){if(e!=null)switch(t==0?e.find(".not-tested").removeClass("model-display"):e.find(".not-tested").addClass("model-display"),t==1?e.find(".under-testing").removeClass("model-display"):e.find(".under-testing").addClass("model-display"),t==2?e.find(".test-passed").removeClass("model-display"):e.find(".test-passed").addClass("model-display"),t==3?e.find(".test-failed").removeClass("model-display"):e.find(".test-failed").addClass("model-display"),t){case 0:e.find("a").removeClass("no-click");break;case 1:e.find("a").addClass("no-click");break;case 2:e.find("a").addClass("no-click");break;case 3:e.find("a").removeClass("no-click");break}}function ve(){u.forEach(e=>clearTimeout(e)),u=[]}function Ne(){let e;s.includes(3)?(e=3,A.addClass("model-display"),y.removeClass("model-display"),T.addClass("model-display")):s.includes(1)||s.includes(0)?(e=0,A.removeClass("model-display"),T.addClass("model-display"),y.addClass("model-display")):(e=2,A.addClass("model-display"),T.removeClass("model-display"),y.addClass("model-display")),Te(e),l.interval_remove("setup_auto_test_fast"),l.interval_remove("setup_auto_test_cliff_fast"),l.interval_add("setup_getRec_fast",ie,500,!0)}function ie(){f.callbacks=[],f.send_message(d.CMD_BUILD_INFO,!1,!1,function(e){Y==0&&(l.connected_to||Ge(),Y=i.CONFIG.buildInfo,le("autoTest").autoTest,Y!=0&&le("autoTest").autoTest==!0&&(l.interval_remove("setup_getRec_fast"),Q.trigger("click")))})}function he(){l.interval_add("setup_getRec_fast",ie,500,!0)}setTimeout(function(){he()},100),l.content_ready(b)}};J.cleanup=function(b){b&&b()};Se.auto_test=J;export{J as auto_test};
