import{$ as n,I as v,F as a,M as S,X as f,a3 as W,L as Qe,G as Y,T as w,s as qt,g as ze,ac as _e,O as ue,D as de,a5 as Je,_ as Ke}from"./DarkTheme-x8aAi6Mp.js";import{a as zt,i as Ze}from"./common-DnpoJXd8.js";import{m as ct}from"./main-C41Bl0nh.js";import{l as me,a as pe,b as ge,c as to,s as eo}from"./transform-Ds3J3XDC.js";import{e as oo}from"./extent-DA9eJQRT.js";class Kt{constructor(t){this.FrameColor="rgb(186, 186, 186)",this.PropEdgeColor="rgb(255, 187, 0)",this.PropColor="rgb(186, 186, 186, 0.4)",this.PropEdgeLineWidth=3,this.MotorNumberTextFont=`${t*.1}px 'Open Sans', 'Segoe UI', Tahoma, sans-serif`,this.MotorNumberTextColor="rgb(0, 0, 0)",this.MotorMouseHoverColor="rgba(255, 187, 0, 0.4)",this.MotorSpinningColor="rgba(255, 0, 0, 0.4)",this.MotorReadyColor="rgba(0,128,0,0.4)",this.ArrowColor="rgb(182,67,67)",this.DirectionArrowPoints=[{x:-.03*t,y:.11*t},{x:-.03*t,y:-.01*t},{x:-.07*t,y:-.01*t},{x:0*t,y:-.13*t},{x:.07*t,y:-.01*t},{x:.03*t,y:-.01*t},{x:.03*t,y:.11*t}];let e=.28*t;this["Quad X"]={PropRadius:.2*t,ArmWidth:.1*t,Motors:[{x:e,y:e},{x:e,y:-e},{x:-e,y:e},{x:-e,y:-e}]},e=.28*t,this["Quad X 1234"]={PropRadius:.2*t,ArmWidth:.1*t,Motors:[{x:-e,y:-e},{x:e,y:-e},{x:e,y:e},{x:-e,y:e}]},e=.32*t,this["Quad +"]={PropRadius:.15*t,ArmWidth:.1*t,Motors:[{x:0,y:e},{x:e,y:0},{x:-e,y:0},{x:0,y:-e}]},e=.3*t,this.Tricopter={PropRadius:.15*t,ArmWidth:.1*t,Motors:[{x:0,y:e},{x:e,y:-e},{x:-e,y:-e}]},e=.35*t,this["Hex +"]={PropRadius:.14*t,ArmWidth:.1*t,Motors:[]};let s=Math.PI/3,o=0;o=s*1,this["Hex +"].Motors.push({x:Math.sin(o)*e,y:Math.cos(o)*e}),o=s*2,this["Hex +"].Motors.push({x:Math.sin(o)*e,y:Math.cos(o)*e}),o=-s*1,this["Hex +"].Motors.push({x:Math.sin(o)*e,y:Math.cos(o)*e}),o=-s*2,this["Hex +"].Motors.push({x:Math.sin(o)*e,y:Math.cos(o)*e}),o=s*3,this["Hex +"].Motors.push({x:Math.sin(o)*e,y:Math.cos(o)*e}),o=s*0,this["Hex +"].Motors.push({x:Math.sin(o)*e,y:Math.cos(o)*e}),e=.35*t,this["Hex X"]={PropRadius:.14*t,ArmWidth:.1*t,Motors:[]},s=Math.PI/3,o=s*1,this["Hex X"].Motors.push({x:Math.cos(o)*e,y:Math.sin(o)*e}),o=-s*1,this["Hex X"].Motors.push({x:Math.cos(o)*e,y:Math.sin(o)*e}),o=s*2,this["Hex X"].Motors.push({x:Math.cos(o)*e,y:Math.sin(o)*e}),o=-s*2,this["Hex X"].Motors.push({x:Math.cos(o)*e,y:Math.sin(o)*e}),o=s*0,this["Hex X"].Motors.push({x:Math.cos(o)*e,y:Math.sin(o)*e}),o=s*3,this["Hex X"].Motors.push({x:Math.cos(o)*e,y:Math.sin(o)*e}),this._addOcto("Octo Flat +",-Math.PI/2,t),this._addOcto("Octo Flat X",-Math.PI/2+Math.PI/8,t),this._addOctoX8(t),this._addBicopter(t),this._addVTailQuad(t),this._addATailQuad(t),this._addY4(t),this._addY6(t)}_addY6(t){const e=.3*t;this.Y6={PropRadius:.15*t,ArmWidth:.1*t,Motors:[{x:0,y:e*.7,top:!0},{x:e*.7,y:-e*.7,top:!0},{x:-e*.7,y:-e*.7,top:!0},{x:0,y:e*1.1,bottom:!0},{x:e*1.1,y:-e*1.1,bottom:!0},{x:-e*1.1,y:-e*1.1,bottom:!0}]}}_addY4(t){const e=.3*t;this.Y4={PropRadius:.15*t,ArmWidth:.1*t,Motors:[{x:0,y:e*.7,top:!0},{x:e,y:-e},{x:0,y:e*1.1,bottom:!0},{x:-e,y:-e}]}}_addVTailQuad(t){const e=.3*t;this["V-tail Quad"]={PropRadius:.15*t,ArmWidth:.1*t,Motors:[{x:e*.7,y:e*.7},{x:e,y:-e},{x:-e*.7,y:e*.7},{x:-e,y:-e}]}}_addATailQuad(t){const e=.3*t;this["A-tail Quad"]={PropRadius:.15*t,ArmWidth:.1*t,Motors:[{x:-e*.7,y:e*.7},{x:e,y:-e},{x:e*.7,y:e*.7},{x:-e,y:-e}]}}_addBicopter(t){const e=.35*t;this.Bicopter={PropRadius:.2*t,ArmWidth:.1*t,Motors:[{x:-e,y:0},{x:e,y:0}]}}_addOctoX8(t){const e=.2*t,s=.28*t;this["Octo X8"]={PropRadius:.12*t,ArmWidth:.1*t,Motors:[{x:e,y:e,top:!0},{x:e,y:-e,top:!0},{x:-e,y:e,top:!0},{x:-e,y:-e,top:!0},{x:s,y:s,bottom:!0},{x:s,y:-s,bottom:!0},{x:-s,y:s,bottom:!0},{x:-s,y:-s,bottom:!0}]}}_addOcto(t,e,s){const o=.35*s;this[t]={PropRadius:.1*s,ArmWidth:.1*s,Motors:[]};const r=Math.PI/4;let l=-r*2+e;this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o}),l=r*0+e,this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o}),l=r*2+e,this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o}),l=r*4+e,this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o}),l=-r*1+e,this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o}),l=r*1+e,this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o}),l=r*3+e,this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o}),l=-r*3+e,this[t].Motors.push({x:Math.cos(l)*o,y:Math.sin(l)*o})}}class so{constructor(t,e,s,o){this._spinMotorCallback=o,this._canvas=t,this._motorClickCallback=s,this._width=this._canvas.width(),this._height=this._canvas.height(),this._screenSize=Math.min(this._width,this._height),this._config=new Kt(this._screenSize),this._canvas.prop({width:this._width,height:this._height}),this._droneConfiguration=e,this._ctx=this._canvas[0].getContext("2d"),this._ctx.translate(this._width/2,this._height/2),this._canvas.mousemove(r=>{this._onMouseMove(r)}),this._canvas.mouseleave(()=>{this._onMouseLeave()}),this._canvas.mousedown(()=>{this._onMouseDown()}),this._canvas.mouseup(()=>{this._onMouseUp(event)}),this._canvas.click(()=>{this._onMouseClick()}),this.startOver()}pause(){this._keepDrawing=!1}startOver(){this.readyMotors=[],this.remappingReady=!1,this._motorIndexToSpinOnMouseDown=-1,this._keepDrawing=!0,this._mouse={x:0,y:0},window.requestAnimationFrame(()=>{this._drawOnce()})}_drawOnce(){this._ctx.clearRect(-this._width/2,-this._height/2,this._width,this._height),this._drawBottomMotors(),this._drawFrame(),this._drawDirectionArrow(),this._markMotors(),this._drawTopMotors(),this._keepDrawing&&window.requestAnimationFrame(()=>{this._drawOnce()})}_onMouseDown(){this.remappingReady&&(this._motorIndexToSpinOnMouseDown=this._getMouseHoverMotorIndex(),this._spinMotorCallback&&this._spinMotorCallback(this._motorIndexToSpinOnMouseDown))}_onMouseUp(){this._motorIndexToSpinOnMouseDown!==-1&&(this._motorIndexToSpinOnMouseDown=-1,this._spinMotorCallback&&this._spinMotorCallback(this._motorIndexToSpinOnMouseDown))}_onMouseClick(){const t=this._getMouseHoverMotorIndex();this._motorClickCallback&&t!==-1&&!this.readyMotors.includes(t)&&this._motorClickCallback(t)}_onMouseMove(t){const e=this._canvas[0].getBoundingClientRect();this._mouse.x=t.clientX-e.left-this._width/2,this._mouse.y=t.clientY-e.top-this._height/2}_onMouseLeave(){this._mouse.x=Number.MIN_SAFE_INTEGER,this._mouse.y=Number.MIN_SAFE_INTEGER,this._motorIndexToSpinOnMouseDown!==-1&&(this._motorIndexToSpinOnMouseDown=-1,this._spinMotorCallback&&this._spinMotorCallback(this._motorIndexToSpinOnMouseDown))}_markMotors(){const t=this._config[this._droneConfiguration].Motors,e=this._getMouseHoverMotorIndex();if(this._motorIndexToSpinOnMouseDown===-1){for(let s=0;s<this.readyMotors.length;s++){const o=this.readyMotors[s];this._ctx.beginPath(),this._ctx.arc(t[o].x,t[o].y,this._config[this._droneConfiguration].PropRadius,0,2*Math.PI),this._ctx.closePath(),this._ctx.fillStyle=this._config.MotorReadyColor,this._ctx.fill()}e!==-1&&!this.readyMotors.includes(e)&&(this._ctx.beginPath(),this._ctx.arc(t[e].x,t[e].y,this._config[this._droneConfiguration].PropRadius,0,2*Math.PI),this._ctx.closePath(),this._ctx.fillStyle=this._config.MotorMouseHoverColor,this._ctx.fill())}else{const s=this._motorIndexToSpinOnMouseDown;for(let o=0;o<t.length;o++)this._ctx.fillStyle=this._config.MotorReadyColor,s===o?this._ctx.fillStyle=this._config.MotorSpinningColor:e===o&&(this._ctx.fillStyle=this._config.MotorMouseHoverColor),this._ctx.beginPath(),this._ctx.arc(t[o].x,t[o].y,this._config[this._droneConfiguration].PropRadius,0,2*Math.PI),this._ctx.closePath(),this._ctx.fill()}}_getMouseHoverMotorIndex(){const t=this._mouse.x,e=this._mouse.y;let s=-1,o=Number.MAX_SAFE_INTEGER,r=-1;const l=this._config[this._droneConfiguration].Motors;for(let c=0;c<l.length;c++){const p=Math.sqrt((t-l[c].x)*(t-l[c].x)+(e-l[c].y)*(e-l[c].y));p<this._config[this._droneConfiguration].PropRadius&&p<o&&(o=p,s=c,"top"in l[c]&&(r=c))}return r>-1&&(s=r),s}_drawTopMotors(){this._drawMotors(!1)}_drawBottomMotors(){this._drawMotors(!0),this._clipTopMotors()}_clipTopMotors(){const t=this._config[this._droneConfiguration].Motors;for(let e=0;e<t.length;e++)"top"in t[e]&&this._clipSingleMotor(e)}_drawMotors(t){this._ctx.lineWidth=this._config.PropEdgeLineWidth,this._ctx.strokeStyle=this._config.PropEdgeColor;const e=this._config[this._droneConfiguration].Motors;this._ctx.fillStyle=this._config.PropColor;for(let s=0;s<e.length;s++)"bottom"in e[s]===t&&this._drawSingleMotor(s)}_clipSingleMotor(t){this._ctx.save();const e=this._config[this._droneConfiguration].Motors[t];this._ctx.beginPath();const s=this._config[this._droneConfiguration].PropRadius;this._arcSingleMotor(t),this._ctx.clip(),this._ctx.clearRect(e.x-s,e.y-s,s*2,s*2),this._ctx.closePath(),this._ctx.restore()}_drawSingleMotor(t){this._ctx.beginPath(),this._arcSingleMotor(t),this._ctx.stroke(),this._ctx.closePath()}_arcSingleMotor(t){const e=this._config[this._droneConfiguration].Motors[t];this._ctx.arc(e.x,e.y,this._config[this._droneConfiguration].PropRadius,0,2*Math.PI)}_drawDirectionArrow(){this._ctx.beginPath(),this._ctx.moveTo(this._config.DirectionArrowPoints[0].x,this._config.DirectionArrowPoints[0].y);for(let t=1;t<this._config.DirectionArrowPoints.length;t++)this._ctx.lineTo(this._config.DirectionArrowPoints[t].x,this._config.DirectionArrowPoints[t].y);this._ctx.closePath(),this._ctx.fillStyle=this._config.ArrowColor,this._ctx.fill()}_drawFrame(){this._ctx.beginPath(),this._ctx.lineWidth=this._config[this._droneConfiguration].ArmWidth,this._ctx.lineCap="round",this._ctx.strokeStyle=this._config.FrameColor;const t=this._config[this._droneConfiguration].Motors;switch(this._droneConfiguration){case"Quad X":case"Quad +":case"Octo X8":this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[3].x,t[3].y),this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[2].x,t[2].y);break;case"Quad X 1234":this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[2].x,t[2].y),this._ctx.moveTo(t[3].x,t[3].y),this._ctx.lineTo(t[1].x,t[1].y);break;case"Tricopter":this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[2].x,t[2].y),this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[0].x,t[2].y);break;case"Hex +":case"Hex X":this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[3].x,t[3].y),this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[2].x,t[2].y),this._ctx.moveTo(t[4].x,t[4].y),this._ctx.lineTo(t[5].x,t[5].y);break;case"Octo Flat +":case"Octo Flat X":this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[2].x,t[2].y),this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[3].x,t[3].y),this._ctx.moveTo(t[4].x,t[4].y),this._ctx.lineTo(t[6].x,t[6].y),this._ctx.moveTo(t[5].x,t[5].y),this._ctx.lineTo(t[7].x,t[7].y);break;case"Bicopter":this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[1].x,t[1].y);break;case"V-tail Quad":this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(0,t[0].y*1.3),this._ctx.lineTo(t[2].x,t[2].y),this._ctx.moveTo(0,t[0].y*1.3),this._ctx.lineTo(0,t[1].y),this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[3].x,t[3].y);break;case"A-tail Quad":this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(0,t[0].y*.7),this._ctx.lineTo(t[2].x,t[2].y),this._ctx.moveTo(0,t[0].y*.7),this._ctx.lineTo(0,t[1].y),this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[3].x,t[3].y);break;case"Y4":this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[3].x,t[3].y),this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[0].x,t[3].y);break;case"Y6":this._ctx.moveTo(t[1].x,t[1].y),this._ctx.lineTo(t[2].x,t[2].y),this._ctx.moveTo(t[0].x,t[0].y),this._ctx.lineTo(t[0].x,t[1].y);break}this._ctx.stroke()}}class io{constructor(t,e,s,o,r){this._contentDiv=t,this._onLoadedCallback=e,this._droneConfiguration=s,this._motorStopValue=o,this._motorSpinValue=r,this._config=new Kt(100),this._currentJerkingTimeout=-1,this._currentJerkingMotor=-1,this._currentSpinningMotor=-1,this._contentDiv.load("./components/MotorOutputReordering/Body.html",()=>{this._setupdialog()})}_readDom(){this._domAgreeSafetyCheckBox=n("#motorsEnableTestMode-dialogMotorOutputReorder"),this._domStartButton=n("#dialogMotorOutputReorderAgreeButton"),this._domStartOverButton=n("#motorsRemapDialogStartOver"),this._domSaveButton=n("#motorsRemapDialogSave"),this._domMainContentBlock=n("#dialogMotorOutputReorderMainContent"),this._domWarningContentBlock=n("#dialogMotorOutputReorderWarning"),this._domActionHintBlock=n("#motorOutputReorderActionHint"),this._domCanvas=n("#motorOutputReorderCanvas")}_setupdialog(){v.localizePage(),this._readDom(),this._resetGui(),this._domAgreeSafetyCheckBox.change(()=>{const t=this._domAgreeSafetyCheckBox.is(":checked");this._domStartButton.toggle(t)}),this._domStartButton.click(()=>{this._onStartButtonClicked()}),this._domStartOverButton.click(()=>{this._startOver()}),this._domSaveButton.click(()=>{this._save()}),this._onLoadedCallback()}close(){this._stopAnyMotorJerking(),this._stopMotor(),this._stopUserInteraction(),this._resetGui()}_resetGui(){this._domMainContentBlock.hide(),this._domWarningContentBlock.show(),this._domStartButton.hide(),this._domAgreeSafetyCheckBox.prop("checked",!1),this._domAgreeSafetyCheckBox.change(),this._showSaveStartOverButtons(!1)}_save(){a.MOTOR_OUTPUT_ORDER=Array.from(this._newMotorOutputReorder),S.send_message(f.MSP2_SET_MOTOR_OUTPUT_REORDERING,W.crunch(f.MSP2_SET_MOTOR_OUTPUT_REORDERING),!1,()=>W.writeConfiguration(!0))}_calculateNewMotorOutputReorder(){this._newMotorOutputReorder=[];for(let t=0;t<this.motorOutputReorderCanvas.readyMotors.length;t++)this._newMotorOutputReorder.push(this._remapMotorIndex(t))}_remapMotorIndex(t){return a.MOTOR_OUTPUT_ORDER[this.motorOutputReorderCanvas.readyMotors.indexOf(t)]}_startOver(){this._showSaveStartOverButtons(!1),this._startUserInteraction()}_showSaveStartOverButtons(t){t?(this._domStartOverButton.show(),this._domSaveButton.show()):(this._domStartOverButton.hide(),this._domSaveButton.hide())}_onStartButtonClicked(){this._domActionHintBlock.text(v.getMessage("motorOutputReorderDialogSelectSpinningMotor")),this._domWarningContentBlock.hide(),this._domMainContentBlock.show(),this._startUserInteraction()}_stopUserInteraction(){this.motorOutputReorderCanvas&&this.motorOutputReorderCanvas.pause()}_startUserInteraction(){this.motorOutputReorderCanvas?this.motorOutputReorderCanvas.startOver():this.motorOutputReorderCanvas=new so(this._domCanvas,this._droneConfiguration,t=>{this._onMotorClick(t)},t=>{let e=-1;t!==-1&&(e=this.motorOutputReorderCanvas.readyMotors.indexOf(t)),this._spinMotor(e)}),this._startMotorJerking(0)}_stopAnyMotorJerking(){this._currentJerkingTimeout!==-1&&(clearTimeout(this._currentJerkingTimeout),this._currentJerkingTimeout=-1,this._spinMotor(-1)),this._currentJerkingMotor=-1}_startMotorJerking(t){this._stopAnyMotorJerking(),this._currentJerkingMotor=t,this._motorStartTimeout(t)}_motorStartTimeout(t){this._spinMotor(t),this._currentJerkingTimeout=setTimeout(()=>{this._motorStopTimeout(t)},250)}_motorStopTimeout(t){this._spinMotor(-1),this._currentJerkingTimeout=setTimeout(()=>{this._motorStartTimeout(t)},500)}_spinMotor(t){this._currentSpinningMotor=t;const e=[];for(let s=0;s<this._config[this._droneConfiguration].Motors.length;s++)s===t?e.push16(this._motorSpinValue):e.push16(this._motorStopValue);S.send_message(f.MSP_SET_MOTOR,e)}_stopMotor(){this._currentSpinningMotor!==-1&&this._spinMotor(-1)}_onMotorClick(t){this.motorOutputReorderCanvas.readyMotors.push(t),this._currentJerkingMotor++,this._currentJerkingMotor<this._config[this._droneConfiguration].Motors.length?this._startMotorJerking(this._currentJerkingMotor):(this._stopAnyMotorJerking(),this._domActionHintBlock.text(v.getMessage("motorOutputReorderDialogRemapIsDone")),this._calculateNewMotorOutputReorder(),this.motorOutputReorderCanvas.remappingReady=!0,this._showSaveStartOverButtons(!0))}}class ro{constructor(t){this._intervalId=null,this._interval=t,this._queue=[],this._purging=!1}pushCommand(t,e){this._queue.push([t,e])}pushPause(t){const e=Math.ceil(t/this._interval);for(let s=0;s<e;s++)this.pushCommand(null,null)}start(){this._intervalId===null&&(this._intervalId=setInterval(()=>{this._checkQueue()},this._interval))}stop(){this._intervalId!==null&&(clearInterval(this._intervalId),this._intervalId=null)}stopWhenEmpty(){this._purging=!0}clear(){this._queue=[]}_checkQueue(){if(this._queue.length!==0){const t=this._queue.shift();t[0]!==null&&S.send_message(t[0],t[1])}else this._purging&&(this._purging=!1,this.stop())}}class G{static get ALL_MOTORS(){return 255}}G.dshotCommands_e={DSHOT_CMD_MOTOR_STOP:0,DSHOT_CMD_BEACON1:1,DSHOT_CMD_BEACON2:2,DSHOT_CMD_BEACON3:3,DSHOT_CMD_BEACON4:4,DSHOT_CMD_BEACON5:5,DSHOT_CMD_ESC_INFO:6,DSHOT_CMD_SPIN_DIRECTION_1:7,DSHOT_CMD_SPIN_DIRECTION_2:8,DSHOT_CMD_3D_MODE_OFF:9,DSHOT_CMD_3D_MODE_ON:10,DSHOT_CMD_SETTINGS_REQUEST:11,DSHOT_CMD_SAVE_SETTINGS:12,DSHOT_CMD_SPIN_DIRECTION_NORMAL:20,DSHOT_CMD_SPIN_DIRECTION_REVERSED:21,DSHOT_CMD_LED0_ON:22,DSHOT_CMD_LED1_ON:23,DSHOT_CMD_LED2_ON:24,DSHOT_CMD_LED3_ON:25,DSHOT_CMD_LED0_OFF:26,DSHOT_CMD_LED1_OFF:27,DSHOT_CMD_LED2_OFF:28,DSHOT_CMD_LED3_OFF:29,DSHOT_CMD_AUDIO_STREAM_MODE_ON_OFF:30,DSHOT_CMD_SILENT_MODE_ON_OFF:31,DSHOT_CMD_MAX:47};G.dshotCommandType_e={DSHOT_CMD_TYPE_INLINE:0,DSHOT_CMD_TYPE_BLOCKING:1};class no{constructor(t,e,s){this._numberOfMotors=t.numberOfMotors,this._motorStopValue=t.motorStopValue,this._motorSpinValue=t.motorSpinValue,this._motorDriverStopMotorsPauseMs=s,this._state=[];for(let o=0;o<this._numberOfMotors;o++)this._state.push(this._motorStopValue);this._stateStack=[],this._EscDshotCommandQueue=new ro(e)}activate(){this._EscDshotCommandQueue.start()}deactivate(){this._EscDshotCommandQueue.stopWhenEmpty()}stopMotor(t){this._spinMotor(t,this._motorStopValue)}spinMotor(t){this._spinMotor(t,this._motorSpinValue)}spinAllMotors(){this._spinAllMotors(this._motorSpinValue)}stopAllMotors(){this._spinAllMotors(this._motorStopValue)}stopAllMotorsNow(){this._EscDshotCommandQueue.clear(),this._spinAllMotors(this._motorStopValue)}setEscSpinDirection(t,e){let s=!1;G.ALL_MOTORS===t?s=this._isAnythingSpinning():s=this._isMotorSpinning(t),s?(this._pushState(),this._spinMotor(t,this._motorStopValue),this._EscDshotCommandQueue.pushPause(this._motorDriverStopMotorsPauseMs),this._sendEscSpinDirection(t,e),this._popState(),this._sendState()):this._sendEscSpinDirection(t,e)}_pushState(){const t=[...this._state];this._stateStack.push(t)}_popState(){const t=this._stateStack.pop();this._state=[...t]}_isAnythingSpinning(){let t=!1;for(let e=0;e<this._numberOfMotors;e++)if(this._motorStopValue!==this._state[e]){t=!0;break}return t}_isMotorSpinning(t){return this._motorStopValue!==this._state[t]}_sendEscSpinDirection(t,e){const s=[];s.push8(G.dshotCommandType_e.DSHOT_CMD_TYPE_BLOCKING),s.push8(t),s.push8(2),s.push8(e),s.push8(G.dshotCommands_e.DSHOT_CMD_SAVE_SETTINGS),this._EscDshotCommandQueue.pushCommand(f.MSP2_SEND_DSHOT_COMMAND,s);let o="";if(t===G.ALL_MOTORS)o+=i18n.getMessage("motorsText");else{const r=t+1;o+=i18n.getMessage(`motorNumber${r}`)}o+=": ",e===G.dshotCommands_e.DSHOT_CMD_SPIN_DIRECTION_1?o+=i18n.getMessage("escDshotDirectionDialog-CommandNormal"):o+=i18n.getMessage("escDshotDirectionDialog-CommandReverse"),Qe(o)}_spinMotor(t,e){G.ALL_MOTORS===t?this._spinAllMotors(e):(this._state[t]=e,this._sendState())}_spinAllMotors(t){for(let e=0;e<this._numberOfMotors;e++)this._state[e]=t;this._sendState()}_sendState(){const t=[];for(let e=0;e<this._numberOfMotors;e++)t.push16(this._state[e]);this._EscDshotCommandQueue.pushCommand(f.MSP_SET_MOTOR,t)}}class N{constructor(t,e,s){this._buttonTimeoutMs=400;const o=100,r=400;this._motorDriver=new no(s,o,r),this._escProtocolIsDshot=s.escProtocolIsDshot,this._numberOfMotors=s.numberOfMotors,this._contentDiv=t,this._onLoadedCallback=e,this._currentSpinningMotor=-1,this._selectedMotor=-1,this._motorIsSpinning=!1,this._allMotorsAreSpinning=!1,this._spinDirectionToggleIsActive=!0,this._activationButtonTimeoutId=null,this._contentDiv.load("./components/EscDshotDirection/Body.html",()=>{this._initializeDialog()})}static get PUSHED_BUTTON_CLASS(){return"pushed"}static get HIGHLIGHTED_BUTTON_CLASS(){return"highlighted"}static get RED_TEXT_CLASS(){return"red-text"}static get _BUTTON_PUSH_DOWN_EVENT_TYPE(){return"mousedown"}static get _BUTTON_RELEASE_EVENT_TYPE(){return"mouseup mouseout"}_readDom(){this._domAgreeSafetyCheckBox=n("#escDshotDirectionDialog-safetyCheckbox"),this._domStartButton=n("#escDshotDirectionDialog-Start"),this._domStartWizardButton=n("#escDshotDirectionDialog-StartWizard"),this._domMainContentBlock=n("#escDshotDirectionDialog-MainContent"),this._domWarningContentBlock=n("#escDshotDirectionDialog-Warning"),this._domMixerImg=n("#escDshotDirectionDialog-MixerPreviewImg"),this._domMotorButtonsBlock=n("#escDshotDirectionDialog-SelectMotorButtonsWrapper"),this._domSpinDirectionWrapper=n("#escDshotDirectionDialog-CommandsWrapper"),this._domActionHint=n("#escDshotDirectionDialog-ActionHint"),this._domSpinNormalButton=n("#escDshotDirectionDialog-RotationNormal"),this._domSpinReverseButton=n("#escDshotDirectionDialog-RotationReverse"),this._domSecondHint=n("#escDshotDirectionDialog-SecondHint"),this._domSecondActionDiv=n("#escDshotDirectionDialog-SecondActionBlock"),this._domConfigErrors=n("#escDshotDirectionDialog-ConfigErrors"),this._domWrongProtocolMessage=n("#escDshotDirectionDialog-WrongProtocol"),this._domWrongMixerMessage=n("#escDshotDirectionDialog-WrongMixer"),this._domWrongFirmwareMessage=n("#escDshotDirectionDialog-WrongFirmware"),this._domWizardBlock=n("#escDshotDirectionDialog-WizardDialog"),this._domNormalDialogBlock=n("#escDshotDirectionDialog-NormalDialog"),this._domSpinningWizard=n("#escDshotDirectionDialog-SpinningWizard"),this._domSpinWizardButton=n("#escDshotDirectionDialog-SpinWizard"),this._domStopWizardButton=n("#escDshotDirectionDialog-StopWizard"),this._domWizardMotorButtonsBlock=n("#escDshotDirectionDialog-WizardMotorButtons"),this._domStartWizardBlock=n("#escDshotDirectionDialog-StartWizardBlock"),this._domStartNormalBlock=n("#escDshotDirectionDialog-StartNormalBlock"),this._topHintText=v.getMessage("escDshotDirectionDialog-SelectMotor"),this._releaseToStopText=v.getMessage("escDshotDirectionDialog-ReleaseToStop"),this._releaseButtonToStopText=v.getMessage("escDshotDirectionDialog-ReleaseButtonToStop"),this._normalText=v.getMessage("escDshotDirectionDialog-CommandNormal"),this._reverseText=v.getMessage("escDshotDirectionDialog-CommandReverse"),this._secondHintText=v.getMessage("escDshotDirectionDialog-SetDirectionHint")}_initializeDialog(){this._readDom(),this._createMotorButtons(),this._createWizardMotorButtons(),this._domSecondActionDiv.toggle(!1),v.localizePage(),this._resetGui(),this._domAgreeSafetyCheckBox.on("change",()=>{const e=this._domAgreeSafetyCheckBox.is(":checked");this._domStartNormalBlock.toggle(e),this._domStartWizardBlock.toggle(e)}),this._domStartButton.on("click",()=>{this._onStartButtonClicked()}),this._domStartWizardButton.on("click",()=>{this._onStartWizardButtonClicked()}),this._domSpinWizardButton.on("click",()=>{this._onSpinWizardButtonClicked()}),this._domStopWizardButton.on("click",()=>{this._onStopWizardButtonClicked()});const t=zt(a.MIXER_CONFIG.mixer,a.MIXER_CONFIG.reverseMotorDir,a.CONFIG.apiVersion);this._domMixerImg.attr("src",t),this._onLoadedCallback()}_activateNormalReverseButtons(t){this._activationButtonTimeoutId=setTimeout(()=>{this._subscribeDirectionSpinButton(this._domSpinNormalButton,G.dshotCommands_e.DSHOT_CMD_SPIN_DIRECTION_1,this._normalText),this._subscribeDirectionSpinButton(this._domSpinReverseButton,G.dshotCommands_e.DSHOT_CMD_SPIN_DIRECTION_2,this._reverseText)},t)}_deactivateNormalReverseButtons(){this._activationButtonTimeoutId!==null&&clearTimeout(this._activationButtonTimeoutId),this._domSpinNormalButton.off(),this._domSpinReverseButton.off()}_subscribeDirectionSpinButton(t,e,s){t.on(N._BUTTON_PUSH_DOWN_EVENT_TYPE,()=>{this._sendCurrentEscSpinDirection(e),this._motorIsSpinning=!0,t.text(this._releaseToStopText),t.addClass(N.HIGHLIGHTED_BUTTON_CLASS),this._motorDriver.spinMotor(this._selectedMotor),this._domSecondHint.html(this._releaseButtonToStopText),this._domSecondHint.addClass(N.RED_TEXT_CLASS)}),t.on(N._BUTTON_RELEASE_EVENT_TYPE,()=>{this._motorIsSpinning&&(t.text(s),this._motorIsSpinning=!1,t.removeClass(N.HIGHLIGHTED_BUTTON_CLASS),this._motorDriver.stopAllMotors(),this._domSecondHint.text(this._secondHintText),this._domSecondHint.removeClass(N.RED_TEXT_CLASS),this._deactivateNormalReverseButtons(),this._activateNormalReverseButtons(this._buttonTimeoutMs))})}_sendCurrentEscSpinDirection(t){this._motorDriver.setEscSpinDirection(this._selectedMotor,t)}_createMotorButtons(){this._motorButtons={};for(let t=0;t<this._numberOfMotors;t++)this._addMotorButton(t+1,t);this._addMotorButton("All",G.ALL_MOTORS)}_addMotorButton(t,e){const s=n(`<a href="#" class="regular-button ${N.PUSHED_BUTTON_CLASS}"></a>`).text(t);this._domMotorButtonsBlock.append(s),this._motorButtons[e]=s,s.on(N._BUTTON_PUSH_DOWN_EVENT_TYPE,()=>{this._domSecondActionDiv.toggle(!0),this._motorIsSpinning=!0,this._domActionHint.html(this._releaseButtonToStopText),this._domActionHint.addClass(N.RED_TEXT_CLASS),this._changeSelectedMotor(e),s.addClass(N.HIGHLIGHTED_BUTTON_CLASS),this._motorDriver.spinMotor(this._selectedMotor)}),s.on(N._BUTTON_RELEASE_EVENT_TYPE,()=>{this._motorIsSpinning&&(this._domActionHint.html(this._topHintText),this._domActionHint.removeClass(N.RED_TEXT_CLASS),this._motorIsSpinning=!1,s.removeClass(N.HIGHLIGHTED_BUTTON_CLASS),this._motorDriver.stopAllMotors(),this._deactivateNormalReverseButtons(),this._activateNormalReverseButtons(this._buttonTimeoutMs))})}_createWizardMotorButtons(){this._wizardMotorButtons={};for(let t=0;t<this._numberOfMotors;t++)this._addWizardMotorButton(t+1,t)}_activateWizardMotorButtons(t){this._activationButtonTimeoutId=setTimeout(()=>{for(let e=0;e<this._numberOfMotors;e++)this._activateWizardMotorButton(e)},t)}_deactivateWizardMotorButtons(){this._activationButtonTimeoutId!==null&&clearTimeout(this._activationButtonTimeoutId);for(let t=0;t<this._numberOfMotors;t++)this._wizardMotorButtons[t].off()}_addWizardMotorButton(t,e){const s=n('<a href="#" class="regular-button"></a>').text(t);this._domWizardMotorButtonsBlock.append(s),this._wizardMotorButtons[e]=s}_activateWizardMotorButton(t){const e=this._wizardMotorButtons[t];e.on("click",()=>{this._wizardMotorButtonClick(e,t)})}_wizardMotorButtonClick(t,e){this._deactivateWizardMotorButtons(),t.hasClass(N.PUSHED_BUTTON_CLASS)?(t.removeClass(N.PUSHED_BUTTON_CLASS),this._motorDriver.setEscSpinDirection(e,G.dshotCommands_e.DSHOT_CMD_SPIN_DIRECTION_1)):(this._motorDriver.setEscSpinDirection(e,G.dshotCommands_e.DSHOT_CMD_SPIN_DIRECTION_2),t.addClass(N.PUSHED_BUTTON_CLASS)),this._activateWizardMotorButtons(this._buttonTimeoutMs)}_changeSelectedMotor(t){this._selectedMotor>=0&&this._motorButtons[this._selectedMotor].addClass(N.PUSHED_BUTTON_CLASS),this._selectedMotor=t,this._selectedMotor>-1&&this._motorButtons[this._selectedMotor].removeClass(N.PUSHED_BUTTON_CLASS)}close(){this._motorDriver.stopAllMotorsNow(),this._motorDriver.deactivate(),this._resetGui()}_resetGui(){this._toggleMainContent(!1),this._domStartNormalBlock.hide(),this._domStartWizardBlock.hide(),this._domAgreeSafetyCheckBox.prop("checked",!1),this._domAgreeSafetyCheckBox.trigger("change"),this._domSecondActionDiv.toggle(!1),this._changeSelectedMotor(-1),this._checkForConfigurationErrors()}_checkForConfigurationErrors(){let t=!1;this._domWrongProtocolMessage.hide(),this._domWrongMixerMessage.hide(),this._domWrongFirmwareMessage.hide(),this._escProtocolIsDshot||(t=!0,this._domWrongProtocolMessage.show()),this._numberOfMotors<=0&&(t=!0,this._domWrongMixerMessage.show()),t?(this._domMainContentBlock.hide(),this._domWarningContentBlock.hide(),this._domStartNormalBlock.hide(),this._domStartWizardBlock.hide(),this._domConfigErrors.show()):this._domConfigErrors.hide()}_onStartButtonClicked(){this._toggleMainContent(!0),this._domWizardBlock.toggle(!1),this._domNormalDialogBlock.toggle(!0),this._motorDriver.activate()}_onStartWizardButtonClicked(){this._domSpinningWizard.toggle(!1),this._domSpinWizardButton.toggle(!0),this._toggleMainContent(!0),this._domWizardBlock.toggle(!0),this._domNormalDialogBlock.toggle(!1),this._motorDriver.activate()}_onSpinWizardButtonClicked(){for(let t=0;t<this._numberOfMotors;t++)this._wizardMotorButtons[t].removeClass(N.PUSHED_BUTTON_CLASS);this._motorDriver.setEscSpinDirection(G.ALL_MOTORS,G.dshotCommands_e.DSHOT_CMD_SPIN_DIRECTION_1),this._domSpinWizardButton.toggle(!1),this._domSpinningWizard.toggle(!0),this._motorDriver.spinAllMotors(),this._activateWizardMotorButtons(0)}_onStopWizardButtonClicked(){this._domSpinWizardButton.toggle(!0),this._domSpinningWizard.toggle(!1),this._motorDriver.stopAllMotorsNow(),this._deactivateWizardMotorButtons()}_toggleMainContent(t){this._domWarningContentBlock.toggle(!t),this._domMainContentBlock.toggle(t),this._domConfigErrors.toggle(!1)}}var Qt={},Pt={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16},ao,Ct,D=typeof process=="object"&&Qt&&Qt.NODE_DEBUG&&/\bsemver\b/i.test(Qt.NODE_DEBUG)?(...i)=>console.error("SEMVER",...i):()=>{},et=(function(i,t){const{MAX_SAFE_COMPONENT_LENGTH:e}=Pt,s=(t=i.exports={}).re=[],o=t.src=[],r=t.t={};let l=0;const c=(p,E,O)=>{const m=l++;D(m,E),r[p]=m,o[m]=E,s[m]=new RegExp(E,O?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*"),c("NUMERICIDENTIFIERLOOSE","[0-9]+"),c("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),c("MAINVERSION",`(${o[r.NUMERICIDENTIFIER]})\\.(${o[r.NUMERICIDENTIFIER]})\\.(${o[r.NUMERICIDENTIFIER]})`),c("MAINVERSIONLOOSE",`(${o[r.NUMERICIDENTIFIERLOOSE]})\\.(${o[r.NUMERICIDENTIFIERLOOSE]})\\.(${o[r.NUMERICIDENTIFIERLOOSE]})`),c("PRERELEASEIDENTIFIER",`(?:${o[r.NUMERICIDENTIFIER]}|${o[r.NONNUMERICIDENTIFIER]})`),c("PRERELEASEIDENTIFIERLOOSE",`(?:${o[r.NUMERICIDENTIFIERLOOSE]}|${o[r.NONNUMERICIDENTIFIER]})`),c("PRERELEASE",`(?:-(${o[r.PRERELEASEIDENTIFIER]}(?:\\.${o[r.PRERELEASEIDENTIFIER]})*))`),c("PRERELEASELOOSE",`(?:-?(${o[r.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[r.PRERELEASEIDENTIFIERLOOSE]})*))`),c("BUILDIDENTIFIER","[0-9A-Za-z-]+"),c("BUILD",`(?:\\+(${o[r.BUILDIDENTIFIER]}(?:\\.${o[r.BUILDIDENTIFIER]})*))`),c("FULLPLAIN",`v?${o[r.MAINVERSION]}${o[r.PRERELEASE]}?${o[r.BUILD]}?`),c("FULL",`^${o[r.FULLPLAIN]}$`),c("LOOSEPLAIN",`[v=\\s]*${o[r.MAINVERSIONLOOSE]}${o[r.PRERELEASELOOSE]}?${o[r.BUILD]}?`),c("LOOSE",`^${o[r.LOOSEPLAIN]}$`),c("GTLT","((?:<|>)?=?)"),c("XRANGEIDENTIFIERLOOSE",o[r.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*"),c("XRANGEIDENTIFIER",o[r.NUMERICIDENTIFIER]+"|x|X|\\*"),c("XRANGEPLAIN",`[v=\\s]*(${o[r.XRANGEIDENTIFIER]})(?:\\.(${o[r.XRANGEIDENTIFIER]})(?:\\.(${o[r.XRANGEIDENTIFIER]})(?:${o[r.PRERELEASE]})?${o[r.BUILD]}?)?)?`),c("XRANGEPLAINLOOSE",`[v=\\s]*(${o[r.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[r.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[r.XRANGEIDENTIFIERLOOSE]})(?:${o[r.PRERELEASELOOSE]})?${o[r.BUILD]}?)?)?`),c("XRANGE",`^${o[r.GTLT]}\\s*${o[r.XRANGEPLAIN]}$`),c("XRANGELOOSE",`^${o[r.GTLT]}\\s*${o[r.XRANGEPLAINLOOSE]}$`),c("COERCE",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?(?:$|[^\\d])`),c("COERCERTL",o[r.COERCE],!0),c("LONETILDE","(?:~>?)"),c("TILDETRIM",`(\\s*)${o[r.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",c("TILDE",`^${o[r.LONETILDE]}${o[r.XRANGEPLAIN]}$`),c("TILDELOOSE",`^${o[r.LONETILDE]}${o[r.XRANGEPLAINLOOSE]}$`),c("LONECARET","(?:\\^)"),c("CARETTRIM",`(\\s*)${o[r.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",c("CARET",`^${o[r.LONECARET]}${o[r.XRANGEPLAIN]}$`),c("CARETLOOSE",`^${o[r.LONECARET]}${o[r.XRANGEPLAINLOOSE]}$`),c("COMPARATORLOOSE",`^${o[r.GTLT]}\\s*(${o[r.LOOSEPLAIN]})$|^$`),c("COMPARATOR",`^${o[r.GTLT]}\\s*(${o[r.FULLPLAIN]})$|^$`),c("COMPARATORTRIM",`(\\s*)${o[r.GTLT]}\\s*(${o[r.LOOSEPLAIN]}|${o[r.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",c("HYPHENRANGE",`^\\s*(${o[r.XRANGEPLAIN]})\\s+-\\s+(${o[r.XRANGEPLAIN]})\\s*$`),c("HYPHENRANGELOOSE",`^\\s*(${o[r.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[r.XRANGEPLAINLOOSE]})\\s*$`),c("STAR","(<|>)?=?\\s*\\*"),c("GTE0","^\\s*>=\\s*0.0.0\\s*$"),c("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}(Ct={path:ao,exports:{},require:function(i,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(t==null&&Ct.path)}},Ct.exports),Ct.exports);const Oe=/^[0-9]+$/,fe=(i,t)=>{const e=Oe.test(i),s=Oe.test(t);return e&&s&&(i=+i,t=+t),i===t?0:e&&!s?-1:s&&!e?1:i<t?-1:1};var Jt={compareIdentifiers:fe,rcompareIdentifiers:(i,t)=>fe(t,i)};const{MAX_LENGTH:Me,MAX_SAFE_INTEGER:vt}=Pt,{re:Ee,t:Te}=et,{compareIdentifiers:gt}=Jt;class X{constructor(t,e){if(e&&typeof e=="object"||(e={loose:!!e,includePrerelease:!1}),t instanceof X){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError("Invalid Version: "+t);if(t.length>Me)throw new TypeError(`version is longer than ${Me} characters`);D("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const s=t.trim().match(e.loose?Ee[Te.LOOSE]:Ee[Te.FULL]);if(!s)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>vt||this.major<0)throw new TypeError("Invalid major version");if(this.minor>vt||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>vt||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(o=>{if(/^[0-9]+$/.test(o)){const r=+o;if(r>=0&&r<vt)return r}return o}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version}toString(){return this.version}compare(t){if(D("SemVer.compare",this.version,this.options,t),!(t instanceof X)){if(typeof t=="string"&&t===this.version)return 0;t=new X(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof X||(t=new X(t,this.options)),gt(this.major,t.major)||gt(this.minor,t.minor)||gt(this.patch,t.patch)}comparePre(t){if(t instanceof X||(t=new X(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const s=this.prerelease[e],o=t.prerelease[e];if(D("prerelease compare",e,s,o),s===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(s===void 0)return-1;if(s!==o)return gt(s,o)}while(++e)}compareBuild(t){t instanceof X||(t=new X(t,this.options));let e=0;do{const s=this.build[e],o=t.build[e];if(D("prerelease compare",e,s,o),s===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(s===void 0)return-1;if(s!==o)return gt(s,o)}while(++e)}inc(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);s===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this}}var x=X;const{MAX_LENGTH:lo}=Pt,{re:De,t:Se}=et;var rt=(i,t)=>{if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),i instanceof x)return i;if(typeof i!="string"||i.length>lo||!(t.loose?De[Se.LOOSE]:De[Se.FULL]).test(i))return null;try{return new x(i,t)}catch{return null}},co=(i,t)=>{const e=rt(i,t);return e?e.version:null},ho=(i,t)=>{const e=rt(i.trim().replace(/^[=v]+/,""),t);return e?e.version:null},_o=(i,t,e,s)=>{typeof e=="string"&&(s=e,e=void 0);try{return new x(i,e).inc(t,s).version}catch{return null}},U=(i,t,e)=>new x(i,e).compare(new x(t,e)),Zt=(i,t,e)=>U(i,t,e)===0,uo=(i,t)=>{if(Zt(i,t))return null;{const e=rt(i),s=rt(t),o=e.prerelease.length||s.prerelease.length,r=o?"pre":"",l=o?"prerelease":"";for(const c in e)if((c==="major"||c==="minor"||c==="patch")&&e[c]!==s[c])return r+c;return l}},mo=(i,t)=>new x(i,t).major,po=(i,t)=>new x(i,t).minor,go=(i,t)=>new x(i,t).patch,Oo=(i,t)=>{const e=rt(i,t);return e&&e.prerelease.length?e.prerelease:null},fo=(i,t,e)=>U(t,i,e),Mo=(i,t)=>U(i,t,!0),te=(i,t,e)=>{const s=new x(i,e),o=new x(t,e);return s.compare(o)||s.compareBuild(o)},Eo=(i,t)=>i.sort((e,s)=>te(e,s,t)),To=(i,t)=>i.sort((e,s)=>te(s,e,t)),Mt=(i,t,e)=>U(i,t,e)>0,yt=(i,t,e)=>U(i,t,e)<0,ye=(i,t,e)=>U(i,t,e)!==0,ee=(i,t,e)=>U(i,t,e)>=0,oe=(i,t,e)=>U(i,t,e)<=0,At=(i,t,e,s)=>{switch(t){case"===":return typeof i=="object"&&(i=i.version),typeof e=="object"&&(e=e.version),i===e;case"!==":return typeof i=="object"&&(i=i.version),typeof e=="object"&&(e=e.version),i!==e;case"":case"=":case"==":return Zt(i,e,s);case"!=":return ye(i,e,s);case">":return Mt(i,e,s);case">=":return ee(i,e,s);case"<":return yt(i,e,s);case"<=":return oe(i,e,s);default:throw new TypeError("Invalid operator: "+t)}};const{re:Nt,t:xt}=et;var Do=(i,t)=>{if(i instanceof x)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;let e=null;if((t=t||{}).rtl){let s;for(;(s=Nt[xt.COERCERTL].exec(i))&&(!e||e.index+e[0].length!==i.length);)e&&s.index+s[0].length===e.index+e[0].length||(e=s),Nt[xt.COERCERTL].lastIndex=s.index+s[1].length+s[2].length;Nt[xt.COERCERTL].lastIndex=-1}else e=i.match(Nt[xt.COERCE]);return e===null?null:rt(`${e[2]}.${e[3]||"0"}.${e[4]||"0"}`,t)};class ft{constructor(t,e){if(e&&typeof e=="object"||(e={loose:!!e,includePrerelease:!1}),t instanceof ft)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new ft(t.raw,e);if(t instanceof nt)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError("Invalid SemVer Range: "+t);this.format()}format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){const e=this.options.loose;t=t.trim();const s=e?b[F.HYPHENRANGELOOSE]:b[F.HYPHENRANGE];t=t.replace(s,bo(this.options.includePrerelease)),D("hyphen replace",t),t=t.replace(b[F.COMPARATORTRIM],So),D("comparator trim",t,b[F.COMPARATORTRIM]),t=(t=(t=t.replace(b[F.TILDETRIM],Io)).replace(b[F.CARETTRIM],Ro)).split(/\s+/).join(" ");const o=e?b[F.COMPARATORLOOSE]:b[F.COMPARATOR];return t.split(" ").map(r=>Co(r,this.options)).join(" ").split(/\s+/).map(r=>Fo(r,this.options)).filter(this.options.loose?r=>!!r.match(o):()=>!0).map(r=>new nt(r,this.options))}intersects(t,e){if(!(t instanceof ft))throw new TypeError("a Range is required");return this.set.some(s=>Ie(s,e)&&t.set.some(o=>Ie(o,e)&&s.every(r=>o.every(l=>r.intersects(l,e)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new x(t,this.options)}catch{return!1}for(let e=0;e<this.set.length;e++)if(Go(this.set[e],t,this.options))return!0;return!1}}var $=ft;const{re:b,t:F,comparatorTrimReplace:So,tildeTrimReplace:Io,caretTrimReplace:Ro}=et,Ie=(i,t)=>{let e=!0;const s=i.slice();let o=s.pop();for(;e&&s.length;)e=s.every(r=>o.intersects(r,t)),o=s.pop();return e},Co=(i,t)=>(D("comp",i,t),i=xo(i,t),D("caret",i),i=vo(i,t),D("tildes",i),i=yo(i,t),D("xrange",i),i=Po(i,t),D("stars",i),i),k=i=>!i||i.toLowerCase()==="x"||i==="*",vo=(i,t)=>i.trim().split(/\s+/).map(e=>No(e,t)).join(" "),No=(i,t)=>{const e=t.loose?b[F.TILDELOOSE]:b[F.TILDE];return i.replace(e,(s,o,r,l,c)=>{let p;return D("tilde",i,s,o,r,l,c),k(o)?p="":k(r)?p=`>=${o}.0.0 <${+o+1}.0.0-0`:k(l)?p=`>=${o}.${r}.0 <${o}.${+r+1}.0-0`:c?(D("replaceTilde pr",c),p=`>=${o}.${r}.${l}-${c} <${o}.${+r+1}.0-0`):p=`>=${o}.${r}.${l} <${o}.${+r+1}.0-0`,D("tilde return",p),p})},xo=(i,t)=>i.trim().split(/\s+/).map(e=>Ao(e,t)).join(" "),Ao=(i,t)=>{D("caret",i,t);const e=t.loose?b[F.CARETLOOSE]:b[F.CARET],s=t.includePrerelease?"-0":"";return i.replace(e,(o,r,l,c,p)=>{let E;return D("caret",i,o,r,l,c,p),k(r)?E="":k(l)?E=`>=${r}.0.0${s} <${+r+1}.0.0-0`:k(c)?E=r==="0"?`>=${r}.${l}.0${s} <${r}.${+l+1}.0-0`:`>=${r}.${l}.0${s} <${+r+1}.0.0-0`:p?(D("replaceCaret pr",p),E=r==="0"?l==="0"?`>=${r}.${l}.${c}-${p} <${r}.${l}.${+c+1}-0`:`>=${r}.${l}.${c}-${p} <${r}.${+l+1}.0-0`:`>=${r}.${l}.${c}-${p} <${+r+1}.0.0-0`):(D("no pr"),E=r==="0"?l==="0"?`>=${r}.${l}.${c}${s} <${r}.${l}.${+c+1}-0`:`>=${r}.${l}.${c}${s} <${r}.${+l+1}.0-0`:`>=${r}.${l}.${c} <${+r+1}.0.0-0`),D("caret return",E),E})},yo=(i,t)=>(D("replaceXRanges",i,t),i.split(/\s+/).map(e=>wo(e,t)).join(" ")),wo=(i,t)=>{i=i.trim();const e=t.loose?b[F.XRANGELOOSE]:b[F.XRANGE];return i.replace(e,(s,o,r,l,c,p)=>{D("xRange",i,s,o,r,l,c,p);const E=k(r),O=E||k(l),m=O||k(c),A=m;return o==="="&&A&&(o=""),p=t.includePrerelease?"-0":"",E?s=o===">"||o==="<"?"<0.0.0-0":"*":o&&A?(O&&(l=0),c=0,o===">"?(o=">=",O?(r=+r+1,l=0,c=0):(l=+l+1,c=0)):o==="<="&&(o="<",O?r=+r+1:l=+l+1),o==="<"&&(p="-0"),s=`${o+r}.${l}.${c}${p}`):O?s=`>=${r}.0.0${p} <${+r+1}.0.0-0`:m&&(s=`>=${r}.${l}.0${p} <${r}.${+l+1}.0-0`),D("xRange return",s),s})},Po=(i,t)=>(D("replaceStars",i,t),i.trim().replace(b[F.STAR],"")),Fo=(i,t)=>(D("replaceGTE0",i,t),i.trim().replace(b[t.includePrerelease?F.GTE0PRE:F.GTE0],"")),bo=i=>(t,e,s,o,r,l,c,p,E,O,m,A,V)=>`${e=k(s)?"":k(o)?`>=${s}.0.0${i?"-0":""}`:k(r)?`>=${s}.${o}.0${i?"-0":""}`:l?">="+e:`>=${e}${i?"-0":""}`} ${p=k(E)?"":k(O)?`<${+E+1}.0.0-0`:k(m)?`<${E}.${+O+1}.0-0`:A?`<=${E}.${O}.${m}-${A}`:i?`<${E}.${O}.${+m+1}-0`:"<="+p}`.trim(),Go=(i,t,e)=>{for(let s=0;s<i.length;s++)if(!i[s].test(t))return!1;if(t.prerelease.length&&!e.includePrerelease){for(let s=0;s<i.length;s++)if(D(i[s].semver),i[s].semver!==nt.ANY&&i[s].semver.prerelease.length>0){const o=i[s].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0},Ot=Symbol("SemVer ANY");class wt{static get ANY(){return Ot}constructor(t,e){if(e&&typeof e=="object"||(e={loose:!!e,includePrerelease:!1}),t instanceof wt){if(t.loose===!!e.loose)return t;t=t.value}D("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===Ot?this.value="":this.value=this.operator+this.semver.version,D("comp",this)}parse(t){const e=this.options.loose?Re[Ce.COMPARATORLOOSE]:Re[Ce.COMPARATOR],s=t.match(e);if(!s)throw new TypeError("Invalid comparator: "+t);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new x(s[2],this.options.loose):this.semver=Ot}toString(){return this.value}test(t){if(D("Comparator.test",t,this.options.loose),this.semver===Ot||t===Ot)return!0;if(typeof t=="string")try{t=new x(t,this.options)}catch{return!1}return At(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof wt))throw new TypeError("a Comparator is required");if(e&&typeof e=="object"||(e={loose:!!e,includePrerelease:!1}),this.operator==="")return this.value===""||new $(t.value,e).test(this.value);if(t.operator==="")return t.value===""||new $(this.value,e).test(t.semver);const s=!(this.operator!==">="&&this.operator!==">"||t.operator!==">="&&t.operator!==">"),o=!(this.operator!=="<="&&this.operator!=="<"||t.operator!=="<="&&t.operator!=="<"),r=this.semver.version===t.semver.version,l=!(this.operator!==">="&&this.operator!=="<="||t.operator!==">="&&t.operator!=="<="),c=At(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),p=At(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return s||o||r&&l||c||p}}var nt=wt;const{re:Re,t:Ce}=et;var tt=(i,t,e)=>{try{t=new $(t,e)}catch{return!1}return t.test(i)},Lo=(i,t)=>new $(i,t).set.map(e=>e.map(s=>s.value).join(" ").trim().split(" ")),ko=(i,t,e)=>{let s=null,o=null,r=null;try{r=new $(t,e)}catch{return null}return i.forEach(l=>{r.test(l)&&(s&&o.compare(l)!==-1||(s=l,o=new x(s,e)))}),s},$o=(i,t,e)=>{let s=null,o=null,r=null;try{r=new $(t,e)}catch{return null}return i.forEach(l=>{r.test(l)&&(s&&o.compare(l)!==1||(s=l,o=new x(s,e)))}),s},Bo=(i,t)=>{i=new $(i,t);let e=new x("0.0.0");if(i.test(e)||(e=new x("0.0.0-0"),i.test(e)))return e;e=null;for(let s=0;s<i.set.length;++s)i.set[s].forEach(o=>{const r=new x(o.semver.version);switch(o.operator){case">":r.prerelease.length===0?r.patch++:r.prerelease.push(0),r.raw=r.format();case"":case">=":e&&!Mt(e,r)||(e=r);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}});return e&&i.test(e)?e:null},Ho=(i,t)=>{try{return new $(i,t).range||"*"}catch{return null}};const{ANY:Uo}=nt;var se=(i,t,e,s)=>{let o,r,l,c,p;switch(i=new x(i,s),t=new $(t,s),e){case">":o=Mt,r=oe,l=yt,c=">",p=">=";break;case"<":o=yt,r=ee,l=Mt,c="<",p="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(tt(i,t,s))return!1;for(let E=0;E<t.set.length;++E){const O=t.set[E];let m=null,A=null;if(O.forEach(V=>{V.semver===Uo&&(V=new nt(">=0.0.0")),m=m||V,A=A||V,o(V.semver,m.semver,s)?m=V:l(V.semver,A.semver,s)&&(A=V)}),m.operator===c||m.operator===p||(!A.operator||A.operator===c)&&r(i,A.semver)||A.operator===p&&l(i,A.semver))return!1}return!0},Vo=(i,t,e)=>se(i,t,">",e),Wo=(i,t,e)=>se(i,t,"<",e),Xo=(i,t,e)=>(i=new $(i,e),t=new $(t,e),i.intersects(t));const{ANY:ve}=nt,jo=(i,t,e)=>{if(i.length===1&&i[0].semver===ve)return t.length===1&&t[0].semver===ve;const s=new Set;let o,r,l,c,p,E,O;for(const m of i)m.operator===">"||m.operator===">="?o=Ne(o,m,e):m.operator==="<"||m.operator==="<="?r=xe(r,m,e):s.add(m.semver);if(s.size>1||o&&r&&(l=U(o.semver,r.semver,e),l>0||l===0&&(o.operator!==">="||r.operator!=="<=")))return null;for(const m of s){if(o&&!tt(m,String(o),e)||r&&!tt(m,String(r),e))return null;for(const A of t)if(!tt(m,String(A),e))return!1;return!0}for(const m of t){if(O=O||m.operator===">"||m.operator===">=",E=E||m.operator==="<"||m.operator==="<=",o){if(m.operator===">"||m.operator===">="){if(c=Ne(o,m,e),c===m)return!1}else if(o.operator===">="&&!tt(o.semver,String(m),e))return!1}if(r){if(m.operator==="<"||m.operator==="<="){if(p=xe(r,m,e),p===m)return!1}else if(r.operator==="<="&&!tt(r.semver,String(m),e))return!1}if(!m.operator&&(r||o)&&l!==0)return!1}return!(o&&E&&!r&&l!==0)&&!(r&&O&&!o&&l!==0)},Ne=(i,t,e)=>{if(!i)return t;const s=U(i.semver,t.semver,e);return s>0?i:s<0||t.operator===">"&&i.operator===">="?t:i},xe=(i,t,e)=>{if(!i)return t;const s=U(i.semver,t.semver,e);return s<0?i:s>0||t.operator==="<"&&i.operator==="<="?t:i};var Yo=(i,t,e)=>{i=new $(i,e),t=new $(t,e);let s=!1;t:for(const o of i.set){for(const r of t.set){const l=jo(o,r,e);if(s=s||l!==null,l)continue t}if(s)return!1}return!0},Ae={re:et.re,src:et.src,tokens:et.t,SEMVER_SPEC_VERSION:Pt.SEMVER_SPEC_VERSION,SemVer:x,compareIdentifiers:Jt.compareIdentifiers,rcompareIdentifiers:Jt.rcompareIdentifiers,parse:rt,valid:co,clean:ho,inc:_o,diff:uo,major:mo,minor:po,patch:go,prerelease:Oo,compare:U,rcompare:fo,compareLoose:Mo,compareBuild:te,sort:Eo,rsort:To,gt:Mt,lt:yt,eq:Zt,neq:ye,gte:ee,lte:oe,cmp:At,coerce:Do,Comparator:nt,Range:$,satisfies:tt,toComparators:Lo,maxSatisfying:ko,minSatisfying:$o,minVersion:Bo,validRange:Ho,outside:se,gtr:Vo,ltr:Wo,intersects:Xo,simplifyRange:(i,t,e)=>{const s=[];let o=null,r=null;const l=i.sort((O,m)=>U(O,m,e));for(const O of l)tt(O,t,e)?(r=O,o||(o=O)):(r&&s.push([o,r]),r=null,o=null);o&&s.push([o,null]);const c=[];for(const[O,m]of s)O===m?c.push(O):m||O!==l[0]?m?O===l[0]?c.push("<="+m):c.push(`${O} - ${m}`):c.push(">="+O):c.push("*");const p=c.join(" || "),E=typeof t.raw=="string"?t.raw:String(t);return p.length<E.length?p:t},subset:Yo},qo=Object.freeze(Object.assign(Object.create(null),Ae,{default:Ae}));const Et={previousDshotBidir:null,previousFilterDynQ:null,previousFilterDynCount:null,analyticsChanges:{},configHasChanged:!1,configChanges:{},feature3DEnabled:!1,sensor:"gyro",sensorGyroRate:20,sensorGyroScale:2e3,sensorAccelRate:20,sensorAccelScale:2,sensorSelectValues:{gyroScale:{1:1,2:2,3:3,4:4,5:5,10:10,25:25,50:50,100:100,200:200,300:300,400:400,500:500,1e3:1e3,2e3:2e3},accelScale:{.05:.05,.1:.1,.2:.2,.3:.3,.4:.4,.5:.5,1:1,2:2}},DSHOT_PROTOCOL_MIN_VALUE:0,DSHOT_DISARMED_VALUE:1e3,DSHOT_MAX_VALUE:2e3,DSHOT_3D_NEUTRAL:1500};Et.initialize=async function(i){const t=this;t.armed=!1,t.escProtocolIsDshot=!1,t.configHasChanged=!1,t.configChanges={};const e=a.getFilterDefaults();Y.active_tab="motors",await S.promise(f.MSP_PID_ADVANCED),await S.promise(f.MSP_FEATURE_CONFIG),await S.promise(f.MSP_MIXER_CONFIG),(a.MOTOR_CONFIG.use_dshot_telemetry||a.MOTOR_CONFIG.use_esc_sensor)&&await S.promise(f.MSP_MOTOR_TELEMETRY),await S.promise(f.MSP_MOTOR_CONFIG),await S.promise(f.MSP_MOTOR_3D_CONFIG),await S.promise(f.MSP2_MOTOR_OUTPUT_REORDERING),await S.promise(f.MSP_ADVANCED_CONFIG),await S.promise(f.MSP_FILTER_CONFIG),await S.promise(f.MSP_ARMING_CONFIG),s();function s(){n("#content").load("./tabs/motors.html",we)}function o(){t.armed=Ke(a.CONFIG.mode,0)}function r(){for(let _=0;_<3;_++)a.SENSOR_DATA.accelerometer[_]=0,a.SENSOR_DATA.gyroscope[_]=0}function l(_){const M=Array.from({length:_});for(let I=0;I<_;I++)M[I]=[],M[I].min=-1,M[I].max=1;return M}function c(_,M,I){for(let g=0;g<_.length;g++){const C=I[g];_[g].push([M,C]),C<_[g].min&&(_[g].min=C),C>_[g].max&&(_[g].max=C)}for(;_[0].length>300;)for(const g of _)g.shift();return M+1}const p={top:20,right:30,bottom:10,left:20};function E(_){_.width=_.targetElement.width()-p.left-p.right,_.height=_.targetElement.height()-p.top-p.bottom,_.widthScale.range([0,_.width]),_.heightScale.range([_.height,0]),_.xGrid.tickSize(-_.height,0,0),_.yGrid.tickSize(-_.width,0,0)}function O(_,M,I){const g={selector:_,targetElement:n(_),dynamicHeightDomain:!I};return g.widthScale=me().clamp(!0).domain([M-299,M]),g.heightScale=me().clamp(!0).domain(I||[1,-1]),g.xGrid=pe(),g.yGrid=ge(),E(g),g.xGrid.scale(g.widthScale).tickSize(-g.height).tickValues(g.widthScale.ticks(5).concat(g.widthScale.domain())).tickFormat(""),g.yGrid.scale(g.heightScale).tickSize(-g.width).tickValues(g.heightScale.ticks(5).concat(g.heightScale.domain())).tickFormat(""),g.xAxis=pe().scale(g.widthScale).ticks(5).tickFormat(function(C){return C}),g.yAxis=ge().scale(g.heightScale).ticks(5).tickFormat(function(C){return C}),g.line=to().x(function(C){return g.widthScale(C[0])}).y(function(C){return g.heightScale(C[1])}),g}function m(_,M,I){const g=eo(_.selector);if(_.dynamicHeightDomain){const B=[];n.each(M,function(q,ht){B.push(ht.min),B.push(ht.max)}),_.heightScale.domain(oo(B))}_.widthScale.domain([I-299,I]),g.select(".x.grid").call(_.xGrid),g.select(".y.grid").call(_.yGrid),g.select(".x.axis").call(_.xAxis),g.select(".y.axis").call(_.yAxis);const j=g.select("g.data").selectAll("path").data(M,function(B,q){return q});j.enter().append("path").attr("class","line"),j.attr("d",_.line)}function A(_){n.get(_,function(M){const I=n(M).find("svg");n(".mixerPreview").html(I)},"xml")}function V(_){const M=zt(_,a.MIXER_CONFIG.reverseMotorDir);A(M);const I=new Kt(100),g=n("#motorOutputReorderDialogOpen"),C=ct[_-1].name in I&&a.MOTOR_OUTPUT_ORDER&&a.MOTOR_OUTPUT_ORDER.length>0;g.toggle(C),t.escProtocolIsDshot=_e.IsProtocolDshot(a.CONFIG.apiVersion,a.PID_ADVANCED_CONFIG.fast_pwm_protocol)}function we(){v.localizePage(),o(),t.feature3DEnabled=a.FEATURE_CONFIG.features.isEnabled("3D");const _=n("#motorsEnableTestMode");t.analyticsChanges={},_.prop("checked",t.armed),a.MOTOR_CONFIG.use_dshot_telemetry||a.MOTOR_CONFIG.use_esc_sensor||n(".motor_testing .telemetry").hide();function M(h=!1){n(".btn .tool").toggleClass("disabled",t.configHasChanged||h),n(".btn .save").toggleClass("disabled",!t.configHasChanged),n(".btn .stop").toggleClass("disabled",!h)}const I={mixer:a.MIXER_CONFIG.mixer,reverseMotorSwitch:a.MIXER_CONFIG.reverseMotorDir,escprotocol:a.PID_ADVANCED_CONFIG.fast_pwm_protocol+1,feature4:a.FEATURE_CONFIG.features.isEnabled("MOTOR_STOP"),feature12:a.FEATURE_CONFIG.features.isEnabled("3D"),feature27:a.FEATURE_CONFIG.features.isEnabled("ESC_SENSOR"),dshotBidir:a.MOTOR_CONFIG.use_dshot_telemetry,motorPoles:a.MOTOR_CONFIG.motor_poles,motorIdle:a.PID_ADVANCED_CONFIG.motorIdle,idleMinRpm:a.ADVANCED_TUNING.idleMinRpm,_3ddeadbandlow:a.MOTOR_3D_CONFIG.deadband3d_low,_3ddeadbandhigh:a.MOTOR_3D_CONFIG.deadband3d_high,_3dneutral:a.MOTOR_3D_CONFIG.neutral,unsyncedPWMSwitch:a.PID_ADVANCED_CONFIG.use_unsyncedPwm,unsyncedpwmfreq:a.PID_ADVANCED_CONFIG.motor_pwm_rate,minthrottle:a.MOTOR_CONFIG.minthrottle,maxthrottle:a.MOTOR_CONFIG.maxthrottle,mincommand:a.MOTOR_CONFIG.mincommand};M();function g(h){if(h.target!==h.currentTarget){const u=h.target.id===""?h.target.name:h.target.id;let d=h.target.type==="checkbox"?h.target.checked:h.target.value;switch(h.target.type){case"checkbox":u==="reverseMotorSwitch"&&(d=d===!1?0:1);break;case"number":d=Ze(d)?parseInt(d):parseFloat(d);break;case"select-one":d=parseInt(d);break;default:console.log(`Undefined case ${h.target.type} encountered, please check code`)}t.configChanges[u]=d,u in I?d!==I[u]?t.configHasChanged=!0:(delete t.configChanges[u],Object.keys(t.configChanges).length===0&&(console.log("All configuration changes reverted"),t.configHasChanged=!1)):(console.log(`Unknown item ${u} found with type ${h.target.type}, please add to the defaultConfiguration object.`),t.configHasChanged=!0),_.trigger("change"),M()}h.stopPropagation()}document.querySelector(".configuration").addEventListener("change",g);const C=n("select.mixerList");for(let h=0;h<ct.length;h++)ct.forEach(function(u,d){u.pos===h&&C.append(`<option value="${d+1}">${u.name.toUpperCase()}</option>`)});C.sortSelect();function j(){const h=zt(a.MIXER_CONFIG.mixer,a.MIXER_CONFIG.reverseMotorDir);A(h)}const B=n("#reverseMotorSwitch");B.change(function(){a.MIXER_CONFIG.reverseMotorDir=n(this).prop("checked")?1:0,j()}),B.prop("checked",a.MIXER_CONFIG.reverseMotorDir!==0).change(),C.change(function(){const h=parseInt(n(this).val());let u;h!==a.MIXER_CONFIG.mixer&&(u=n(this).find("option:selected").text()),t.analyticsChanges.Mixer=u,a.MIXER_CONFIG.mixer=h,j()}),C.val(a.MIXER_CONFIG.mixer).change();function q(){S.promise(f.MSP_MOTOR).then(()=>{const h=a.MIXER_CONFIG.mixer,u=ct[h-1].motors;t.numberOfValidOutputs=a.MOTOR_CONFIG.motor_count;for(let d=0;d<a.MOTOR_DATA.length;d++)if(a.MOTOR_DATA[d]===0){if(t.numberOfValidOutputs=d,u>t.numberOfValidOutputs&&u>0){const R=v.getMessage("motorsDialogMixerReset",{mixerName:ct[h-1].name,mixerMotors:u,outputs:t.numberOfValidOutputs});Pe(R)}return}})}V(a.MIXER_CONFIG.mixer),a.PID_ADVANCED_CONFIG.fast_pwm_protocol!==9&&q(),r();let _t=0;const Ft=l(3);let bt=O("#graph",_t,[-2,2]),Tt=[0,0,0],ut=0;const Gt=l(3);let Lt=O("#graph",ut,[-2,2]),Dt=[0,0,0];const St=[0,0,0];let kt=!1;const Le=n(".motors-bat-voltage"),ke=n(".motors-bat-mah-drawing"),$e=n(".motors-bat-mah-drawn"),z={x:[],y:[],z:[],rms:[]};n(".plot_control .x, .plot_control .y, .plot_control .z, .plot_control .rms").each(function(){const h=n(this);h.hasClass("x")?z.x.push(h):h.hasClass("y")?z.y.push(h):h.hasClass("z")?z.z.push(h):h.hasClass("rms")&&z.rms.push(h)});function ie(h,u){n('.tab-motors select[name="scale"]').find("option").remove(),n.each(h,function(d,R){n('.tab-motors select[name="scale"]').append(new Option(d,R))}),n('.tab-motors select[name="scale"]').val(u)}function re(h){n('.tab-motors select[name="rate"]').val(h)}n(".tab-motors .sensor select").change(function(){switch(w.motors.sensor=n('.tab-motors select[name="sensor_choice"]').val(),qt({motors_tab_sensor_settings:{sensor:w.motors.sensor}}),w.motors.sensor){case"gyro":ie(w.motors.sensorSelectValues.gyroScale,w.motors.sensorGyroScale),re(w.motors.sensorGyroRate);break;case"accel":ie(w.motors.sensorSelectValues.accelScale,w.motors.sensorAccelScale),re(w.motors.sensorAccelRate);break}n(".tab-motors .rate select:first").change()}),n(".tab-motors .rate select, .tab-motors .scale select").change(function(){const h=parseInt(n('.tab-motors select[name="rate"]').val(),10),u=parseFloat(n('.tab-motors select[name="scale"]').val());switch(Y.interval_kill_all(["motor_and_status_pull","motors_power_data_pull_slow"]),w.motors.sensor){case"gyro":qt({motors_tab_gyro_settings:{rate:h,scale:u}}),w.motors.sensorGyroRate=h,w.motors.sensorGyroScale=u,bt=O("#graph",_t,[-u,u]),Y.interval_add("IMU_pull",function(){S.send_message(f.MSP_RAW_IMU,!1,!1,R)},h,!0);break;case"accel":qt({motors_tab_accel_settings:{rate:h,scale:u}}),w.motors.sensorAccelRate=h,w.motors.sensorAccelScale=u,Lt=O("#graph",ut,[-u,u]),Y.interval_add("IMU_pull",function(){S.send_message(f.MSP_RAW_IMU,!1,!1,d)},h,!0);break}function d(){if(!kt){for(let T=0;T<3;T++)St[T]=a.SENSOR_DATA.accelerometer[T]*-1;kt=!0}const y=[St[0]+a.SENSOR_DATA.accelerometer[0],St[1]+a.SENSOR_DATA.accelerometer[1],St[2]+a.SENSOR_DATA.accelerometer[2]];E(Lt),ut=c(Gt,ut,y),m(Lt,Gt,ut);for(let T=0;T<3;T++)Math.abs(y[T])>Math.abs(Dt[T])&&(Dt[T]=y[T]);L(y,Gt,Dt)}function R(){const y=[a.SENSOR_DATA.gyroscope[0],a.SENSOR_DATA.gyroscope[1],a.SENSOR_DATA.gyroscope[2]];E(bt),_t=c(Ft,_t,y),m(bt,Ft,_t);for(let T=0;T<3;T++)Math.abs(y[T])>Math.abs(Tt[T])&&(Tt[T]=y[T]);L(y,Ft,Tt)}function L(y,T,Q){let P=0;for(let H=0,jt=T.length;H<jt;H++)for(let at=0,Yt=T[H].length;at<Yt;at++)P+=T[H][at][1]*T[H][at][1];const it=Math.sqrt(P/(T[0].length+T[1].length+T[2].length));z.x[0].text(`${y[0].toFixed(2)} ( ${Q[0].toFixed(2)} )`),z.y[0].text(`${y[1].toFixed(2)} ( ${Q[1].toFixed(2)} )`),z.z[0].text(`${y[2].toFixed(2)} ( ${Q[2].toFixed(2)} )`),z.rms[0].text(it.toFixed(4))}});const J=ze(["motors_tab_sensor_settings","motors_tab_gyro_settings","motors_tab_accel_settings"]);J.motors_tab_sensor_settings&&n('.tab-motors select[name="sensor_choice"]').val(J.motors_tab_sensor_settings.sensor),J.motors_tab_gyro_settings&&(w.motors.sensorGyroRate=J.motors_tab_gyro_settings.rate,w.motors.sensorGyroScale=J.motors_tab_gyro_settings.scale),J.motors_tab_accel_settings&&(w.motors.sensorAccelRate=J.motors_tab_accel_settings.rate,w.motors.sensorAccelScale=J.motors_tab_accel_settings.scale),n(".tab-motors .sensor select:first").change();function Be(){a.ANALOG.last_received_timestamp&&(Le.text(v.getMessage("motorsVoltageValue",[a.ANALOG.voltage])),ke.text(v.getMessage("motorsADrawingValue",[a.ANALOG.amperage.toFixed(2)])),$e.text(v.getMessage("motorsmAhDrawnValue",[a.ANALOG.mAhdrawn])))}Y.interval_add("motors_power_data_pull_slow",Be,250,!0),n("a.reset_max").click(function(){Tt=[0,0,0],Dt=[0,0,0],kt=!1});let ot,It,$t;t.escProtocolIsDshot?(ot=t.DSHOT_DISARMED_VALUE,It=t.DSHOT_MAX_VALUE,$t=t.DSHOT_3D_NEUTRAL):(ot=a.MOTOR_CONFIG.mincommand,It=a.MOTOR_CONFIG.maxthrottle,$t=a.MOTOR_3D_CONFIG.neutral>1575||a.MOTOR_3D_CONFIG.neutral<1425?1500:a.MOTOR_3D_CONFIG.neutral);let st=ot;t.feature3DEnabled&&(st=$t);const Bt=n(".motors .bar-wrapper");for(let h=0;h<8;h++)Bt.append(`                <div class="m-block motor-${h}">                <div class="meter-bar">                <div class="label"></div>                <div class="indicator">                <div class="label">                <div class="label"></div>                </div>                </div>                </div>                </div>            `);n("div.sliders input").prop("min",ot).prop("max",It),n("div.values li:not(:last)").text(ot);const Ht=n(".tab-motors .features");a.FEATURE_CONFIG.features.generateElements(Ht);const He=_e.GetAvailableProtocols(a.CONFIG.apiVersion),dt=n("select.escprotocol");He.forEach((h,u)=>{const d=h!=="DISABLED"&&a.CONFIG.buildOptions.length&&!a.CONFIG.buildOptions.some(L=>h.includes(L.substring(4)))?"disabled":"",R=`<option value="${u+1}" ${d}>${h}</option>`;dt.append(R)}),dt.sortSelect("DISABLED");const Rt=n("input[id='unsyncedPWMSwitch']"),Ut=n("div.unsyncedpwmfreq");Rt.on("change",function(){n(this).is(":checked")?Ut.show():Ut.hide()});const mt=n('input[id="dshotBidir"]');Rt.prop("checked",a.PID_ADVANCED_CONFIG.use_unsyncedPwm!==0).trigger("change"),n('input[name="unsyncedpwmfreq"]').val(a.PID_ADVANCED_CONFIG.motor_pwm_rate),n('input[name="motorIdle"]').val(a.PID_ADVANCED_CONFIG.motorIdle),n('input[name="idleMinRpm"]').val(a.ADVANCED_TUNING.idleMinRpm),mt.prop("checked",a.MOTOR_CONFIG.use_dshot_telemetry).trigger("change"),t.previousDshotBidir=a.MOTOR_CONFIG.use_dshot_telemetry,t.previousFilterDynQ=a.FILTER_CONFIG.dyn_notch_q,t.previousFilterDynCount=a.FILTER_CONFIG.dyn_notch_count,mt.on("change",function(){const h=mt.is(":checked"),u=h!==a.MOTOR_CONFIG.use_dshot_telemetry?"On":"Off";t.analyticsChanges.BidirectionalDshot=u,a.MOTOR_CONFIG.use_dshot_telemetry=h;const d=a.FILTER_CONFIG.gyro_rpm_notch_harmonics===0;a.FILTER_CONFIG.dyn_notch_count=t.previousFilterDynCount,a.FILTER_CONFIG.dyn_notch_q=t.previousFilterDynQ;const R={title:v.getMessage("dialogDynFiltersChangeTitle"),text:v.getMessage("dialogDynFiltersChangeNote"),buttonYesText:v.getMessage("presetsWarningDialogYesButton"),buttonNoText:v.getMessage("presetsWarningDialogNoButton"),buttonYesCallback:()=>L(),buttonNoCallback:null},L=function(){a.MOTOR_CONFIG.use_dshot_telemetry&&!t.previousDshotBidir?(a.FILTER_CONFIG.dyn_notch_count=e.dyn_notch_count_rpm,a.FILTER_CONFIG.dyn_notch_q=e.dyn_notch_q_rpm):!a.MOTOR_CONFIG.use_dshot_telemetry&&t.previousDshotBidir&&(a.FILTER_CONFIG.dyn_notch_count=e.dyn_notch_count,a.FILTER_CONFIG.dyn_notch_q=e.dyn_notch_q)};a.MOTOR_CONFIG.use_dshot_telemetry!==t.previousDshotBidir&&!d?Y.showYesNoDialog(R):(a.FILTER_CONFIG.dyn_notch_count=t.previousFilterDynCount,a.FILTER_CONFIG.dyn_notch_q=t.previousFilterDynQ)}),n('input[name="motorPoles"]').val(a.MOTOR_CONFIG.motor_poles);function Vt(){const h=n("select.escprotocol option:selected").text(),u=h!=="DISABLED";let d=!1;switch(h){case"DSHOT150":case"DSHOT300":case"DSHOT600":case"PROSHOT1000":d=!0;break}const R=u&&!d,L=u&&d,y=d&&mt.is(":checked")||n("input[name='ESC_SENSOR']").is(":checked"),T=a.MOTOR_CONFIG.use_dshot_telemetry,Q=a.ADVANCED_TUNING.idleMinRpm;n("div.minthrottle").toggle(R&&qo.lt(a.CONFIG.apiVersion,Je)),n("div.maxthrottle").toggle(R),n("div.mincommand").toggle(R),n("div.checkboxPwm").toggle(R),Ut.toggle(R),n("div.motorIdle").toggle(u||L&&T&&Q),n("div.idleMinRpm").toggle(u&&d&&T),n(".escSensor").toggle(L),n("div.checkboxDshotBidir").toggle(L),n("div.motorPoles").toggle(u&&y),n(".escMotorStop").toggle(u).find("input#feature4").attr("disabled",a.FEATURE_CONFIG.features.isEnabled("AIRMODE")).parent().toggleClass("switchery-disabled",a.FEATURE_CONFIG.features.isEnabled("AIRMODE")),n("#escProtocolDisabled").toggle(!u),Rt.trigger("change")}dt.val(a.PID_ADVANCED_CONFIG.fast_pwm_protocol+1),dt.on("change",function(){const h=parseInt(n(this).val())-1;let u;h!==a.PID_ADVANCED_CONFIG.fast_pwm_protocol&&(u=n(this).find("option:selected").text()),t.analyticsChanges.EscProtocol=u,Vt()}).trigger("change"),mt.change(Vt).trigger("change"),n("input[name='ESC_SENSOR']").on("change",Vt).trigger("change"),n('input[name="minthrottle"]').val(a.MOTOR_CONFIG.minthrottle),n('input[name="maxthrottle"]').val(a.MOTOR_CONFIG.maxthrottle),n('input[name="mincommand"]').val(a.MOTOR_CONFIG.mincommand),n(".tab-motors ._3d").show(),n('input[name="_3ddeadbandlow"]').val(a.MOTOR_3D_CONFIG.deadband3d_low),n('input[name="_3ddeadbandhigh"]').val(a.MOTOR_3D_CONFIG.deadband3d_high),n('input[name="_3dneutral"]').val(a.MOTOR_3D_CONFIG.neutral);function ne(){a.FEATURE_CONFIG.features.isEnabled("3D")?n("._3dSettings").show():n("._3dSettings").hide()}n("input.feature",Ht).on("change",function(){const h=n(this);switch(a.FEATURE_CONFIG.features.updateData(h),ue(a.FEATURE_CONFIG.features),h.attr("name")){case"MOTOR_STOP":break;case"3D":ne();break}}),n(Ht).filter("select").change(function(){const h=n(this);a.FEATURE_CONFIG.features.updateData(h),ue(a.FEATURE_CONFIG.features)}),ne();function ae(){n("div.sliders input").val(st)}function Ue(h){h&&!t.armed?(n("div.sliders input").slice(0,t.numberOfValidOutputs).prop("disabled",!1),n("div.sliders input:last").prop("disabled",!1)):(ae(),n("div.sliders input").prop("disabled",!0)),n("div.sliders input").trigger("input")}ae();const Ve=["PageUp","PageDown","End","Home","ArrowUp","ArrowDown","AltLeft","AltRight"];_.on("change",function(){let h=_.is(":checked");if(t.configHasChanged){if(h){const d=v.getMessage("motorsDialogSettingsChanged");Fe(d),h=!1}_.prop("checked",!1)}function u(d){_.is(":checked")&&(Ve.includes(d.code)||(_.prop("checked",!1).trigger("change"),document.removeEventListener("keydown",R=>u(R))))}if(h){const d=[];d.push8(G.dshotCommandType_e.DSHOT_CMD_TYPE_BLOCKING),d.push8(255),d.push8(1),d.push8(13),S.send_message(f.MSP2_SEND_DSHOT_COMMAND,d),document.addEventListener("keydown",R=>u(R))}M(h),Ue(h),n("div.sliders input").trigger("input"),W.setArmingEnabled(h,h)});let Wt=[],Xt=!1;n("div.sliders input:not(.master)").on("input",function(){const h=n(this).index();let u=[];n("div.values li").eq(h).text(n(this).val());for(let d=0;d<t.numberOfValidOutputs;d++){const R=parseInt(n("div.sliders input").eq(d).val());u.push16(R)}Wt.push(u),Xt||(Xt=setTimeout(function(){u=Wt.pop(),S.send_message(f.MSP_SET_MOTOR,u),Wt=[],Xt=!1},10))}),n("div.sliders input:not(.master)").on("input wheel",function(h){t.scrollSlider(n(this),h)}),n("div.sliders input.master").on("input",function(){const h=n(this).val();n("div.sliders input:not(:disabled, :last)").val(h),n("div.values li:not(:last)").slice(0,t.numberOfValidOutputs).text(h),n("div.sliders input:not(:last):first").trigger("input")}),n("div.sliders input.master").on("input wheel",function(h){t.scrollSlider(n(this),h)});let pt=!1;for(let h=0;h<t.numberOfValidOutputs;h++)t.feature3DEnabled?(a.MOTOR_DATA[h]<a.MOTOR_3D_CONFIG.deadband3d_low||a.MOTOR_DATA[h]>a.MOTOR_3D_CONFIG.deadband3d_high)&&(pt=!0):a.MOTOR_DATA[h]>st&&(pt=!0);if(pt=pt&&!a.CONFIG.armingDisabled,pt){_.prop("checked",!0).trigger("change");const h=n("div.sliders input:not(.master)");let u=a.MOTOR_DATA[0];for(let d=0;d<a.MOTOR_DATA.length;d++)a.MOTOR_DATA[d]>0&&(h.eq(d).val(a.MOTOR_DATA[d]),u!==a.MOTOR_DATA[d]&&(u=!1));h.trigger("input"),u&&n("div.sliders input.master").val(u).trigger("input")}else a.MOTOR_DATA.fill(st);function We(){S.send_message(f.MSP_MOTOR,!1,!1,Xe)}function Xe(){a.MOTOR_CONFIG.use_dshot_telemetry||a.MOTOR_CONFIG.use_esc_sensor?S.send_message(f.MSP_MOTOR_TELEMETRY,!1,!1,ce):ce()}function je(){const h=[],u=_.is(":checked");for(let d=0;d<t.numberOfValidOutputs;d++)h[d]=u?a.MOTOR_DATA[d]:st;return h}const le=It-ot;function ce(){const h=t.armed,u=n("div.m-block:first").height(),d=je(),R=6,L=100;let y=0,T=d.every((P,it,H)=>P===H[0]),Q=!1;for(let P=0;P<d.length;P++){const it=d[P],H=it-ot,jt=u-(H*(u/le)).clamp(0,u),at=(H*(u/le)).clamp(0,u),Yt=parseInt(H*.009);if(n(`.motor-${P} .label`,Bt).text(it),n(`.motor-${P} .indicator`,Bt).css({"margin-top":`${jt}px`,height:`${at}px`,"background-color":`rgba(255,187,0,1.${Yt})`}),P<a.MOTOR_CONFIG.motor_count&&(a.MOTOR_CONFIG.use_dshot_telemetry||a.MOTOR_CONFIG.use_esc_sensor)){let K=a.MOTOR_TELEMETRY_DATA.rpm[P];K>999999&&(K=`${(K/1e6).toFixed(5-(K/1e6).toFixed(0).toString().length)}M`),T&&(y+=Math.round(K*L)/L),K=K.toString().padStart(R);let lt=v.getMessage("motorsRPM",{motorsRpmValue:K});if(a.MOTOR_CONFIG.use_dshot_telemetry){let Z=a.MOTOR_TELEMETRY_DATA.invalidPercent[P];Q=Z>100;let qe=Q?"warning":"";Z=(Z/100).toFixed(2).toString().padStart(R),lt+=`<br><span class="${qe}">`,lt+=v.getMessage("motorsRPMError",{motorsErrorValue:Z}),lt+="</span>"}if(a.MOTOR_CONFIG.use_dshot_telemetry||a.MOTOR_CONFIG.use_esc_sensor){let Z=a.MOTOR_TELEMETRY_DATA.temperature[P];Z=Z.toString().padStart(R),lt+="<br>",lt+=v.getMessage("motorsESCTemperature",{motorsESCTempValue:Z})}n(`.motor_testing .telemetry .motor-${P}`).html(lt)}}if(a.MOTOR_CONFIG.use_dshot_telemetry&&!Q&&T){const P=(Math.round(y/d.length*L)/L).toFixed(0),it=P.toString().padStart(R),H=v.getMessage("motorsRPM",{motorsRpmValue:it});n(".motor_testing .telemetry .motor-master").html(H)}else n(".motor_testing .telemetry .motor-master").html("");o(),h!==t.armed&&(console.log("arm state change detected"),_.change())}n("a.save").on("click",async function(){Y.interval_kill_all(["motor_and_status_pull","motors_power_data_pull_slow"]),a.MOTOR_CONFIG.minthrottle=parseInt(n('input[name="minthrottle"]').val()),a.MOTOR_CONFIG.maxthrottle=parseInt(n('input[name="maxthrottle"]').val()),a.MOTOR_CONFIG.mincommand=parseInt(n('input[name="mincommand"]').val()),a.MOTOR_CONFIG.motor_poles=parseInt(n('input[name="motorPoles"]').val()),a.MOTOR_3D_CONFIG.deadband3d_low=parseInt(n('input[name="_3ddeadbandlow"]').val()),a.MOTOR_3D_CONFIG.deadband3d_high=parseInt(n('input[name="_3ddeadbandhigh"]').val()),a.MOTOR_3D_CONFIG.neutral=parseInt(n('input[name="_3dneutral"]').val()),a.PID_ADVANCED_CONFIG.fast_pwm_protocol=parseInt(dt.val()-1),a.PID_ADVANCED_CONFIG.use_unsyncedPwm=Rt.is(":checked")?1:0,a.PID_ADVANCED_CONFIG.motor_pwm_rate=parseInt(n('input[name="unsyncedpwmfreq"]').val()),a.PID_ADVANCED_CONFIG.motorIdle=parseFloat(n('input[name="motorIdle"]').val()),await S.promise(f.MSP_SET_FEATURE_CONFIG,W.crunch(f.MSP_SET_FEATURE_CONFIG)),await S.promise(f.MSP_SET_MIXER_CONFIG,W.crunch(f.MSP_SET_MIXER_CONFIG)),await S.promise(f.MSP_SET_MOTOR_CONFIG,W.crunch(f.MSP_SET_MOTOR_CONFIG)),await S.promise(f.MSP_SET_MOTOR_3D_CONFIG,W.crunch(f.MSP_SET_MOTOR_3D_CONFIG)),await S.promise(f.MSP_SET_ADVANCED_CONFIG,W.crunch(f.MSP_SET_ADVANCED_CONFIG)),await S.promise(f.MSP_SET_ARMING_CONFIG,W.crunch(f.MSP_SET_ARMING_CONFIG)),await S.promise(f.MSP_SET_FILTER_CONFIG,W.crunch(f.MSP_SET_FILTER_CONFIG)),de.sendSaveAndChangeEvents(de.EVENT_CATEGORIES.FLIGHT_CONTROLLER,t.analyticsChanges,"motors"),t.analyticsChanges={},t.configHasChanged=!1,W.writeConfiguration(!0)}),n("a.stop").on("click",()=>_.prop("checked",!1).trigger("change")),Y.interval_add("motor_and_status_pull",We,50,!0),be(Ye,st);function Ye(){Ge(he,st)}function he(){Y.content_ready(i)}he()}function Pe(_){const M=n("#dialog-mixer-reset")[0];n("#dialog-mixer-reset-content").html(_),M.hasAttribute("open")||(M.showModal(),n("#dialog-mixer-reset-confirmbtn").click(function(){M.close()}))}function Fe(_){const M=n("#dialog-settings-changed")[0];n("#dialog-settings-changed-content").html(_),M.hasAttribute("open")||(M.showModal(),n("#dialog-settings-reset-confirmbtn").click(function(){w.motors.refresh()}),n("#dialog-settings-changed-confirmbtn").click(function(){M.close()}))}function be(_,M){const I=n("#dialogMotorOutputReorder"),g=M+a.PID_ADVANCED_CONFIG.motorIdle*1e3/100,C=new io(n("#dialogMotorOutputReorderContent"),_,ct[a.MIXER_CONFIG.mixer-1].name,M,g);n("#dialogMotorOutputReorder-closebtn").click(j);function j(){I[0].close(),C.close(),n(document).off("keydown",B)}function B(q){q.which===27&&j()}n("#motorOutputReorderDialogOpen").click(function(){n(document).on("keydown",B),I[0].showModal()})}function Ge(_,M){const I=n("#escDshotDirectionDialog"),g=M+a.PID_ADVANCED_CONFIG.motorIdle*1e3/100,C={numberOfMotors:t.numberOfValidOutputs,motorStopValue:M,motorSpinValue:g,escProtocolIsDshot:t.escProtocolIsDshot},j=new N(n("#escDshotDirectionDialog-Content"),_,C);n("#escDshotDirectionDialog-closebtn").on("click",B);function B(){I[0].close(),j.close(),n(document).off("keydown",q)}function q(ht){ht.which===27&&B()}n("#escDshotDirectionDialog-Open").click(function(){n(document).on("keydown",q),I[0].showModal()}),_()}};Et.refresh=function(i){const t=this;Y.tab_switch_cleanup(function(){t.initialize(),i&&i()})};Et.cleanup=function(i){i&&i()};Et.scrollSlider=function(i,t){var l,c;if(i.prop("disabled")||!((l=t.originalEvent)!=null&&l.deltaY&&((c=t.originalEvent)!=null&&c.altKey)))return;t.preventDefault();const e=25,s=t.originalEvent.deltaY>0?-25:e,o=parseInt(i.val())+s,r=Math.round(o/e)*e;i.val(r),i.trigger("input")};w.motors=Et;export{Et as motors};
