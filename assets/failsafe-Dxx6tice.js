import{G as E,T as K,M as n,X as s,a3 as c,H as r,F as a,a1 as S,$ as e,I as i,a2 as Y,a5 as q}from"./DarkTheme-BPZSaX8v.js";import{a as J}from"./peripherals-BNoTRETP.js";const I={};I.initialize=function(f){E.active_tab!="failsafe"&&(E.active_tab="failsafe");function x(){n.send_message(s.MSP_RX_CONFIG,!1,!1,P)}function P(){n.send_message(s.MSP_FAILSAFE_CONFIG,!1,!1,M)}function M(){n.send_message(s.MSP_RXFAIL_CONFIG,!1,!1,O)}function O(){n.send_message(s.MSP_GPS_RESCUE,!1,!1,N)}function N(){n.send_message(s.MSP_BOXNAMES,!1,!1,U)}function U(){n.send_message(s.MSP_MODE_RANGES,!1,!1,b)}function b(){n.send_message(s.MSP_BOXIDS,!1,!1,y)}function y(){c.loadSerialConfig(w)}function w(){n.send_message(s.MSP_RC,!1,!1,L)}function L(){n.send_message(s.MSP_RSSI_CONFIG,!1,!1,k)}function k(){n.send_message(s.MSP_FEATURE_CONFIG,!1,!1,X)}function X(){n.send_message(s.MSP_MOTOR_CONFIG,!1,!1,T)}function T(){r.gte(a.CONFIG.apiVersion,S)?n.send_message(s.MSP_COMPASS_CONFIG,!1,!1,C):C()}function C(){n.send_message(s.MSP_GPS_CONFIG,!1,!1,$)}function $(){e("#content").load("./tabs/failsafe.html",V)}x();function V(){function D(t){e("div.stage2").show()}const G=e("div.oldpane");G.prop("disabled",!0),G.hide();const p=[];for(let t=0;t<a.RC.active_channels-4;t++)p.push("");typeof a.RSSI_CONFIG.channel<"u"&&(p[a.RSSI_CONFIG.channel-5]+='<span class="modename">RSSI</span>');let h=!1;for(let t=0;t<a.AUX_CONFIG.length;t++){const _=a.AUX_CONFIG_IDS[t];for(let o=0;o<a.MODE_RANGES.length;o++){const d=a.MODE_RANGES[o];if(d.id!=_)continue;const A=d.range;if(A.start>=A.end)continue;let g=a.AUX_CONFIG[t];!h&&g==="GPS RESCUE"&&(h=!0),g=J(_,g),p[d.auxChannelIndex]+=`<span class="modename">${g}</span>`}}const v=[i.getMessage("controlAxisRoll"),i.getMessage("controlAxisPitch"),i.getMessage("controlAxisYaw"),i.getMessage("controlAxisThrottle")],m=e("div.activechannellist");let H=1,B=0;for(let t=0;t<a.RXFAIL_CONFIG.length;t++)if(t<v.length)m.append(`                    <div class="number">                        <div class="channelprimary">                            <span>${v[t]}</span>                        </div>                        <div class="cf_tip channelsetting" title="${i.getMessage("failsafeChannelFallbackSettingsAuto")}">                            <select class="aux_set" id="${t}">                                <option value="0">${i.getMessage("failsafeChannelFallbackSettingsValueAuto")}</option>                                <option value="1">${i.getMessage("failsafeChannelFallbackSettingsValueHold")}</option>                                <option value="2">${i.getMessage("failsafeChannelFallbackSettingsValueSet")}</option>                            </select>                        </div>                        <div class="auxiliary"><input type="number" name="aux_value" min="750" max="2250" step="25" id="${t}"/></div>                    </div>                `);else{const _=`controlAxisAux${H++}`;m.append(`                    <div class="number">                        <div class="channelauxiliary">                            <span class="channelname">${i.getMessage(_)}</span>                            ${p[B++]}                        </div>                        <div class="cf_tip channelsetting" title="${i.getMessage("failsafeChannelFallbackSettingsHold")}">                            <select class="aux_set" id="${t}">                                <option value="1">${i.getMessage("failsafeChannelFallbackSettingsValueHold")}</option>                                <option value="2">${i.getMessage("failsafeChannelFallbackSettingsValueSet")}</option>                            </select>                        </div>                        <div class="auxiliary"><input type="number" name="aux_value" min="750" max="2250" step="25" id="${t}"/></div>                    </div>                `)}const F=[];e(".number",m).each(function(){F.push(e("select.aux_set",this))});const u=[];e(".number",m).each(function(){u.push(e('input[name="aux_value"]',this))});const W=e("select.aux_set"),z=e('input[name="aux_value"]');W.change(function(){const t=parseInt(e(this).val()),_=parseInt(e(this).prop("id"));a.RXFAIL_CONFIG[_].mode=t,t==2?(u[_].prop("disabled",!1),u[_].show()):(u[_].prop("disabled",!0),u[_].hide())}),z.change(function(){const t=parseInt(e(this).prop("id"));a.RXFAIL_CONFIG[t].value=parseInt(e(this).val())}),e('input[name="rx_min_usec"]').val(a.RX_CONFIG.rx_min_usec),e('input[name="rx_max_usec"]').val(a.RX_CONFIG.rx_max_usec);for(let t=0;t<a.RXFAIL_CONFIG.length;t++)u[t].val(a.RXFAIL_CONFIG[t].value),F[t].val(a.RXFAIL_CONFIG[t].mode),F[t].change();a.FEATURE_CONFIG.features.generateElements(e(".tab-failsafe .featuresNew")),e("tbody.rxFailsafe").hide(),D(),e('input[name="failsafe_throttle"]').val(a.FAILSAFE_CONFIG.failsafe_throttle),e('input[name="failsafe_off_delay"]').val((a.FAILSAFE_CONFIG.failsafe_off_delay/10).toFixed(1)),e('input[name="failsafe_throttle_low_delay"]').val((a.FAILSAFE_CONFIG.failsafe_throttle_low_delay/10).toFixed(1)),e('input[name="failsafe_delay"]').val((a.FAILSAFE_CONFIG.failsafe_delay/10).toFixed(1));const j=e('input[id="gps_rescue"]').parent().parent().find(":input");e('input[type="radio"].procedure').on("change",function(){e(".proceduresettings :input").attr("disabled",!0),e(this).parent().parent().find(":input").attr("disabled",!1),h&&j.attr("disabled",!1)});let l;switch(a.FAILSAFE_CONFIG.failsafe_procedure){case 0:l=e('input[id="land"]'),l.prop("checked",!0),l.trigger("change");break;case 1:l=e('input[id="drop"]'),l.prop("checked",!0),l.trigger("change");break;case 2:l=e('input[id="gps_rescue"]'),l.prop("checked",!0),l.trigger("change");break}e("#failsafeSwitchSelect").sortSelect(i.getMessage("failsafeSwitchOptionStage1")),e('select[name="failsafe_switch_mode"]').val(a.FAILSAFE_CONFIG.failsafe_switch_mode),e("div.kill_switch").hide(),e('input[name="gps_rescue_angle"]').val(a.GPS_RESCUE.angle),e('input[name="gps_rescue_return_altitude"]').val(a.GPS_RESCUE.returnAltitudeM),e('input[name="gps_rescue_descent_distance"]').val(a.GPS_RESCUE.descentDistanceM),e('input[name="gps_rescue_ground_speed"]').val((a.GPS_RESCUE.groundSpeed/100).toFixed(1)),e('input[name="gps_rescue_throttle_min"]').val(a.GPS_RESCUE.throttleMin),e('input[name="gps_rescue_throttle_max"]').val(a.GPS_RESCUE.throttleMax),e('input[name="gps_rescue_throttle_hover"]').val(a.GPS_RESCUE.throttleHover),e('input[name="gps_rescue_min_sats"]').val(a.GPS_RESCUE.minSats),e("#failsafeGpsRescueItemSanitySelect").sortSelect(),e('select[name="gps_rescue_sanity_checks"]').val(a.GPS_RESCUE.sanityChecks),e("#failsafeGpsRescueItemAltitudeSelect").sortSelect();function R(){let t=e('input[name="gps_rescue_return_altitude"]').closest(".number");e("#failsafeGpsRescueItemAltitudeSelect").val()==="1"?t.show():t.hide()}R(),e("#failsafeGpsRescueItemAltitudeSelect").on("change",R),e('input[name="gps_rescue_ascend_rate"]').val((a.GPS_RESCUE.ascendRate/100).toFixed(1)),e('input[name="gps_rescue_descend_rate"]').val((a.GPS_RESCUE.descendRate/100).toFixed(1)),e('input[name="gps_rescue_allow_arming_without_fix"]').prop("checked",a.GPS_RESCUE.allowArmingWithoutFix>0),e('select[name="gps_rescue_altitude_mode"]').val(a.GPS_RESCUE.altitudeMode),e('input[name="gps_rescue_min_start_dist"]').val(a.GPS_RESCUE.minStartDistM),r.gte(a.CONFIG.apiVersion,Y)&&(e('input[name="gps_rescue_angle"]').attr("max",80),e('input[name="gps_rescue_return_altitude"]').attr({min:2,max:255}),e('input[name="gps_rescue_descent_distance"]').attr("min",5),e('input[name="gps_rescue_min_start_dist"]').attr("min",20),e('input[name="gps_rescue_ground_speed"]').attr("min",0),e('input[name="gps_rescue_ascend_rate"]').attr("min",.5),e('input[name="gps_rescue_descend_rate"]').attr("min",.3)),r.gte(a.CONFIG.apiVersion,S)?e('input[name="gps_rescue_initial_climb"]').val(a.GPS_RESCUE.initialClimbM):e('input[name="gps_rescue_initial_climb"]').closest(".number").hide(),r.gte(a.CONFIG.apiVersion,S)&&(e('input[name="gps_rescue_angle"]').attr({min:30,max:60}),e('input[name="gps_rescue_return_altitude"]').attr({min:5,max:1e3}),e('input[name="gps_rescue_descent_distance"]').attr("min",10),e('input[name="gps_rescue_min_start_dist"]').attr({min:10,max:30}).closest(".number").children(".helpicon").attr("i18n_title","failsafeGpsRescueItemMinStartDistHelp"),e('input[name="gps_rescue_descend_rate"]').attr({min:.2,max:50})),r.gte(a.CONFIG.apiVersion,q)&&e('input[name="failsafe_off_delay"]').attr({max:250}),e("a.save").click(function(){a.FEATURE_CONFIG.features.updateData(e('input[name="FAILSAFE"]')),a.RX_CONFIG.rx_min_usec=parseInt(e('input[name="rx_min_usec"]').val()),a.RX_CONFIG.rx_max_usec=parseInt(e('input[name="rx_max_usec"]').val()),a.FAILSAFE_CONFIG.failsafe_throttle=parseInt(e('input[name="failsafe_throttle"]').val()),a.FAILSAFE_CONFIG.failsafe_off_delay=Math.round(10*parseFloat(e('input[name="failsafe_off_delay"]').val())),a.FAILSAFE_CONFIG.failsafe_throttle_low_delay=Math.round(10*parseFloat(e('input[name="failsafe_throttle_low_delay"]').val())),a.FAILSAFE_CONFIG.failsafe_delay=Math.round(10*parseFloat(e('input[name="failsafe_delay"]').val())),e('input[id="land"]').is(":checked")?a.FAILSAFE_CONFIG.failsafe_procedure=0:e('input[id="drop"]').is(":checked")?a.FAILSAFE_CONFIG.failsafe_procedure=1:e('input[id="gps_rescue"]').is(":checked")&&(a.FAILSAFE_CONFIG.failsafe_procedure=2),a.FAILSAFE_CONFIG.failsafe_switch_mode=e('select[name="failsafe_switch_mode"]').val(),a.GPS_RESCUE.angle=e('input[name="gps_rescue_angle"]').val(),a.GPS_RESCUE.returnAltitudeM=e('input[name="gps_rescue_return_altitude"]').val(),a.GPS_RESCUE.descentDistanceM=e('input[name="gps_rescue_descent_distance"]').val(),a.GPS_RESCUE.groundSpeed=e('input[name="gps_rescue_ground_speed"]').val()*100,a.GPS_RESCUE.throttleMin=e('input[name="gps_rescue_throttle_min"]').val(),a.GPS_RESCUE.throttleMax=e('input[name="gps_rescue_throttle_max"]').val(),a.GPS_RESCUE.throttleHover=e('input[name="gps_rescue_throttle_hover"]').val(),a.GPS_RESCUE.minSats=e('input[name="gps_rescue_min_sats"]').val(),a.GPS_RESCUE.sanityChecks=e('select[name="gps_rescue_sanity_checks"]').val(),a.GPS_RESCUE.ascendRate=e('input[name="gps_rescue_ascend_rate"]').val()*100,a.GPS_RESCUE.descendRate=e('input[name="gps_rescue_descend_rate"]').val()*100,a.GPS_RESCUE.allowArmingWithoutFix=e('input[name="gps_rescue_allow_arming_without_fix"]').prop("checked")?1:0,a.GPS_RESCUE.altitudeMode=parseInt(e('select[name="gps_rescue_altitude_mode"]').val()),a.GPS_RESCUE.minStartDistM=e('input[name="gps_rescue_min_start_dist"]').val(),r.gte(a.CONFIG.apiVersion,S)&&(a.GPS_RESCUE.initialClimbM=e('input[name="gps_rescue_initial_climb"]').val());function t(){n.send_message(s.MSP_SET_FAILSAFE_CONFIG,c.crunch(s.MSP_SET_FAILSAFE_CONFIG),!1,_)}function _(){c.sendRxFailConfig(o)}function o(){n.send_message(s.MSP_SET_FEATURE_CONFIG,c.crunch(s.MSP_SET_FEATURE_CONFIG),!1,d)}function d(){n.send_message(s.MSP_SET_GPS_RESCUE,c.crunch(s.MSP_SET_GPS_RESCUE),!1,c.writeConfiguration(!0))}n.send_message(s.MSP_SET_RX_CONFIG,c.crunch(s.MSP_SET_RX_CONFIG),!1,t)}),i.localizePage(),E.content_ready(f)}};I.cleanup=function(f){f&&f()};K.failsafe=I;export{I as failsafe};
