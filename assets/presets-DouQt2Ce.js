var si=Object.defineProperty;var ii=(r,e,t)=>e in r?si(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var T=(r,e,t)=>ii(r,typeof e!="symbol"?e+"":e,t);import{g as Xe,s as Qe,V as ls,G as C,C as Z,L as cs,I as w,ai as ni,$ as f,F as Pt,aj as ri,a0 as Je,T as Ie}from"./DarkTheme-DoxdKMtD.js";import{g as oi}from"./generate_filename-BIkfQQdx.js";const ai=50,je="FavoritePresetsList";class li{constructor(e){this.presetPath=e,this.lastPickDate=Date.now()}}class ci{constructor(){this._favoritePresetsList=[]}_sort(){this._favoritePresetsList.sort((e,t)=>e.lastPickDate-t.lastPickDate)}_purgeOldPresets(){this._favoritePresetsList.splice(ai+1,this._favoritePresetsList.length)}loadFromStorage(){this._favoritePresetsList=[];const e=Xe(je);e[je]&&(this._favoritePresetsList=e[je])}saveToStorage(){const e={};e[je]=this._favoritePresetsList,Qe(e)}add(e){let t=this.findPreset(e);return t||(t=new li(e),this._favoritePresetsList.push(t)),t.lastPickDate=Date.now(),this._sort(),this._purgeOldPresets(),t}delete(e){const t=this._favoritePresetsList.findIndex(s=>s.presetPath===e);t>=0&&(this._favoritePresetsList.splice(t,1),this._sort(),this._purgeOldPresets())}findPreset(e){return this._favoritePresetsList.find(t=>t.presetPath===e)}}class hi{constructor(){this._favoritePresetsData=new ci}add(e,t){const s=this._favoritePresetsData.add(t.getPresetOnlineLink(e));e.lastPickDate=s.lastPickDate}delete(e,t){this._favoritePresetsData.delete(t.getPresetOnlineLink(e)),e.lastPickDate=void 0}addLastPickDate(e,t){for(let s of e){let i=this._favoritePresetsData.findPreset(t.getPresetOnlineLink(s));i&&(s.lastPickDate=i.lastPickDate)}}saveToStorage(){this._favoritePresetsData.saveToStorage()}loadFromStorage(){this._favoritePresetsData.loadFromStorage()}}let se;se||(se=new hi,se.loadFromStorage());class E{constructor(e){this._currentTab=e,this._lineDelayMs=15,this._profileSwitchDelayMs=100,this._cliBuffer="",this._window=null,this._windowWrapper=null,this._cliErrorsCount=0,this._sendCommandsProgress=0,this._onSendCommandsProgressChange=void 0,this._responseCallback=void 0,this._onRowCameCallback=void 0}setUi(e,t,s){this._window=e,this._windowWrapper=t,this._setTextareaListen(s)}get errorsCount(){return this._cliErrorsCount}setProgressCallback(e){this._onSendCommandsProgressChange=e}_reportSendCommandsProgress(e){var t;this._sendCommandsProgress=e,(t=this._onSendCommandsProgressChange)==null||t.call(this,e)}enterCliMode(){const e=new ArrayBuffer(1),t=new Uint8Array(e);this.cliBuffer="",t[0]=35,ls.send(e)}_setTextareaListen(e){e.keydown(t=>{t.which===E.s_tabCode&&t.preventDefault()}),e.keypress(t=>{if(t.which===E.s_enterKeyCode){t.preventDefault();const s=e.val();this.executeCommands(s),e.val("")}}),e.focus()}close(e){this.send(this.getCliCommand("exit\r",""),function(){e&&e()})}executeCommands(e){const t=e.split(`
`);return this.executeCommandsArray(t)}executeCommandsArray(e){this._reportSendCommandsProgress(0);const t=e.length;return e.reduce((s,i,n)=>s.then(o=>new Promise(l=>{C.timeout_add("CLI_send_slowly",()=>{let u=this.lineDelayMs;i=i.trim(),i.toLowerCase().startsWith("profile")&&(u=this.profileSwitchDelayMs),t===n+1&&this.cliBuffer&&(i=this.getCliCommand(i,this.cliBuffer)),this.sendLine(i,()=>{},()=>{l(u),this._reportSendCommandsProgress(100*n/t)})},o)})),Promise.resolve(0)).then(()=>{this._reportSendCommandsProgress(100)})}removePromptHash(e){return e.replace(/^# /,"")}cliBufferCharsToDelete(e,t){let s=0;for(let i=0;i<t.length&&e[i]===t[i];i++)s++;return t.length-s}commandWithBackSpaces(e,t,s){return"".repeat(s)+e.substring(t.length-s,e.length)}getCliCommand(e,t){const s=this.removePromptHash(t),i=new RegExp(`^${s}`,"g");if(e.match(i))return e.replace(i,"");const n=this.cliBufferCharsToDelete(e,s);return this.commandWithBackSpaces(e,s,n)}writeToOutput(e){this._windowWrapper.append(e),this._window.scrollTop(this._windowWrapper.height())}writeLineToOutput(e){var t,s;e.startsWith("###ERROR")?(this.writeToOutput(`<span class="error_message">${e}</span><br>`),this._cliErrorsCount++):this.writeToOutput(`${e}<br>`),(t=this._responseCallback)==null||t.call(this),(s=this._onRowCameCallback)==null||s.call(this,e)}subscribeOnRowCame(e){this._onRowCameCallback=e}unsubscribeOnRowCame(){this._onRowCameCallback=void 0}readSerial(e){const t=new Uint8Array(e.data??e);let s="",i=0;for(const n of t){const o=String.fromCharCode(n);if(!Z.cliEngineValid){s+=o,this.writeToOutput(o);continue}if(n===27&&!i&&(i=3),i){i--;continue}this._adjustCliBuffer(n),this.cliBuffer==="Rebooting"&&E.s_backspaceCode!==n&&(Z.cliEngineActive=!1,Z.cliEngineValid=!1,cs(w.getMessage("cliReboot")),ni())}!Z.cliEngineValid&&s.indexOf("CLI")!==-1&&(cs(w.getMessage("cliEnter")),Z.cliEngineValid=!0)}sendLine(e,t,s){this.send(`${e}
`,t,s)}send(e,t,s){this._responseCallback=s;const i=new ArrayBuffer(e.length),n=new Uint8Array(i);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);ls.send(i,t)}_adjustCliBuffer(e){const t=String.fromCharCode(e);switch(e){case E.s_lineFeedCode:C.operating_system==="Windows"&&(this.writeLineToOutput(this.cliBuffer),this.cliBuffer="");break;case E.s_carriageReturnCode:C.operating_system!=="Windows"&&(this.writeLineToOutput(this.cliBuffer),this.cliBuffer="");break;case 60:this.cliBuffer+="&lt";break;case 62:this.cliBuffer+="&gt";break;case E.s_backspaceCode:this.cliBuffer=this.cliBuffer.slice(0,-1);break;default:this.cliBuffer+=t}}}E.s_backspaceCode=8;E.s_lineFeedCode=10;E.s_carriageReturnCode=13;E.s_tabCode=9;E.s_enterKeyCode=13;E.s_commandDiffAll="diff all";E.s_commandDefaultsNoSave="defaults nosave";E.s_commandSave="save";E.s_commandExit="exit";class Ps{constructor(e,t,s){this.preset=e,this.presetCli=t,this.presetRepo=s}}class ge{constructor(e,t,s,i,n,o,l){ge.s_panelCounter++,this._parentDiv=e,this._onLoadedCallback=o,this._domId=`preset_title_panel_${ge.s_panelCounter}`,this._preset=t,this._presetRepo=s,this._showPresetRepoName=n,this._clickable=i,this._favoritePresets=l,this._parentDiv.append(`<div class="${this._domId}"></div>`),this._domWrapperDiv=f(`.${this._domId}`),this._domWrapperDiv.toggle(!1),this._starJustClicked=!1,this._mouseOnStar=!1,this._mouseOnPanel=!1,this._clickable=i,i&&this._domWrapperDiv.addClass("preset_title_panel_border")}_updateHoverEffects(){let e=!1;this._clickable&&this._mouseOnPanel&&!this._mouseOnStar?this._domWrapperDiv.css({"background-color":"var(--surface-500)"}):this._domWrapperDiv.css({"background-color":"var(--surface-200)"}),this._mouseOnStar||this._mouseOnPanel&&this._clickable?(this._domStar.css({"background-color":"var(--surface-500)"}),e=!0):(this._domWrapperDiv.css({"background-color":"var(--surface-200)"}),this._domStar.css({"background-color":"var(--surface-200)"})),this._preset.lastPickDate?this._domStar.css("background-image","url('../../../images/icons/star_orange.svg')"):e?this._domStar.css("background-image","url('../../../images/icons/star_orange_stroke.svg')"):this._domStar.css("background-image","url('../../../images/icons/star_transparent.svg')")}load(){this._domWrapperDiv.load("./tabs/presets/TitlePanel/PresetTitlePanelBody.html",()=>this._setupHtml())}subscribeClick(e,t){this._domWrapperDiv.on("click",()=>{this._starJustClicked||this._showPresetsDetailedDialog(e,t),this._starJustClicked=!1})}_showPresetsDetailedDialog(e,t){e.open(this._preset,t,this._showPresetRepoName).then(s=>{if(s){const i=this._domWrapperDiv.css("background-color");this._domWrapperDiv.css("background-color","green"),this._domWrapperDiv.animate({backgroundColor:i},2e3),this.setPicked(!0)}this._updateHoverEffects()})}setPicked(e){this._clickable&&(this._preset.isPicked=e,e?this._domWrapperDiv.css({border:"2px solid green"}):this._domWrapperDiv.css({border:"1px solid var(--surface-500)"}))}_setupHtml(){var e,t,s;this._readDom(),this._domCategory.text(this._preset.category),this._domTitle.text(this._preset.title),this._domTitle.prop("title",this._preset.title),this._domAuthor.text(this._preset.author),this._domVersions.text((e=this._preset.firmware_version)==null?void 0:e.join("; ")),this._domSourceRepository.text(this._presetRepo.name),this._domSourceRepositoryRow.toggle(this._showPresetRepoName),this._domKeywords.text((t=this._preset.keywords)==null?void 0:t.join("; ")),this._domKeywords.prop("title",(s=this._preset.keywords)==null?void 0:s.join("; ")),this._domStatusOfficial.toggle(this._preset.status==="OFFICIAL"),this._domStatusCommunity.toggle(this._preset.status==="COMMUNITY"),this._domStatusExperimental.toggle(this._preset.status==="EXPERIMENTAL"),this._domOfficialSourceIcon.toggle(this._presetRepo.official),this.setPicked(this._preset.isPicked),this._setupStar(),this._domWrapperDiv.on("mouseenter",()=>{this._mouseOnPanel=!0,this._updateHoverEffects()}),this._domWrapperDiv.on("mouseleave",()=>{this._mouseOnPanel=!1,this._updateHoverEffects()}),this._domStar.on("mouseenter",()=>{this._mouseOnStar=!0,this._updateHoverEffects()}),this._domStar.on("mouseleave",()=>{this._mouseOnStar=!1,this._updateHoverEffects()}),w.localizePage(),this._domWrapperDiv.toggle(!0),typeof this._onLoadedCallback=="function"&&this._onLoadedCallback()}_readDom(){this._domTitle=this._domWrapperDiv.find(".preset_title_panel_title"),this._domStar=this._domWrapperDiv.find(".preset_title_panel_star"),this._domCategory=this._domWrapperDiv.find(".preset_title_panel_category"),this._domAuthor=this._domWrapperDiv.find(".preset_title_panel_author_text"),this._domKeywords=this._domWrapperDiv.find(".preset_title_panel_keywords_text"),this._domSourceRepository=this._domWrapperDiv.find(".preset_title_panel_repository_text"),this._domSourceRepositoryRow=this._domWrapperDiv.find(".preset_title_panel_repository_row"),this._domVersions=this._domWrapperDiv.find(".preset_title_panel_versions_text"),this._domStatusOfficial=this._domWrapperDiv.find(".preset_title_panel_status_official"),this._domStatusCommunity=this._domWrapperDiv.find(".preset_title_panel_status_community"),this._domStatusExperimental=this._domWrapperDiv.find(".preset_title_panel_status_experimental"),this._domOfficialSourceIcon=this._domWrapperDiv.find(".preset_title_panel_Ovobot_official")}_setupStar(){this._updateHoverEffects(),this._domStar.on("click",()=>{this._starJustClicked=!0,this._processStarClick()})}_processStarClick(){this._preset.lastPickDate?this._favoritePresets.delete(this._preset,this._presetRepo):this._favoritePresets.add(this._preset,this._presetRepo),this._favoritePresets.saveToStorage(),this._updateHoverEffects()}remove(){this._domWrapperDiv.remove()}}ge.s_panelCounter=0;function Dt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let ce=Dt();function vs(r){ce=r}const Oe={exec:()=>null};function x(r,e=""){let t=typeof r=="string"?r:r.source;const s={replace:(i,n)=>{let o=typeof n=="string"?n:n.source;return o=o.replace($.caret,"$1"),t=t.replace(i,o),s},getRegex:()=>new RegExp(t,e)};return s}const $={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},ui=/^(?:[ \t]*(?:\n|$))+/,pi=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,di=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Me=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,fi=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,yt=/(?:[*+-]|\d{1,9}[.)])/,Ts=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Es=x(Ts).replace(/bull/g,yt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),_i=x(Ts).replace(/bull/g,yt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),At=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,gi=/^[^\n]+/,Rt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,mi=x(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Rt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),ki=x(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,yt).getRegex(),it="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ot=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Si=x("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ot).replace("tag",it).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ds=x(At).replace("hr",Me).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",it).getRegex(),bi=x(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ds).getRegex(),Lt={blockquote:bi,code:pi,def:mi,fences:di,heading:fi,hr:Me,html:Si,lheading:Es,list:ki,newline:ui,paragraph:Ds,table:Oe,text:gi},hs=x("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Me).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",it).getRegex(),wi={...Lt,lheading:_i,table:hs,paragraph:x(At).replace("hr",Me).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",hs).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",it).getRegex()},Ci={...Lt,html:x(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ot).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Oe,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:x(At).replace("hr",Me).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Es).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},xi=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Pi=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,ys=/^( {2,}|\\)\n(?!\s*$)/,vi=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,nt=/[\p{P}\p{S}]/u,It=/[\s\p{P}\p{S}]/u,As=/[^\s\p{P}\p{S}]/u,Ti=x(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,It).getRegex(),Rs=/(?!~)[\p{P}\p{S}]/u,Ei=/(?!~)[\s\p{P}\p{S}]/u,Di=/(?:[^\s\p{P}\p{S}]|~)/u,yi=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Os=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ai=x(Os,"u").replace(/punct/g,nt).getRegex(),Ri=x(Os,"u").replace(/punct/g,Rs).getRegex(),Ls="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Oi=x(Ls,"gu").replace(/notPunctSpace/g,As).replace(/punctSpace/g,It).replace(/punct/g,nt).getRegex(),Li=x(Ls,"gu").replace(/notPunctSpace/g,Di).replace(/punctSpace/g,Ei).replace(/punct/g,Rs).getRegex(),Ii=x("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,As).replace(/punctSpace/g,It).replace(/punct/g,nt).getRegex(),Ni=x(/\\(punct)/,"gu").replace(/punct/g,nt).getRegex(),Bi=x(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Mi=x(Ot).replace("(?:-->|$)","-->").getRegex(),Fi=x("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Mi).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),et=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Wi=x(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",et).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Is=x(/^!?\[(label)\]\[(ref)\]/).replace("label",et).replace("ref",Rt).getRegex(),Ns=x(/^!?\[(ref)\](?:\[\])?/).replace("ref",Rt).getRegex(),$i=x("reflink|nolink(?!\\()","g").replace("reflink",Is).replace("nolink",Ns).getRegex(),Nt={_backpedal:Oe,anyPunctuation:Ni,autolink:Bi,blockSkip:yi,br:ys,code:Pi,del:Oe,emStrongLDelim:Ai,emStrongRDelimAst:Oi,emStrongRDelimUnd:Ii,escape:xi,link:Wi,nolink:Ns,punctuation:Ti,reflink:Is,reflinkSearch:$i,tag:Fi,text:vi,url:Oe},zi={...Nt,link:x(/^!?\[(label)\]\((.*?)\)/).replace("label",et).getRegex(),reflink:x(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",et).getRegex()},vt={...Nt,emStrongRDelimAst:Li,emStrongLDelim:Ri,url:x(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Ui={...vt,br:x(ys).replace("{2,}","*").getRegex(),text:x(vt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},qe={normal:Lt,gfm:wi,pedantic:Ci},Pe={normal:Nt,gfm:vt,breaks:Ui,pedantic:zi},Hi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},us=r=>Hi[r];function Q(r,e){if(e){if($.escapeTest.test(r))return r.replace($.escapeReplace,us)}else if($.escapeTestNoEncode.test(r))return r.replace($.escapeReplaceNoEncode,us);return r}function ps(r){try{r=encodeURI(r).replace($.percentDecode,"%")}catch{return null}return r}function ds(r,e){var n;const t=r.replace($.findPipe,(o,l,u)=>{let c=!1,h=l;for(;--h>=0&&u[h]==="\\";)c=!c;return c?"|":" |"}),s=t.split($.splitPipe);let i=0;if(s[0].trim()||s.shift(),s.length>0&&!((n=s.at(-1))!=null&&n.trim())&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;i<s.length;i++)s[i]=s[i].trim().replace($.slashPipe,"|");return s}function ve(r,e,t){const s=r.length;if(s===0)return"";let i=0;for(;i<s&&r.charAt(s-i-1)===e;)i++;return r.slice(0,s-i)}function Gi(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<r.length;s++)if(r[s]==="\\")s++;else if(r[s]===e[0])t++;else if(r[s]===e[1]&&(t--,t<0))return s;return-1}function fs(r,e,t,s,i){const n=e.href,o=e.title||null,l=r[1].replace(i.other.outputLinkReplace,"$1");if(r[0].charAt(0)!=="!"){s.state.inLink=!0;const u={type:"link",raw:t,href:n,title:o,text:l,tokens:s.inlineTokens(l)};return s.state.inLink=!1,u}return{type:"image",raw:t,href:n,title:o,text:l}}function Vi(r,e,t){const s=r.match(t.other.indentCodeCompensation);if(s===null)return e;const i=s[1];return e.split(`
`).map(n=>{const o=n.match(t.other.beginningSpace);if(o===null)return n;const[l]=o;return l.length>=i.length?n.slice(i.length):n}).join(`
`)}class tt{constructor(e){T(this,"options");T(this,"rules");T(this,"lexer");this.options=e||ce}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const s=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:ve(s,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const s=t[0],i=Vi(s,t[3]||"",this.rules);return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(this.rules.other.endingHash.test(s)){const i=ve(s,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(s=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:ve(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let s=ve(t[0],`
`).split(`
`),i="",n="";const o=[];for(;s.length>0;){let l=!1;const u=[];let c;for(c=0;c<s.length;c++)if(this.rules.other.blockquoteStart.test(s[c]))u.push(s[c]),l=!0;else if(!l)u.push(s[c]);else break;s=s.slice(c);const h=u.join(`
`),g=h.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${h}`:h,n=n?`${n}
${g}`:g;const m=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(g,o,!0),this.lexer.state.top=m,s.length===0)break;const S=o.at(-1);if((S==null?void 0:S.type)==="code")break;if((S==null?void 0:S.type)==="blockquote"){const D=S,v=D.raw+`
`+s.join(`
`),H=this.blockquote(v);o[o.length-1]=H,i=i.substring(0,i.length-D.raw.length)+H.raw,n=n.substring(0,n.length-D.text.length)+H.text;break}else if((S==null?void 0:S.type)==="list"){const D=S,v=D.raw+`
`+s.join(`
`),H=this.list(v);o[o.length-1]=H,i=i.substring(0,i.length-S.raw.length)+H.raw,n=n.substring(0,n.length-D.raw.length)+H.raw,s=v.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:o,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim();const i=s.length>1,n={type:"list",raw:"",ordered:i,start:i?+s.slice(0,-1):"",loose:!1,items:[]};s=i?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=i?s:"[*+-]");const o=this.rules.other.listItemRegex(s);let l=!1;for(;e;){let c=!1,h="",g="";if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;h=t[0],e=e.substring(h.length);let m=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,me=>" ".repeat(3*me.length)),S=e.split(`
`,1)[0],D=!m.trim(),v=0;if(this.options.pedantic?(v=2,g=m.trimStart()):D?v=t[1].length+1:(v=t[2].search(this.rules.other.nonSpaceChar),v=v>4?1:v,g=m.slice(v),v+=t[1].length),D&&this.rules.other.blankLine.test(S)&&(h+=S+`
`,e=e.substring(S.length+1),c=!0),!c){const me=this.rules.other.nextBulletRegex(v),ie=this.rules.other.hrRegex(v),R=this.rules.other.fencesBeginRegex(v),te=this.rules.other.headingBeginRegex(v),ke=this.rules.other.htmlBeginRegex(v);for(;e;){const Se=e.split(`
`,1)[0];let ne;if(S=Se,this.options.pedantic?(S=S.replace(this.rules.other.listReplaceNesting,"  "),ne=S):ne=S.replace(this.rules.other.tabCharGlobal,"    "),R.test(S)||te.test(S)||ke.test(S)||me.test(S)||ie.test(S))break;if(ne.search(this.rules.other.nonSpaceChar)>=v||!S.trim())g+=`
`+ne.slice(v);else{if(D||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||R.test(m)||te.test(m)||ie.test(m))break;g+=`
`+S}!D&&!S.trim()&&(D=!0),h+=Se+`
`,e=e.substring(Se.length+1),m=ne.slice(v)}}n.loose||(l?n.loose=!0:this.rules.other.doubleBlankLine.test(h)&&(l=!0));let H=null,Fe;this.options.gfm&&(H=this.rules.other.listIsTask.exec(g),H&&(Fe=H[0]!=="[ ] ",g=g.replace(this.rules.other.listReplaceTask,""))),n.items.push({type:"list_item",raw:h,task:!!H,checked:Fe,loose:!1,text:g,tokens:[]}),n.raw+=h}const u=n.items.at(-1);if(u)u.raw=u.raw.trimEnd(),u.text=u.text.trimEnd();else return;n.raw=n.raw.trimEnd();for(let c=0;c<n.items.length;c++)if(this.lexer.state.top=!1,n.items[c].tokens=this.lexer.blockTokens(n.items[c].text,[]),!n.loose){const h=n.items[c].tokens.filter(m=>m.type==="space"),g=h.length>0&&h.some(m=>this.rules.other.anyLine.test(m.raw));n.loose=g}if(n.loose)for(let c=0;c<n.items.length;c++)n.items[c].loose=!0;return n}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const s=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:i,title:n}}}table(e){var l;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const s=ds(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),n=(l=t[3])!=null&&l.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===i.length){for(const u of i)this.rules.other.tableAlignRight.test(u)?o.align.push("right"):this.rules.other.tableAlignCenter.test(u)?o.align.push("center"):this.rules.other.tableAlignLeft.test(u)?o.align.push("left"):o.align.push(null);for(let u=0;u<s.length;u++)o.header.push({text:s[u],tokens:this.lexer.inline(s[u]),header:!0,align:o.align[u]});for(const u of n)o.rows.push(ds(u,o.header.length).map((c,h)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:o.align[h]})));return o}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const s=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;const o=ve(s.slice(0,-1),"\\");if((s.length-o.length)%2===0)return}else{const o=Gi(t[2],"()");if(o>-1){const u=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,u).trim(),t[3]=""}}let i=t[2],n="";if(this.options.pedantic){const o=this.rules.other.pedanticHrefTitle.exec(i);o&&(i=o[1],n=o[3])}else n=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?i=i.slice(1):i=i.slice(1,-1)),fs(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:n&&n.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){const i=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),n=t[i.toLowerCase()];if(!n){const o=s[0].charAt(0);return{type:"text",raw:o,text:o}}return fs(s,n,s[0],this.lexer,this.rules)}}emStrong(e,t,s=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!i||i[3]&&s.match(this.rules.other.unicodeAlphaNumeric))return;if(!(i[1]||i[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const o=[...i[0]].length-1;let l,u,c=o,h=0;const g=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(g.lastIndex=0,t=t.slice(-1*e.length+o);(i=g.exec(t))!=null;){if(l=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!l)continue;if(u=[...l].length,i[3]||i[4]){c+=u;continue}else if((i[5]||i[6])&&o%3&&!((o+u)%3)){h+=u;continue}if(c-=u,c>0)continue;u=Math.min(u,u+c+h);const m=[...i[0]][0].length,S=e.slice(0,o+i.index+m+u);if(Math.min(o,u)%2){const v=S.slice(1,-1);return{type:"em",raw:S,text:v,tokens:this.lexer.inlineTokens(v)}}const D=S.slice(2,-2);return{type:"strong",raw:S,text:D,tokens:this.lexer.inlineTokens(D)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(this.rules.other.newLineCharGlobal," ");const i=this.rules.other.nonSpaceChar.test(s),n=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return i&&n&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:t[0],text:s}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let s,i;return t[2]==="@"?(s=t[1],i="mailto:"+s):(s=t[1],i=s),{type:"link",raw:t[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}url(e){var s;let t;if(t=this.rules.inline.url.exec(e)){let i,n;if(t[2]==="@")i=t[0],n="mailto:"+i;else{let o;do o=t[0],t[0]=((s=this.rules.inline._backpedal.exec(t[0]))==null?void 0:s[0])??"";while(o!==t[0]);i=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:i,href:n,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const s=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:s}}}}class V{constructor(e){T(this,"tokens");T(this,"options");T(this,"state");T(this,"tokenizer");T(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ce,this.options.tokenizer=this.options.tokenizer||new tt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:$,block:qe.normal,inline:Pe.normal};this.options.pedantic?(t.block=qe.pedantic,t.inline=Pe.pedantic):this.options.gfm&&(t.block=qe.gfm,this.options.breaks?t.inline=Pe.breaks:t.inline=Pe.gfm),this.tokenizer.rules=t}static get rules(){return{block:qe,inline:Pe}}static lex(e,t){return new V(t).lex(e)}static lexInline(e,t){return new V(t).inlineTokens(e)}lex(e){e=e.replace($.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],s=!1){var i,n,o;for(this.options.pedantic&&(e=e.replace($.tabCharGlobal,"    ").replace($.spaceLine,""));e;){let l;if((n=(i=this.options.extensions)==null?void 0:i.block)!=null&&n.some(c=>(l=c.call({lexer:this},e,t))?(e=e.substring(l.raw.length),t.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);const c=t.at(-1);l.raw.length===1&&c!==void 0?c.raw+=`
`:t.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+l.raw,c.text+=`
`+l.text,this.inlineQueue.at(-1).src=c.text):t.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+l.raw,c.text+=`
`+l.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title});continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),t.push(l);continue}let u=e;if((o=this.options.extensions)!=null&&o.startBlock){let c=1/0;const h=e.slice(1);let g;this.options.extensions.startBlock.forEach(m=>{g=m.call({lexer:this},h),typeof g=="number"&&g>=0&&(c=Math.min(c,g))}),c<1/0&&c>=0&&(u=e.substring(0,c+1))}if(this.state.top&&(l=this.tokenizer.paragraph(u))){const c=t.at(-1);s&&(c==null?void 0:c.type)==="paragraph"?(c.raw+=`
`+l.raw,c.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(l),s=u.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="text"?(c.raw+=`
`+l.raw,c.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(l);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var l,u,c;let s=e,i=null;if(this.tokens.links){const h=Object.keys(this.tokens.links);if(h.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)h.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)s=s.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,i.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let n=!1,o="";for(;e;){n||(o=""),n=!1;let h;if((u=(l=this.options.extensions)==null?void 0:l.inline)!=null&&u.some(m=>(h=m.call({lexer:this},e,t))?(e=e.substring(h.raw.length),t.push(h),!0):!1))continue;if(h=this.tokenizer.escape(e)){e=e.substring(h.raw.length),t.push(h);continue}if(h=this.tokenizer.tag(e)){e=e.substring(h.raw.length),t.push(h);continue}if(h=this.tokenizer.link(e)){e=e.substring(h.raw.length),t.push(h);continue}if(h=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(h.raw.length);const m=t.at(-1);h.type==="text"&&(m==null?void 0:m.type)==="text"?(m.raw+=h.raw,m.text+=h.text):t.push(h);continue}if(h=this.tokenizer.emStrong(e,s,o)){e=e.substring(h.raw.length),t.push(h);continue}if(h=this.tokenizer.codespan(e)){e=e.substring(h.raw.length),t.push(h);continue}if(h=this.tokenizer.br(e)){e=e.substring(h.raw.length),t.push(h);continue}if(h=this.tokenizer.del(e)){e=e.substring(h.raw.length),t.push(h);continue}if(h=this.tokenizer.autolink(e)){e=e.substring(h.raw.length),t.push(h);continue}if(!this.state.inLink&&(h=this.tokenizer.url(e))){e=e.substring(h.raw.length),t.push(h);continue}let g=e;if((c=this.options.extensions)!=null&&c.startInline){let m=1/0;const S=e.slice(1);let D;this.options.extensions.startInline.forEach(v=>{D=v.call({lexer:this},S),typeof D=="number"&&D>=0&&(m=Math.min(m,D))}),m<1/0&&m>=0&&(g=e.substring(0,m+1))}if(h=this.tokenizer.inlineText(g)){e=e.substring(h.raw.length),h.raw.slice(-1)!=="_"&&(o=h.raw.slice(-1)),n=!0;const m=t.at(-1);(m==null?void 0:m.type)==="text"?(m.raw+=h.raw,m.text+=h.text):t.push(h);continue}if(e){const m="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(m);break}else throw new Error(m)}}return t}}class st{constructor(e){T(this,"options");T(this,"parser");this.options=e||ce}space(e){return""}code({text:e,lang:t,escaped:s}){var o;const i=(o=(t||"").match($.notSpaceStart))==null?void 0:o[0],n=e.replace($.endingNewline,"")+`
`;return i?'<pre><code class="language-'+Q(i)+'">'+(s?n:Q(n,!0))+`</code></pre>
`:"<pre><code>"+(s?n:Q(n,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,s=e.start;let i="";for(let l=0;l<e.items.length;l++){const u=e.items[l];i+=this.listitem(u)}const n=t?"ol":"ul",o=t&&s!==1?' start="'+s+'"':"";return"<"+n+o+`>
`+i+"</"+n+`>
`}listitem(e){var s;let t="";if(e.task){const i=this.checkbox({checked:!!e.checked});e.loose?((s=e.tokens[0])==null?void 0:s.type)==="paragraph"?(e.tokens[0].text=i+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=i+" "+Q(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:i+" ",text:i+" ",escaped:!0}):t+=i+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",s="";for(let n=0;n<e.header.length;n++)s+=this.tablecell(e.header[n]);t+=this.tablerow({text:s});let i="";for(let n=0;n<e.rows.length;n++){const o=e.rows[n];s="";for(let l=0;l<o.length;l++)s+=this.tablecell(o[l]);i+=this.tablerow({text:s})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),s=e.header?"th":"td";return(e.align?`<${s} align="${e.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Q(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:s}){const i=this.parser.parseInline(s),n=ps(e);if(n===null)return i;e=n;let o='<a href="'+e+'"';return t&&(o+=' title="'+Q(t)+'"'),o+=">"+i+"</a>",o}image({href:e,title:t,text:s}){const i=ps(e);if(i===null)return Q(s);e=i;let n=`<img src="${e}" alt="${s}"`;return t&&(n+=` title="${Q(t)}"`),n+=">",n}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Q(e.text)}}class Bt{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class j{constructor(e){T(this,"options");T(this,"renderer");T(this,"textRenderer");this.options=e||ce,this.options.renderer=this.options.renderer||new st,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Bt}static parse(e,t){return new j(t).parse(e)}static parseInline(e,t){return new j(t).parseInline(e)}parse(e,t=!0){var i,n;let s="";for(let o=0;o<e.length;o++){const l=e[o];if((n=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&n[l.type]){const c=l,h=this.options.extensions.renderers[c.type].call({parser:this},c);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){s+=h||"";continue}}const u=l;switch(u.type){case"space":{s+=this.renderer.space(u);continue}case"hr":{s+=this.renderer.hr(u);continue}case"heading":{s+=this.renderer.heading(u);continue}case"code":{s+=this.renderer.code(u);continue}case"table":{s+=this.renderer.table(u);continue}case"blockquote":{s+=this.renderer.blockquote(u);continue}case"list":{s+=this.renderer.list(u);continue}case"html":{s+=this.renderer.html(u);continue}case"paragraph":{s+=this.renderer.paragraph(u);continue}case"text":{let c=u,h=this.renderer.text(c);for(;o+1<e.length&&e[o+1].type==="text";)c=e[++o],h+=`
`+this.renderer.text(c);t?s+=this.renderer.paragraph({type:"paragraph",raw:h,text:h,tokens:[{type:"text",raw:h,text:h,escaped:!0}]}):s+=h;continue}default:{const c='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return s}parseInline(e,t=this.renderer){var i,n;let s="";for(let o=0;o<e.length;o++){const l=e[o];if((n=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&n[l.type]){const c=this.options.extensions.renderers[l.type].call({parser:this},l);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){s+=c||"";continue}}const u=l;switch(u.type){case"escape":{s+=t.text(u);break}case"html":{s+=t.html(u);break}case"link":{s+=t.link(u);break}case"image":{s+=t.image(u);break}case"strong":{s+=t.strong(u);break}case"em":{s+=t.em(u);break}case"codespan":{s+=t.codespan(u);break}case"br":{s+=t.br(u);break}case"del":{s+=t.del(u);break}case"text":{s+=t.text(u);break}default:{const c='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return s}}class Le{constructor(e){T(this,"options");T(this,"block");this.options=e||ce}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?V.lex:V.lexInline}provideParser(){return this.block?j.parse:j.parseInline}}T(Le,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class ji{constructor(...e){T(this,"defaults",Dt());T(this,"options",this.setOptions);T(this,"parse",this.parseMarkdown(!0));T(this,"parseInline",this.parseMarkdown(!1));T(this,"Parser",j);T(this,"Renderer",st);T(this,"TextRenderer",Bt);T(this,"Lexer",V);T(this,"Tokenizer",tt);T(this,"Hooks",Le);this.use(...e)}walkTokens(e,t){var i,n;let s=[];for(const o of e)switch(s=s.concat(t.call(this,o)),o.type){case"table":{const l=o;for(const u of l.header)s=s.concat(this.walkTokens(u.tokens,t));for(const u of l.rows)for(const c of u)s=s.concat(this.walkTokens(c.tokens,t));break}case"list":{const l=o;s=s.concat(this.walkTokens(l.items,t));break}default:{const l=o;(n=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&n[l.type]?this.defaults.extensions.childTokens[l.type].forEach(u=>{const c=l[u].flat(1/0);s=s.concat(this.walkTokens(c,t))}):l.tokens&&(s=s.concat(this.walkTokens(l.tokens,t)))}}return s}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{const i={...s};if(i.async=this.defaults.async||i.async||!1,s.extensions&&(s.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if("renderer"in n){const o=t.renderers[n.name];o?t.renderers[n.name]=function(...l){let u=n.renderer.apply(this,l);return u===!1&&(u=o.apply(this,l)),u}:t.renderers[n.name]=n.renderer}if("tokenizer"in n){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=t[n.level];o?o.unshift(n.tokenizer):t[n.level]=[n.tokenizer],n.start&&(n.level==="block"?t.startBlock?t.startBlock.push(n.start):t.startBlock=[n.start]:n.level==="inline"&&(t.startInline?t.startInline.push(n.start):t.startInline=[n.start]))}"childTokens"in n&&n.childTokens&&(t.childTokens[n.name]=n.childTokens)}),i.extensions=t),s.renderer){const n=this.defaults.renderer||new st(this.defaults);for(const o in s.renderer){if(!(o in n))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;const l=o,u=s.renderer[l],c=n[l];n[l]=(...h)=>{let g=u.apply(n,h);return g===!1&&(g=c.apply(n,h)),g||""}}i.renderer=n}if(s.tokenizer){const n=this.defaults.tokenizer||new tt(this.defaults);for(const o in s.tokenizer){if(!(o in n))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const l=o,u=s.tokenizer[l],c=n[l];n[l]=(...h)=>{let g=u.apply(n,h);return g===!1&&(g=c.apply(n,h)),g}}i.tokenizer=n}if(s.hooks){const n=this.defaults.hooks||new Le;for(const o in s.hooks){if(!(o in n))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;const l=o,u=s.hooks[l],c=n[l];Le.passThroughHooks.has(o)?n[l]=h=>{if(this.defaults.async)return Promise.resolve(u.call(n,h)).then(m=>c.call(n,m));const g=u.call(n,h);return c.call(n,g)}:n[l]=(...h)=>{let g=u.apply(n,h);return g===!1&&(g=c.apply(n,h)),g}}i.hooks=n}if(s.walkTokens){const n=this.defaults.walkTokens,o=s.walkTokens;i.walkTokens=function(l){let u=[];return u.push(o.call(this,l)),n&&(u=u.concat(n.call(this,l))),u}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return V.lex(e,t??this.defaults)}parser(e,t){return j.parse(e,t??this.defaults)}parseMarkdown(e){return(s,i)=>{const n={...i},o={...this.defaults,...n},l=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&n.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof s>"u"||s===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=e);const u=o.hooks?o.hooks.provideLexer():e?V.lex:V.lexInline,c=o.hooks?o.hooks.provideParser():e?j.parse:j.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(s):s).then(h=>u(h,o)).then(h=>o.hooks?o.hooks.processAllTokens(h):h).then(h=>o.walkTokens?Promise.all(this.walkTokens(h,o.walkTokens)).then(()=>h):h).then(h=>c(h,o)).then(h=>o.hooks?o.hooks.postprocess(h):h).catch(l);try{o.hooks&&(s=o.hooks.preprocess(s));let h=u(s,o);o.hooks&&(h=o.hooks.processAllTokens(h)),o.walkTokens&&this.walkTokens(h,o.walkTokens);let g=c(h,o);return o.hooks&&(g=o.hooks.postprocess(g)),g}catch(h){return l(h)}}}onError(e,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const i="<p>An error occurred:</p><pre>"+Q(s.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(s);throw s}}}const le=new ji;function P(r,e){return le.parse(r,e)}P.options=P.setOptions=function(r){return le.setOptions(r),P.defaults=le.defaults,vs(P.defaults),P};P.getDefaults=Dt;P.defaults=ce;P.use=function(...r){return le.use(...r),P.defaults=le.defaults,vs(P.defaults),P};P.walkTokens=function(r,e){return le.walkTokens(r,e)};P.parseInline=le.parseInline;P.Parser=j;P.parser=j.parse;P.Renderer=st;P.TextRenderer=Bt;P.Lexer=V;P.lexer=V.lex;P.Tokenizer=tt;P.Hooks=Le;P.parse=P;P.options;P.setOptions;P.use;P.walkTokens;P.parseInline;j.parse;V.lex;/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */const{entries:Bs,setPrototypeOf:_s,isFrozen:qi,getPrototypeOf:Yi,getOwnPropertyDescriptor:Zi}=Object;let{freeze:z,seal:q,create:Ms}=Object,{apply:Tt,construct:Et}=typeof Reflect<"u"&&Reflect;z||(z=function(e){return e});q||(q=function(e){return e});Tt||(Tt=function(e,t,s){return e.apply(t,s)});Et||(Et=function(e,t){return new e(...t)});const Ye=U(Array.prototype.forEach),Ki=U(Array.prototype.lastIndexOf),gs=U(Array.prototype.pop),Te=U(Array.prototype.push),Xi=U(Array.prototype.splice),Ke=U(String.prototype.toLowerCase),St=U(String.prototype.toString),ms=U(String.prototype.match),Ee=U(String.prototype.replace),Qi=U(String.prototype.indexOf),Ji=U(String.prototype.trim),Y=U(Object.prototype.hasOwnProperty),W=U(RegExp.prototype.test),De=en(TypeError);function U(r){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return Tt(r,e,s)}}function en(r){return function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Et(r,t)}}function b(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ke;_s&&_s(r,null);let s=e.length;for(;s--;){let i=e[s];if(typeof i=="string"){const n=t(i);n!==i&&(qi(e)||(e[s]=n),i=n)}r[i]=!0}return r}function tn(r){for(let e=0;e<r.length;e++)Y(r,e)||(r[e]=null);return r}function oe(r){const e=Ms(null);for(const[t,s]of Bs(r))Y(r,t)&&(Array.isArray(s)?e[t]=tn(s):s&&typeof s=="object"&&s.constructor===Object?e[t]=oe(s):e[t]=s);return e}function ye(r,e){for(;r!==null;){const s=Zi(r,e);if(s){if(s.get)return U(s.get);if(typeof s.value=="function")return U(s.value)}r=Yi(r)}function t(){return null}return t}const ks=z(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),bt=z(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),wt=z(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),sn=z(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ct=z(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),nn=z(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ss=z(["#text"]),bs=z(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),xt=z(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ws=z(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Ze=z(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),rn=q(/\{\{[\w\W]*|[\w\W]*\}\}/gm),on=q(/<%[\w\W]*|[\w\W]*%>/gm),an=q(/\$\{[\w\W]*/gm),ln=q(/^data-[\-\w.\u00B7-\uFFFF]+$/),cn=q(/^aria-[\-\w]+$/),Fs=q(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),hn=q(/^(?:\w+script|data):/i),un=q(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ws=q(/^html$/i),pn=q(/^[a-z][.\w]*(-[.\w]+)+$/i);var Cs=Object.freeze({__proto__:null,ARIA_ATTR:cn,ATTR_WHITESPACE:un,CUSTOM_ELEMENT:pn,DATA_ATTR:ln,DOCTYPE_NAME:Ws,ERB_EXPR:on,IS_ALLOWED_URI:Fs,IS_SCRIPT_OR_DATA:hn,MUSTACHE_EXPR:rn,TMPLIT_EXPR:an});const Ae={element:1,text:3,progressingInstruction:7,comment:8,document:9},dn=function(){return typeof window>"u"?null:window},fn=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(s=t.getAttribute(i));const n="dompurify"+(s?"#"+s:"");try{return e.createPolicy(n,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+n+" could not be created."),null}},xs=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function $s(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:dn();const e=_=>$s(_);if(e.version="3.2.4",e.removed=[],!r||!r.document||r.document.nodeType!==Ae.document||!r.Element)return e.isSupported=!1,e;let{document:t}=r;const s=t,i=s.currentScript,{DocumentFragment:n,HTMLTemplateElement:o,Node:l,Element:u,NodeFilter:c,NamedNodeMap:h=r.NamedNodeMap||r.MozNamedAttrMap,HTMLFormElement:g,DOMParser:m,trustedTypes:S}=r,D=u.prototype,v=ye(D,"cloneNode"),H=ye(D,"remove"),Fe=ye(D,"nextSibling"),me=ye(D,"childNodes"),ie=ye(D,"parentNode");if(typeof o=="function"){const _=t.createElement("template");_.content&&_.content.ownerDocument&&(t=_.content.ownerDocument)}let R,te="";const{implementation:ke,createNodeIterator:Se,createDocumentFragment:ne,getElementsByTagName:Us}=t,{importNode:Hs}=s;let M=xs();e.isSupported=typeof Bs=="function"&&typeof ie=="function"&&ke&&ke.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:rt,ERB_EXPR:ot,TMPLIT_EXPR:at,DATA_ATTR:Gs,ARIA_ATTR:Vs,IS_SCRIPT_OR_DATA:js,ATTR_WHITESPACE:Mt,CUSTOM_ELEMENT:qs}=Cs;let{IS_ALLOWED_URI:Ft}=Cs,O=null;const Wt=b({},[...ks,...bt,...wt,...Ct,...Ss]);let I=null;const $t=b({},[...bs,...xt,...ws,...Ze]);let A=Object.seal(Ms(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),be=null,lt=null,zt=!0,ct=!0,Ut=!1,Ht=!0,he=!1,ht=!0,re=!1,ut=!1,pt=!1,ue=!1,We=!1,$e=!1,Gt=!0,Vt=!1;const Ys="user-content-";let dt=!0,we=!1,pe={},de=null;const jt=b({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let qt=null;const Yt=b({},["audio","video","img","source","image","track"]);let ft=null;const Zt=b({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ze="http://www.w3.org/1998/Math/MathML",Ue="http://www.w3.org/2000/svg",J="http://www.w3.org/1999/xhtml";let fe=J,_t=!1,gt=null;const Zs=b({},[ze,Ue,J],St);let He=b({},["mi","mo","mn","ms","mtext"]),Ge=b({},["annotation-xml"]);const Ks=b({},["title","style","font","a","script"]);let Ce=null;const Xs=["application/xhtml+xml","text/html"],Qs="text/html";let L=null,_e=null;const Js=t.createElement("form"),Kt=function(a){return a instanceof RegExp||a instanceof Function},mt=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(_e&&_e===a)){if((!a||typeof a!="object")&&(a={}),a=oe(a),Ce=Xs.indexOf(a.PARSER_MEDIA_TYPE)===-1?Qs:a.PARSER_MEDIA_TYPE,L=Ce==="application/xhtml+xml"?St:Ke,O=Y(a,"ALLOWED_TAGS")?b({},a.ALLOWED_TAGS,L):Wt,I=Y(a,"ALLOWED_ATTR")?b({},a.ALLOWED_ATTR,L):$t,gt=Y(a,"ALLOWED_NAMESPACES")?b({},a.ALLOWED_NAMESPACES,St):Zs,ft=Y(a,"ADD_URI_SAFE_ATTR")?b(oe(Zt),a.ADD_URI_SAFE_ATTR,L):Zt,qt=Y(a,"ADD_DATA_URI_TAGS")?b(oe(Yt),a.ADD_DATA_URI_TAGS,L):Yt,de=Y(a,"FORBID_CONTENTS")?b({},a.FORBID_CONTENTS,L):jt,be=Y(a,"FORBID_TAGS")?b({},a.FORBID_TAGS,L):{},lt=Y(a,"FORBID_ATTR")?b({},a.FORBID_ATTR,L):{},pe=Y(a,"USE_PROFILES")?a.USE_PROFILES:!1,zt=a.ALLOW_ARIA_ATTR!==!1,ct=a.ALLOW_DATA_ATTR!==!1,Ut=a.ALLOW_UNKNOWN_PROTOCOLS||!1,Ht=a.ALLOW_SELF_CLOSE_IN_ATTR!==!1,he=a.SAFE_FOR_TEMPLATES||!1,ht=a.SAFE_FOR_XML!==!1,re=a.WHOLE_DOCUMENT||!1,ue=a.RETURN_DOM||!1,We=a.RETURN_DOM_FRAGMENT||!1,$e=a.RETURN_TRUSTED_TYPE||!1,pt=a.FORCE_BODY||!1,Gt=a.SANITIZE_DOM!==!1,Vt=a.SANITIZE_NAMED_PROPS||!1,dt=a.KEEP_CONTENT!==!1,we=a.IN_PLACE||!1,Ft=a.ALLOWED_URI_REGEXP||Fs,fe=a.NAMESPACE||J,He=a.MATHML_TEXT_INTEGRATION_POINTS||He,Ge=a.HTML_INTEGRATION_POINTS||Ge,A=a.CUSTOM_ELEMENT_HANDLING||{},a.CUSTOM_ELEMENT_HANDLING&&Kt(a.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(A.tagNameCheck=a.CUSTOM_ELEMENT_HANDLING.tagNameCheck),a.CUSTOM_ELEMENT_HANDLING&&Kt(a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(A.attributeNameCheck=a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),a.CUSTOM_ELEMENT_HANDLING&&typeof a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(A.allowCustomizedBuiltInElements=a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),he&&(ct=!1),We&&(ue=!0),pe&&(O=b({},Ss),I=[],pe.html===!0&&(b(O,ks),b(I,bs)),pe.svg===!0&&(b(O,bt),b(I,xt),b(I,Ze)),pe.svgFilters===!0&&(b(O,wt),b(I,xt),b(I,Ze)),pe.mathMl===!0&&(b(O,Ct),b(I,ws),b(I,Ze))),a.ADD_TAGS&&(O===Wt&&(O=oe(O)),b(O,a.ADD_TAGS,L)),a.ADD_ATTR&&(I===$t&&(I=oe(I)),b(I,a.ADD_ATTR,L)),a.ADD_URI_SAFE_ATTR&&b(ft,a.ADD_URI_SAFE_ATTR,L),a.FORBID_CONTENTS&&(de===jt&&(de=oe(de)),b(de,a.FORBID_CONTENTS,L)),dt&&(O["#text"]=!0),re&&b(O,["html","head","body"]),O.table&&(b(O,["tbody"]),delete be.tbody),a.TRUSTED_TYPES_POLICY){if(typeof a.TRUSTED_TYPES_POLICY.createHTML!="function")throw De('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof a.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw De('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');R=a.TRUSTED_TYPES_POLICY,te=R.createHTML("")}else R===void 0&&(R=fn(S,i)),R!==null&&typeof te=="string"&&(te=R.createHTML(""));z&&z(a),_e=a}},Xt=b({},[...bt,...wt,...sn]),Qt=b({},[...Ct,...nn]),ei=function(a){let p=ie(a);(!p||!p.tagName)&&(p={namespaceURI:fe,tagName:"template"});const d=Ke(a.tagName),y=Ke(p.tagName);return gt[a.namespaceURI]?a.namespaceURI===Ue?p.namespaceURI===J?d==="svg":p.namespaceURI===ze?d==="svg"&&(y==="annotation-xml"||He[y]):!!Xt[d]:a.namespaceURI===ze?p.namespaceURI===J?d==="math":p.namespaceURI===Ue?d==="math"&&Ge[y]:!!Qt[d]:a.namespaceURI===J?p.namespaceURI===Ue&&!Ge[y]||p.namespaceURI===ze&&!He[y]?!1:!Qt[d]&&(Ks[d]||!Xt[d]):!!(Ce==="application/xhtml+xml"&&gt[a.namespaceURI]):!1},K=function(a){Te(e.removed,{element:a});try{ie(a).removeChild(a)}catch{H(a)}},Ve=function(a,p){try{Te(e.removed,{attribute:p.getAttributeNode(a),from:p})}catch{Te(e.removed,{attribute:null,from:p})}if(p.removeAttribute(a),a==="is")if(ue||We)try{K(p)}catch{}else try{p.setAttribute(a,"")}catch{}},Jt=function(a){let p=null,d=null;if(pt)a="<remove></remove>"+a;else{const N=ms(a,/^[\r\n\t ]+/);d=N&&N[0]}Ce==="application/xhtml+xml"&&fe===J&&(a='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+a+"</body></html>");const y=R?R.createHTML(a):a;if(fe===J)try{p=new m().parseFromString(y,Ce)}catch{}if(!p||!p.documentElement){p=ke.createDocument(fe,"template",null);try{p.documentElement.innerHTML=_t?te:y}catch{}}const B=p.body||p.documentElement;return a&&d&&B.insertBefore(t.createTextNode(d),B.childNodes[0]||null),fe===J?Us.call(p,re?"html":"body")[0]:re?p.documentElement:B},es=function(a){return Se.call(a.ownerDocument||a,a,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},kt=function(a){return a instanceof g&&(typeof a.nodeName!="string"||typeof a.textContent!="string"||typeof a.removeChild!="function"||!(a.attributes instanceof h)||typeof a.removeAttribute!="function"||typeof a.setAttribute!="function"||typeof a.namespaceURI!="string"||typeof a.insertBefore!="function"||typeof a.hasChildNodes!="function")},ts=function(a){return typeof l=="function"&&a instanceof l};function ee(_,a,p){Ye(_,d=>{d.call(e,a,p,_e)})}const ss=function(a){let p=null;if(ee(M.beforeSanitizeElements,a,null),kt(a))return K(a),!0;const d=L(a.nodeName);if(ee(M.uponSanitizeElement,a,{tagName:d,allowedTags:O}),a.hasChildNodes()&&!ts(a.firstElementChild)&&W(/<[/\w]/g,a.innerHTML)&&W(/<[/\w]/g,a.textContent)||a.nodeType===Ae.progressingInstruction||ht&&a.nodeType===Ae.comment&&W(/<[/\w]/g,a.data))return K(a),!0;if(!O[d]||be[d]){if(!be[d]&&ns(d)&&(A.tagNameCheck instanceof RegExp&&W(A.tagNameCheck,d)||A.tagNameCheck instanceof Function&&A.tagNameCheck(d)))return!1;if(dt&&!de[d]){const y=ie(a)||a.parentNode,B=me(a)||a.childNodes;if(B&&y){const N=B.length;for(let G=N-1;G>=0;--G){const X=v(B[G],!0);X.__removalCount=(a.__removalCount||0)+1,y.insertBefore(X,Fe(a))}}}return K(a),!0}return a instanceof u&&!ei(a)||(d==="noscript"||d==="noembed"||d==="noframes")&&W(/<\/no(script|embed|frames)/i,a.innerHTML)?(K(a),!0):(he&&a.nodeType===Ae.text&&(p=a.textContent,Ye([rt,ot,at],y=>{p=Ee(p,y," ")}),a.textContent!==p&&(Te(e.removed,{element:a.cloneNode()}),a.textContent=p)),ee(M.afterSanitizeElements,a,null),!1)},is=function(a,p,d){if(Gt&&(p==="id"||p==="name")&&(d in t||d in Js))return!1;if(!(ct&&!lt[p]&&W(Gs,p))){if(!(zt&&W(Vs,p))){if(!I[p]||lt[p]){if(!(ns(a)&&(A.tagNameCheck instanceof RegExp&&W(A.tagNameCheck,a)||A.tagNameCheck instanceof Function&&A.tagNameCheck(a))&&(A.attributeNameCheck instanceof RegExp&&W(A.attributeNameCheck,p)||A.attributeNameCheck instanceof Function&&A.attributeNameCheck(p))||p==="is"&&A.allowCustomizedBuiltInElements&&(A.tagNameCheck instanceof RegExp&&W(A.tagNameCheck,d)||A.tagNameCheck instanceof Function&&A.tagNameCheck(d))))return!1}else if(!ft[p]){if(!W(Ft,Ee(d,Mt,""))){if(!((p==="src"||p==="xlink:href"||p==="href")&&a!=="script"&&Qi(d,"data:")===0&&qt[a])){if(!(Ut&&!W(js,Ee(d,Mt,"")))){if(d)return!1}}}}}}return!0},ns=function(a){return a!=="annotation-xml"&&ms(a,qs)},rs=function(a){ee(M.beforeSanitizeAttributes,a,null);const{attributes:p}=a;if(!p||kt(a))return;const d={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:I,forceKeepAttr:void 0};let y=p.length;for(;y--;){const B=p[y],{name:N,namespaceURI:G,value:X}=B,xe=L(N);let F=N==="value"?X:Ji(X);if(d.attrName=xe,d.attrValue=F,d.keepAttr=!0,d.forceKeepAttr=void 0,ee(M.uponSanitizeAttribute,a,d),F=d.attrValue,Vt&&(xe==="id"||xe==="name")&&(Ve(N,a),F=Ys+F),ht&&W(/((--!?|])>)|<\/(style|title)/i,F)){Ve(N,a);continue}if(d.forceKeepAttr||(Ve(N,a),!d.keepAttr))continue;if(!Ht&&W(/\/>/i,F)){Ve(N,a);continue}he&&Ye([rt,ot,at],as=>{F=Ee(F,as," ")});const os=L(a.nodeName);if(is(os,xe,F)){if(R&&typeof S=="object"&&typeof S.getAttributeType=="function"&&!G)switch(S.getAttributeType(os,xe)){case"TrustedHTML":{F=R.createHTML(F);break}case"TrustedScriptURL":{F=R.createScriptURL(F);break}}try{G?a.setAttributeNS(G,N,F):a.setAttribute(N,F),kt(a)?K(a):gs(e.removed)}catch{}}}ee(M.afterSanitizeAttributes,a,null)},ti=function _(a){let p=null;const d=es(a);for(ee(M.beforeSanitizeShadowDOM,a,null);p=d.nextNode();)ee(M.uponSanitizeShadowNode,p,null),ss(p),rs(p),p.content instanceof n&&_(p.content);ee(M.afterSanitizeShadowDOM,a,null)};return e.sanitize=function(_){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=null,d=null,y=null,B=null;if(_t=!_,_t&&(_="<!-->"),typeof _!="string"&&!ts(_))if(typeof _.toString=="function"){if(_=_.toString(),typeof _!="string")throw De("dirty is not a string, aborting")}else throw De("toString is not a function");if(!e.isSupported)return _;if(ut||mt(a),e.removed=[],typeof _=="string"&&(we=!1),we){if(_.nodeName){const X=L(_.nodeName);if(!O[X]||be[X])throw De("root node is forbidden and cannot be sanitized in-place")}}else if(_ instanceof l)p=Jt("<!---->"),d=p.ownerDocument.importNode(_,!0),d.nodeType===Ae.element&&d.nodeName==="BODY"||d.nodeName==="HTML"?p=d:p.appendChild(d);else{if(!ue&&!he&&!re&&_.indexOf("<")===-1)return R&&$e?R.createHTML(_):_;if(p=Jt(_),!p)return ue?null:$e?te:""}p&&pt&&K(p.firstChild);const N=es(we?_:p);for(;y=N.nextNode();)ss(y),rs(y),y.content instanceof n&&ti(y.content);if(we)return _;if(ue){if(We)for(B=ne.call(p.ownerDocument);p.firstChild;)B.appendChild(p.firstChild);else B=p;return(I.shadowroot||I.shadowrootmode)&&(B=Hs.call(s,B,!0)),B}let G=re?p.outerHTML:p.innerHTML;return re&&O["!doctype"]&&p.ownerDocument&&p.ownerDocument.doctype&&p.ownerDocument.doctype.name&&W(Ws,p.ownerDocument.doctype.name)&&(G="<!DOCTYPE "+p.ownerDocument.doctype.name+`>
`+G),he&&Ye([rt,ot,at],X=>{G=Ee(G,X," ")}),R&&$e?R.createHTML(G):G},e.setConfig=function(){let _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mt(_),ut=!0},e.clearConfig=function(){_e=null,ut=!1},e.isValidAttribute=function(_,a,p){_e||mt({});const d=L(_),y=L(a);return is(d,y,p)},e.addHook=function(_,a){typeof a=="function"&&Te(M[_],a)},e.removeHook=function(_,a){if(a!==void 0){const p=Ki(M[_],a);return p===-1?void 0:Xi(M[_],p,1)[0]}return gs(M[_])},e.removeHooks=function(_){M[_]=[]},e.removeAllHooks=function(){M=xs()},e}var _n=$s();class gn{constructor(e,t,s,i){this._domDialog=e,this._pickedPresetList=t,this._finalDialogYesNoSettings={},this._onPresetPickedCallback=s,this._openPromiseResolve=void 0,this._isDescriptionHtml=!1,this._favoritePresets=i}load(){return new Promise(e=>{this._domDialog.load("./tabs/presets/DetailedDialog/PresetsDetailedDialog.html",()=>{this._setupdialog(),e()})})}open(e,t,s){return this._presetsRepo=t,this._preset=e,this._showPresetRepoName=s,this._setLoadingState(!0),this._domDialog[0].showModal(),this._optionsShowedAtLeastOnce=!1,this._isPresetPickedOnClose=!1,this._presetsRepo.loadPreset(this._preset).then(()=>{this._loadPresetUi(),this._setLoadingState(!1),this._setFinalYesNoDialogSettings()}).catch(i=>{console.error(i);const n=w.getMessage("presetsLoadError");this._showError(n)}),new Promise(i=>this._openPromiseResolve=i)}_setFinalYesNoDialogSettings(){this._finalDialogYesNoSettings={title:w.getMessage("presetsWarningDialogTitle"),text:C.escapeHtml(this._preset.completeWarning),buttonYesText:w.getMessage("presetsWarningDialogYesButton"),buttonNoText:w.getMessage("presetsWarningDialogNoButton"),buttonYesCallback:()=>this._pickPresetFwVersionCheck(),buttonNoCallback:null}}_getFinalCliText(){const e=this._domOptionsSelect.multipleSelect("getSelects","value");return this._presetsRepo.removeUncheckedOptions(this._preset.originalPresetCliStrings,e)}_loadPresetUi(){this._loadDescription(),this._domGitHubLink.attr("href",this._presetsRepo.getPresetOnlineLink(this._preset)),this._preset.discussion?(this._domDiscussionLink.removeClass(C.buttonDisabledClass),this._domDiscussionLink.attr("href",this._preset.discussion)):this._domDiscussionLink.addClass(C.buttonDisabledClass),this._titlePanel.empty(),new ge(this._titlePanel,this._preset,this._presetsRepo,!1,this._showPresetRepoName,()=>this._setLoadingState(!1),this._favoritePresets).load(),this._loadOptionsSelect(),this._updateFinalCliText(),this._showCliText(!1)}_loadDescription(){var t;let e=(t=this._preset.description)==null?void 0:t.join(`
`);switch(this._preset.parser){case"MARKED":this._isDescriptionHtml=!0,e=P.parse(e),e=_n.sanitize(e),this._domDescriptionHtml.html(e),C.addLinksTargetBlank(this._domDescriptionHtml);break;default:this._isDescriptionHtml=!1,this._domDescriptionText.text(e);break}}_updateFinalCliText(){this._domCliText.text(this._getFinalCliText().join(`
`))}_setLoadingState(e){this._domProperties.toggle(!e),this._domLoading.toggle(e),this._domError.toggle(!1),e?this._domButtonApply.addClass(C.buttonDisabledClass):this._domButtonApply.removeClass(C.buttonDisabledClass)}_showError(e){this._domError.toggle(!0),this._domError.text(e),this._domProperties.toggle(!1),this._domLoading.toggle(!1),this._domButtonApply.addClass(C.buttonDisabledClass)}_readDom(){this._domButtonApply=f("#presets_detailed_dialog_applybtn"),this._domButtonCancel=f("#presets_detailed_dialog_closebtn"),this._domLoading=f("#presets_detailed_dialog_loading"),this._domError=f("#presets_detailed_dialog_error"),this._domProperties=f("#presets_detailed_dialog_properties"),this._titlePanel=f(".preset_detailed_dialog_title_panel"),this._domDescriptionText=f("#presets_detailed_dialog_text_description"),this._domDescriptionHtml=f("#presets_detailed_dialog_html_description"),this._domCliText=f("#presets_detailed_dialog_text_cli"),this._domGitHubLink=this._domDialog.find("#presets_open_online"),this._domDiscussionLink=this._domDialog.find("#presets_open_discussion"),this._domOptionsSelect=f("#presets_options_select"),this._domOptionsSelectPanel=f("#presets_options_panel"),this._domButtonCliShow=f("#presets_cli_show"),this._domButtonCliHide=f("#presets_cli_hide")}_showCliText(e){this._domDescriptionText.toggle(!e&&!this._isDescriptionHtml),this._domDescriptionHtml.toggle(!e&&this._isDescriptionHtml),this._domCliText.toggle(e),this._domButtonCliShow.toggle(!e),this._domButtonCliHide.toggle(e)}_createOptionsSelect(e){e.forEach(t=>{t.childs?this._addOptionGroup(this._domOptionsSelect,t):this._addOption(this._domOptionsSelect,t,!1)}),this._domOptionsSelect.multipleSelect({placeholder:w.getMessage("presetsOptionsPlaceholder"),formatSelectAll(){return w.getMessage("dropDownSelectAll")},formatAllSelected(){return w.getMessage("dropDownAll")},onClick:()=>this._optionsSelectionChanged(),onCheckAll:()=>this._optionsSelectionChanged(),onUncheckAll:()=>this._optionsSelectionChanged(),onOpen:()=>this._optionsOpened(),onBeforeClick:t=>this._ensureMutuallyExclusiveOptions(t),hideOptgroupCheckboxes:!0,singleRadio:!0,selectAll:!1,styler:function(t){let s="";return t.type==="optgroup"?s="font-weight: bold;":t.classes.includes("optionHasParent")&&(s="padding-left: 22px;"),s}})}_optionsOpened(){this._optionsShowedAtLeastOnce=!0}_ensureMutuallyExclusiveOptions(e){const t=e._key,s=t.indexOf("_"),i=t.lastIndexOf("_"),n=t.slice(s+1,i),o=this._preset.options[n];if(o!=null&&o.isExclusive){const l=this._domOptionsSelect.find(`optgroup[label="${o.name}"]`).children().map(function(){return f(this).attr("value")}).get(),c=this._domOptionsSelect.multipleSelect("getSelects").filter(h=>!l.includes(h));this._domOptionsSelect.multipleSelect("setSelects",c)}}_addOptionGroup(e,t){const s=f(`<optgroup label="${t.name}"></optgroup>`);t.childs.forEach(i=>{this._addOption(s,i,!0,t.isExclusive)}),e.append(s)}_addOption(e,t,s){let i='selected="selected"';t.checked||(i="");let n="";s&&(n='class="optionHasParent"'),e.append(`<option value="${t.name}" ${i} ${n}>${t.name}</option>`)}_optionsSelectionChanged(){this._updateFinalCliText()}_destroyOptionsSelect(){this._domOptionsSelect.multipleSelect("destroy")}_loadOptionsSelect(){const e=this._preset.options.length!==0;this._domOptionsSelect.empty(),this._domOptionsSelectPanel.toggle(e),e&&this._createOptionsSelect(this._preset.options),this._domOptionsSelect.multipleSelect("refresh")}_setupdialog(){w.localizePage(),this._readDom(),this._domButtonApply.on("click",()=>this._onApplyButtonClicked()),this._domButtonCancel.on("click",()=>this._onCancelButtonClicked()),this._domButtonCliShow.on("click",()=>this._showCliText(!0)),this._domButtonCliHide.on("click",()=>this._showCliText(!1)),this._domDialog.on("close",()=>this._onClose())}_onApplyButtonClicked(){if(this._preset.force_options_review&&!this._optionsShowedAtLeastOnce){const e={title:w.getMessage("warningTitle"),text:w.getMessage("presetsReviewOptionsWarning"),buttonConfirmText:w.getMessage("close")};C.showInformationDialog(e)}else this._preset.completeWarning?C.showYesNoDialog(this._finalDialogYesNoSettings):this._pickPresetFwVersionCheck()}_pickPreset(){var s;const e=this._getFinalCliText(),t=new Ps(this._preset,e,this._presetsRepo);this._pickedPresetList.push(t),(s=this._onPresetPickedCallback)==null||s.call(this),this._isPresetPickedOnClose=!0,this._onCancelButtonClicked()}_pickPresetFwVersionCheck(){let e=!1;for(const t of this._preset.firmware_version)if(Pt.CONFIG.flightControllerVersion.startsWith(t)){e=!0;break}if(e)this._pickPreset();else{const t={title:w.getMessage("presetsWarningDialogTitle"),text:w.getMessage("presetsWarningWrongVersionConfirmation",[this._preset.firmware_version,Pt.CONFIG.flightControllerVersion]),buttonYesText:w.getMessage("presetsWarningDialogYesButton"),buttonNoText:w.getMessage("presetsWarningDialogNoButton"),buttonYesCallback:()=>this._pickPreset(),buttonNoCallback:null};C.showYesNoDialog(t)}}_onCancelButtonClicked(){this._domDialog[0].close()}_onClose(){var e;this._destroyOptionsSelect(),(e=this._openPromiseResolve)==null||e.call(this,this._isPresetPickedOnClose)}}class Ne{constructor(e){this._settings=e}readPresetProperties(e,t){const s=["description","discussion","warning","disclaimer","include_warning","include_disclaimer","discussion","force_options_review","parser"],i={};e.options=[],s.forEach(n=>{i[n]=this._settings.presetsFileMetadata[n],e[n]=void 0}),e._currentOptionGroup=void 0;for(const n of t)n.startsWith(this._settings.MetapropertyDirective)&&this._parseAttributeLine(e,n,i);delete e._currentOptionGroup}_parseAttributeLine(e,t,s){t=t.slice(this._settings.MetapropertyDirective.length).trim();const i=t.toLowerCase();let n=!1;for(const o in s){const l=`${o.toLowerCase()}:`;i.startsWith(l)&&(t=t.slice(l.length).trim(),this._parseProperty(e,t,o),n=!0)}!n&&i.startsWith(this._settings.OptionsDirectives.OPTION_DIRECTIVE)&&this._parseOptionDirective(e,t)}_parseOptionDirective(e,t){const s=t.toLowerCase();if(s.startsWith(this._settings.OptionsDirectives.BEGIN_OPTION_DIRECTIVE)){const i=this._getOption(t);e._currentOptionGroup?e._currentOptionGroup.childs.push(i):e.options.push(i)}else if(s.startsWith(this._settings.OptionsDirectives.BEGIN_OPTION_GROUP_DIRECTIVE)){const i=this._getOptionGroup(t);e._currentOptionGroup=i,e.options.push(i)}else s.startsWith(this._settings.OptionsDirectives.END_OPTION_GROUP_DIRECTIVE)&&(e._currentOptionGroup=void 0)}_getOption(e){const t=e.slice(this._settings.OptionsDirectives.BEGIN_OPTION_DIRECTIVE.length).trim(),s=t.toLowerCase(),i=this._isOptionChecked(s),n=new RegExp(this._escapeRegex(this._settings.OptionsDirectives.OPTION_CHECKED),"gi"),o=new RegExp(this._escapeRegex(this._settings.OptionsDirectives.OPTION_UNCHECKED),"gi");let l=t.replace(n,"");return l=l.replace(o,"").trim(),{name:l.slice(1).trim(),checked:i}}_getOptionGroup(e){const t=e.toLowerCase(),s=this._settings.OptionsDirectives.EXCLUSIVE_OPTION_GROUP,i=t.includes(s);let n;if(i){const o=s.length;n=e.slice(t.lastIndexOf(s)+o-1).trim()}else n=e.slice(this._settings.OptionsDirectives.BEGIN_OPTION_GROUP_DIRECTIVE.length).trim();return{name:n.slice(1).trim(),childs:[],isExclusive:i}}_isOptionChecked(e){return e.includes(this._settings.OptionsDirectives.OPTION_CHECKED)}_parseProperty(e,t,s){switch(this._settings.presetsFileMetadata[s].type){case this._settings.MetadataTypes.STRING_ARRAY:this._processArrayProperty(e,t,s);break;case this._settings.MetadataTypes.STRING:this._processStringProperty(e,t,s);break;case this._settings.MetadataTypes.FILE_PATH:this._processStringProperty(e,t,s);break;case this._settings.MetadataTypes.FILE_PATH_ARRAY:this._processArrayProperty(e,t,s);break;case this._settings.MetadataTypes.BOOLEAN:this._processBooleanProperty(e,t,s);break;case this._settings.MetadataTypes.PARSER:this._processParserProperty(e,t,s);break;default:this.console.err(`Parcing preset: unknown property type '${this._settings.presetsFileMetadata[s].type}' for the property '${s}'`)}}_processParserProperty(e,t,s){e[s]=t}_processBooleanProperty(e,t,s){const i=["true","yes"],n=t.toLowerCase();let o=!1;i.includes(n)&&(o=!0),e[s]=o}_processArrayProperty(e,t,s){e[s]||(e[s]=[]),e[s].push(t)}_processStringProperty(e,t,s){e[s]=t}_getOptionName(e){const t=e.slice(this._settings.OptionsDirectives.BEGIN_OPTION_DIRECTIVE.length).trim(),s=new RegExp(this._escapeRegex(`${this._settings.OptionsDirectives.OPTION_CHECKED}:`),"gi"),i=new RegExp(this._escapeRegex(`${this._settings.OptionsDirectives.OPTION_UNCHECKED}:`),"gi");let n=t.replace(s,"");return n=n.replace(i,"").trim(),n}_escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}removeUncheckedOptions(e,t){let s=[],i=!1;const n=t.map(o=>o.toLowerCase());return e.forEach(o=>{if(this._isLineAttribute(o)){const l=this._removeAttributeDirective(o);if(this._isOptionBegin(l)){const u=this._getOptionName(l).toLowerCase();n.includes(u)||(i=!0)}else this._isOptionEnd(l)&&(i=!1)}else i||s.push(o)}),s=this._removeExcessiveEmptyLines(s),s}_removeExcessiveEmptyLines(e){const t=[];let s=!1;return e.forEach(i=>{(i!==""||!s)&&t.push(i),i===""?s=!0:s=!1}),t}_isLineAttribute(e){return e.trim().startsWith(this._settings.MetapropertyDirective)}_isOptionBegin(e){return e.toLowerCase().startsWith(this._settings.OptionsDirectives.BEGIN_OPTION_DIRECTIVE)}_isOptionEnd(e){return e.toLowerCase().startsWith(this._settings.OptionsDirectives.END_OPTION_DIRECTIVE)}_removeAttributeDirective(e){return e.trim().slice(this._settings.MetapropertyDirective.length).trim()}isIncludeFound(e){for(const t of e)if(Ne._sRegExpInclude.exec(t)!==null)return!0;return!1}}Ne._sRegExpInclude=/^#\$[ ]+?INCLUDE:[ ]+?(?<filePath>\S+$)/;class zs{constructor(e,t,s,i){this._urlRaw=e,this._urlViewOnline=t,this._index=null,this._name=i,this._official=s}get index(){return this._index}get official(){return this._official}get name(){return this._name}loadIndex(){return fetch(`${this._urlRaw}index.json`,{cache:"no-cache"}).then(e=>e.json()).then(e=>{this._index=e,this._settings=this._index.settings,this._PresetParser=new Ne(this._index.settings)})}getPresetOnlineLink(e){return this._urlViewOnline+e.fullPath}removeUncheckedOptions(e,t){return this._PresetParser.removeUncheckedOptions(e,t)}_parceInclude(e,t,s){for(let i=0;i<e.length;i++){const n=Ne._sRegExpInclude.exec(e[i]);if(n!==null){t.push(i);const o=this._urlRaw+n.groups.filePath,l=this._loadPresetText(o);s.push(l)}}}_executeIncludeOnce(e){const t=[],s=[];return this._parceInclude(e,t,s),Promise.all(s).then(i=>{for(let o=0;o<i.length;o++)e[t[o]]=i[o];return e.join(`
`).split(`
`).map(o=>o.trim())})}_executeIncludeNested(e){return this._PresetParser.isIncludeFound(e)?this._executeIncludeOnce(e).then(s=>this._executeIncludeNested(s)):Promise.resolve(e)}loadPreset(e){return this._loadPresetText(this._urlRaw+e.fullPath).then(s=>{let i=s.split(`
`);return i=i.map(n=>n.trim()),this._PresetParser.readPresetProperties(e,i),i}).then(s=>this._executeIncludeNested(s)).then(s=>(e.originalPresetCliStrings=s,this._loadPresetWarning(e)))}_loadPresetWarning(e){let t="";e.warning&&(t+=(t?`
`:"")+e.warning),e.disclaimer&&(t+=(t?`
`:"")+e.disclaimer);const s=[].concat(...[e.include_warning,e.include_disclaimer].filter(Array.isArray));return this._loadFilesInOneText(s).then(i=>{t+=(t?`
`:"")+i,e.completeWarning=t})}_loadFilesInOneText(e){const t=[];return e==null||e.forEach(s=>{const i=this._urlRaw+s;t.push(this._loadPresetText(i))}),Promise.all(t).then(s=>s.join(`
`))}_loadPresetText(e){return new Promise((t,s)=>{fetch(e,{cache:"no-cache"}).then(i=>i.text()).then(i=>t(i)).catch(i=>{console.error(i),s(i)})})}}class mn extends zs{constructor(e,t,s,i){let n=e.trim();n.endsWith("/")||(n+="/");let o=t.trim();o.startsWith("/")&&(o=o.slice(1)),o.endsWith("/")&&(o=o.slice(0,-1));const l=`https://raw.githubusercontent.com${n.slice(18)}${o}/`,u=`${n}blob/${o}/`;super(l,u,s,i)}}class kn extends zs{constructor(e,t,s){let i=e.trim();i.endsWith("/")||(i+="/");const n=i,o=i;super(n,o,t,s)}}class ae{constructor(e,t,s=""){this.name=e,this.url=t,this.gitHubBranch=s,this.official=!1}static isUrlGithubRepo(e){return e.trim().toLowerCase().startsWith("https://github.com/")}static containsBranchName(e){return e.includes("/tree/")}static getBranchName(e){const t=/https:\/\/github\.com\/[^\/]+\/[^\/]+\/tree\/([^\/]+)/,s=e.match(t);return s?s[1]:null}}class Be{constructor(e,t){this._parentDiv=e,this._presetSource=t,this._active=!1}get presetSource(){return this._presetSource}load(){return Be.s_panelCounter++,this._domId=`source_panel_${Be.s_panelCounter}`,this._parentDiv.append(`<div id="${this._domId}"></div>`),this._domWrapperDiv=f(`#${this._domId}`),this._domWrapperDiv.toggle(!1),new Promise(e=>{this._domWrapperDiv.load("./tabs/presets/SourcesDialog/SourcePanel.html",()=>{this._setupHtml(),e()})})}setOnSelectedCallback(e){this._onSelectedCallback=e}setOnDeleteCallback(e){this._onDeletedCallback=e}setOnActivateCallback(e){this._onActivateCallback=e}setOnDeactivateCallback(e){this._onDeactivateCallback=e}setOnSaveCallback(e){this._onSaveCallback=e}setSelected(e){this._setUiSelected(e)}get active(){return this._active}setActive(e){this._active=e,this._domDivSelectedIndicator.toggle(this._active),this._domButtonActivate.toggle(!e),this._domButtonDeactivate.toggle(e)}_setUiOfficial(){this.presetSource.official&&(this._domButtonSave.toggle(!1),this._domButtonReset.toggle(!1),this._domButtonDelete.toggle(!1),this._domEditName.prop("disabled",!0),this._domEditUrl.prop("disabled",!0),this._domEditGitHubBranch.prop("disabled",!0))}_setUiSelected(e){this._selected!==e&&(this._domDivNoEditing.toggle(!e),this._domDivEditing.toggle(e),this._onResetButtonClick(),this._updateNoEditingName(),this._domDivInnerPanel.toggleClass("presets_source_panel_not_selected",!e),this._domDivInnerPanel.toggleClass("presets_source_panel_selected",e),e?this._domDivInnerPanel.off("click"):this._domDivInnerPanel.on("click",()=>this._onPanelSelected()),this._selected=e)}_updateNoEditingName(){this._domDivNoEditingName.text(this._presetSource.name)}_setupHtml(){this._readDom(),this._setupActions(),this.setSelected(!1),this._setIsSaved(!0),this._checkIfGithub(),this.setActive(this._active),this._setUiOfficial(),w.localizePage(),this._domWrapperDiv.toggle(!0)}_setupActions(){this._domButtonSave.on("click",()=>this._onSaveButtonClick()),this._domButtonReset.on("click",()=>this._onResetButtonClick()),this._domButtonDelete.on("click",()=>this._onDeleteButtonClick()),this._domButtonActivate.on("click",()=>this._onActivateButtonClick()),this._domButtonDeactivate.on("click",()=>this._onDeactivateButtonClick()),this._domEditName.on("input",()=>this._onInputChange()),this._domEditUrl.on("input",()=>this._onInputChange()),this._domEditGitHubBranch.on("input",()=>this._onInputChange())}_onPanelSelected(){var e;this._setUiSelected(!0),(e=this._onSelectedCallback)==null||e.call(this,this)}_checkIfGithub(){const e=ae.isUrlGithubRepo(this._domEditUrl.val());this._domDivGithubBranch.toggle(e)}_onInputChange(){this._checkIfGithub(),ae.containsBranchName(this._domEditUrl.val())&&(this._domEditGitHubBranch.val(ae.getBranchName(this._domEditUrl.val())),this._domEditUrl.val(this._domEditUrl.val().split("/tree/")[0])),this._setIsSaved(!1)}_onSaveButtonClick(){var e;this._presetSource.name=this._domEditName.val(),this._presetSource.url=this._domEditUrl.val(),this._presetSource.gitHubBranch=this._domEditGitHubBranch.val(),this._setIsSaved(!0),(e=this._onSaveCallback)==null||e.call(this,this)}_onResetButtonClick(){this._domEditName.val(this._presetSource.name),this._domEditUrl.val(this._presetSource.url),this._domEditGitHubBranch.val(this._presetSource.gitHubBranch),this._checkIfGithub(),this._setIsSaved(!0)}_onDeleteButtonClick(){var e;this._domWrapperDiv.remove(),(e=this._onDeletedCallback)==null||e.call(this,this)}_onActivateButtonClick(){var e;this._onSaveButtonClick(),this.setActive(!0),(e=this._onActivateCallback)==null||e.call(this,this)}_onDeactivateButtonClick(){var e;this._onSaveButtonClick(),this.setActive(!1),(e=this._onDeactivateCallback)==null||e.call(this,this)}_setIsSaved(e){e?(this._domButtonSave.addClass(C.buttonDisabledClass),this._domButtonReset.addClass(C.buttonDisabledClass)):(this._domButtonSave.removeClass(C.buttonDisabledClass),this._domButtonReset.removeClass(C.buttonDisabledClass))}_readDom(){this._domDivInnerPanel=this._domWrapperDiv.find(".presets_source_panel"),this._domDivNoEditing=this._domWrapperDiv.find(".presets_source_panel_no_editing"),this._domDivEditing=this._domWrapperDiv.find(".presets_source_panel_editing"),this._domEditName=this._domWrapperDiv.find(".presets_source_panel_editing_name_field"),this._domEditUrl=this._domWrapperDiv.find(".presets_source_panel_editing_url_field"),this._domEditGitHubBranch=this._domWrapperDiv.find(".presets_source_panel_editing_branch_field"),this._domButtonSave=this._domWrapperDiv.find(".presets_source_panel_save"),this._domButtonReset=this._domWrapperDiv.find(".presets_source_panel_reset"),this._domButtonActivate=this._domWrapperDiv.find(".presets_source_panel_activate"),this._domButtonDeactivate=this._domWrapperDiv.find(".presets_source_panel_deactivate"),this._domButtonDelete=this._domWrapperDiv.find(".presets_source_panel_delete"),this._domDivGithubBranch=this._domWrapperDiv.find(".presets_source_panel_editing_github_branch"),this._domDivNoEditingName=this._domWrapperDiv.find(".presets_source_panel_no_editing_name"),this._domDivSelectedIndicator=this._domWrapperDiv.find(".presets_source_panel_no_editing_selected")}}Be.s_panelCounter=0;class Sn{constructor(e){this._domDialog=e,this._sourceSelectedPromiseResolve=null,this._sourcesPanels=[],this._sources=[],this._activeSourceIndexes=[0]}load(){return new Promise(e=>{this._domDialog.load("./tabs/presets/SourcesDialog/SourcesDialog.html",()=>{this._setupDialog(),this._initializeSources(),e()})})}show(){return this._domDialog[0].showModal(),new Promise(e=>this._sourceSelectedPromiseResolve=e)}getActivePresetSources(){return this._activeSourceIndexes.map(e=>this._sources[e])}get isThirdPartyActive(){return this.getActivePresetSources().filter(e=>!e.official).length>0}_initializeSources(){this._sources=this._readSourcesFromStorage(),this._activeSourceIndexes=this._readActiveSourceIndexFromStorage(this._sources.length);for(let e=0;e<this._sources.length;e++){const t=this._activeSourceIndexes.includes(e);this._addNewSourcePanel(this._sources[e],t,!1)}}_readSourcesFromStorage(){const e=this._createOfficialSource(),t=this._createSecondaryOfficialSource();let i=Xe("PresetSources").PresetSources;return i&&i.length>0?i[0]=e:i=[e,t],i.length===1&&i.push(t),i}_readActiveSourceIndexFromStorage(e){return Xe("PresetSourcesActiveIndexes").PresetSourcesActiveIndexes||[0]}_createOfficialSource(){const e=new ae("Ovobot Official Presets","https://api.Ovobot.com/firmware-presets/","");return e.official=!0,e}_createSecondaryOfficialSource(){const e=new ae("Ovobot Presets - GitHub BACKUP","https://github.com/Ovobot/firmware-presets","backup");return e.official=!1,e}_setupDialog(){this._readDom(),this._setupEvents(),this._domButtonAddNew.on("click",()=>this._onAddNewSourceButtonClick()),w.localizePage()}_onAddNewSourceButtonClick(){const e=new ae(w.getMessage("presetsSourcesDialogDefaultSourceName"),"","");this._addNewSourcePanel(e).then(()=>{this._scrollDown(),this._updateSourcesFromPanels()})}_scrollDown(){this._domDivSourcesPanel.stop(),this._domDivSourcesPanel.animate({scrollTop:`${this._domDivSourcesPanel.prop("scrollHeight")}px`})}_addNewSourcePanel(e,t=!1,s=!0){const i=new Be(this._domDivSourcesPanel,e);return this._sourcesPanels.push(i),i.load().then(()=>{i.setOnSelectedCallback(n=>this._onSourcePanelSelected(n)),i.setOnDeleteCallback(n=>this._onSourcePanelDeleted(n)),i.setOnActivateCallback(n=>this._onSourcePanelActivated(n)),i.setOnDeactivateCallback(n=>this._onSourcePanelDeactivated(n)),i.setOnSaveCallback(()=>this._onSourcePanelSaved()),i.setActive(t),s&&this._onSourcePanelSelected(i)})}_setupEvents(){this._domButtonClose.on("click",()=>this._onCloseButtonClick()),this._domDialog.on("close",()=>this._onClose())}_onCloseButtonClick(){this._domDialog[0].close()}_onClose(){var e;(e=this._sourceSelectedPromiseResolve)==null||e.call(this)}_readPanels(){this._sources=[],this._activeSourceIndexes=[];for(let e=0;e<this._sourcesPanels.length;e++)this._sources.push(this._sourcesPanels[e].presetSource),this._sourcesPanels[e].active&&this._activeSourceIndexes.push(e)}_saveSources(){Qe({PresetSources:this._sources}),Qe({PresetSourcesActiveIndexes:this._activeSourceIndexes})}_updateSourcesFromPanels(){this._readPanels(),this._saveSources()}_onSourcePanelSaved(){this._updateSourcesFromPanels()}_onSourcePanelSelected(e){for(const t of this._sourcesPanels)t!==e?t.setSelected(!1):t.setSelected(!0)}_onSourcePanelDeleted(e){this._sourcesPanels=this._sourcesPanels.filter(t=>t!==e),e.active&&this._sourcesPanels[0].setActive(!0),this._updateSourcesFromPanels()}_onSourcePanelActivated(e){for(const t of this._sourcesPanels)t===e&&t.setActive(!0);this._updateSourcesFromPanels()}_onSourcePanelDeactivated(e){for(const t of this._sourcesPanels)t===e&&t.setActive(!1);this._updateSourcesFromPanels()}_readDom(){this._domButtonAddNew=f("#presets_sources_dialog_add_new"),this._domButtonClose=f("#presets_sources_dialog_close"),this._domDivSourcesPanel=f(".presets_sources_dialog_sources")}}const k={presetsRepo:[],cliEngine:null,pickedPresetList:[],majorVersion:1};k.initialize=function(r){const e=this;e.cliEngine=new E(e),e.cliEngine.setProgressCallback(t=>this.onApplyProgressChange(t)),e._presetPanels=[],f("#content").load("./tabs/presets/presets.html",()=>e.onHtmlLoad(r)),C.active_tab!=="presets"&&(C.active_tab="presets"),ri()};k.readDom=function(){this._divGlobalLoading=f("#presets_global_loading"),this._divGlobalLoadingError=f("#presets_global_loading_error"),this._divCli=f("#presets_cli"),this._divMainContent=f("#presets_main_content"),this._selectCategory=f("#presets_filter_category"),this._selectKeyword=f("#presets_filter_keyword"),this._selectAuthor=f("#presets_filter_author"),this._selectFirmwareVersion=f("#presets_filter_firmware_version"),this._selectStatus=f("#presets_filter_status"),this._inputTextFilter=f("#presets_filter_text"),this._divPresetList=f("#presets_list"),this._domButtonSave=f("#presets_save_button"),this._domButtonCancel=f("#presets_cancel_button"),this._domReloadButton=f("#presets_reload"),this._domContentWrapper=f("#presets_content_wrapper"),this._domProgressDialog=f("#presets_apply_progress_dialog")[0],this._domProgressDialogProgressBar=f(".presets_apply_progress_dialog_progress_bar"),this._domButtonaSaveAnyway=f("#presets_cli_errors_save_anyway_button"),this._domButtonCliExit=f("#presets_cli_errors_exit_no_save_button"),this._domDialogCliErrors=f("#presets_cli_errors_dialog"),this._domButtonSaveBackup=f(".presets_save_config"),this._domButtonLoadBackup=f(".presets_load_config"),this._domButtonPresetSources=f(".presets_sources_show"),this._domWarningNotOfficialSource=f(".presets_warning_not_official_source"),this._domWarningFailedToLoadRepositories=f(".presets_failed_to_load_repositories"),this._domWarningBackup=f(".presets_warning_backup"),this._domButtonHideBackupWarning=f(".presets_warning_backup_button_hide"),this._domListNoFound=f("#presets_list_no_found"),this._domListTooManyFound=f("#presets_list_too_many_found")};k.getPickedPresetsCli=function(){let r=[];return this.pickedPresetList.forEach(e=>{r.push(...e.presetCli)}),r=r.filter(e=>e.trim()!==""),r};k.onApplyProgressChange=function(r){this._domProgressDialogProgressBar.val(r)};k.applyCommandsList=function(r){r.forEach(e=>{this.cliEngine.sendLine(e)})};k.onSaveClick=function(){this._domProgressDialogProgressBar.val(0),this._domProgressDialog.showModal();const r=this.cliEngine.errorsCount;this.activateCli().then(()=>{const e=this.getPickedPresetsCli();this.markPickedPresetsAsFavorites(),this.cliEngine.executeCommandsArray(e).then(()=>{this.cliEngine.errorsCount!==r?(this._domProgressDialog.close(),this._domDialogCliErrors[0].showModal(),this._domDialogCliErrorsSavePressed=!1):(this._domProgressDialog.close(),this.cliEngine.sendLine(E.s_commandSave),this.disconnectCliMakeSure())})})};k.markPickedPresetsAsFavorites=function(){for(const r of this.pickedPresetList)r.presetRepo!==void 0&&se.add(r.preset,r.presetRepo);se.saveToStorage()};k.disconnectCliMakeSure=function(){C.timeout_add("disconnect",function(){f("a.connection_button__link").trigger("click")},500)};k.setupMenuButtons=function(){this._domButtonSave.on("click",()=>this.onSaveClick()),this._domButtonCancel.on("click",()=>{for(const r of this.pickedPresetList)r.preset.isPicked=!1;this.updateSearchResults(),this.pickedPresetList.length=0,this.enableSaveCancelButtons(!1)}),this._domButtonCliExit.on("click",()=>{this._domDialogCliErrorsSavePressed=!1,this._domDialogCliErrors[0].close()}),this._domButtonaSaveAnyway.on("click",()=>{this._domDialogCliErrorsSavePressed=!0,this._domDialogCliErrors[0].close(),this.cliEngine.sendLine(E.s_commandSave,null,()=>{this.cliEngine.sendLine(E.s_commandSave)}),this.disconnectCliMakeSure()}),this._domDialogCliErrors.on("close",()=>{this._domDialogCliErrorsSavePressed||(this._domDialogCliErrorsSavePressed=!0,this.cliEngine.sendLine(E.s_commandExit),this.disconnectCliMakeSure())}),this._domButtonSaveBackup.on("click",()=>this.onSaveConfigClick()),this._domButtonLoadBackup.on("click",()=>this.onLoadConfigClick()),this._domButtonPresetSources.on("click",()=>this.onPresetSourcesShowClick()),this._domButtonHideBackupWarning.on("click",()=>this.onButtonHideBackupWarningClick()),this._domButtonSave.toggleClass(C.buttonDisabledClass,!1),this._domButtonCancel.toggleClass(C.buttonDisabledClass,!1),this._domReloadButton.on("click",()=>this.reload()),this.enableSaveCancelButtons(!1)};k.enableSaveCancelButtons=function(r){this._domButtonSave.toggleClass(C.buttonDisabledClass,!r),this._domButtonCancel.toggleClass(C.buttonDisabledClass,!r)};k.onButtonHideBackupWarningClick=function(){this._domWarningBackup.toggle(!1),Qe({showPresetsWarningBackup:!1})};k.setupBackupWarning=function(){const r=Xe("showPresetsWarningBackup");r.showPresetsWarningBackup===void 0&&(r.showPresetsWarningBackup=!0);const e=!!r.showPresetsWarningBackup;this._domWarningBackup.toggle(e)};k.onPresetSourcesShowClick=function(){this.presetsSourcesDialog.show().then(()=>{this.reload()})};k.onSaveConfigClick=function(){const r=C.showWaitDialog({title:w.getMessage("presetsLoadingDumpAll"),buttonCancelCallback:null}),e={title:w.getMessage("warningTitle"),text:w.getMessage("dumpAllNotSavedWarning"),buttonConfirmText:w.getMessage("close")};this.activateCli().then(()=>this.readDumpAll()).then(t=>{const s="cli_backup",i="txt",n=t.join(`
`),o=oi(s,i);return Je.pickSaveFile(o,w.getMessage("fileSystemPickerFiles",{typeof:i.toUpperCase()}),`.${i}`).then(l=>Je.writeFile(l,n))}).then(()=>{r.close(),this.cliEngine.sendLine(E.s_commandExit)}).catch(()=>(r.close(),C.showInformationDialog(e))).then(()=>this.cliEngine.sendLine(E.s_commandExit))};k.readDumpAll=function(){let r=performance.now();const e=[E.s_commandDefaultsNoSave,""],t="PRESETS_READING_DUMP_INTERVAL";return this.cliEngine.subscribeOnRowCame(s=>{r=performance.now(),E.s_commandDiffAll!==s&&E.s_commandSave!==s&&e.push(s)}),this.cliEngine.sendLine(E.s_commandDiffAll),new Promise(s=>{C.interval_add(t,()=>{performance.now()-r>500&&(this.cliEngine.unsubscribeOnRowCame(),C.interval_remove(t),s(e))},500,!1)})};k.onLoadConfigClick=function(){const r="txt";Je.pickOpenFile(w.getMessage("fileSystemPickerFiles",{typeof:r.toUpperCase()}),`.${r}`).then(e=>(console.log("Reading VTX config from:",e.name),Je.readFile(e))).then(e=>{if(e){const t=e.split(`
`),s=new Ps({title:"user configuration"},t,void 0);this.pickedPresetList.push(s),this.onSaveClick()}}).catch(e=>{console.error("Failed loading presets config: ",e)})};k.onHtmlLoad=function(r){w.localizePage(),this.readDom(),this.setupMenuButtons(),this.setupBackupWarning(),this._inputTextFilter.attr("placeholder",`example: "karate race", or "5'' freestyle"`),this.presetsDetailedDialog=new gn(f("#presets_detailed_dialog"),this.pickedPresetList,()=>this.onPresetPickedCallback(),se),this.presetsSourcesDialog=new Sn(f("#presets_sources_dialog")),this.presetsDetailedDialog.load().then(()=>this.presetsSourcesDialog.load()).then(()=>{this.tryLoadPresets(),C.content_ready(r)})};k.onPresetPickedCallback=function(){this.enableSaveCancelButtons(!0)};k.activateCli=function(){return new Promise(r=>{Z.cliEngineActive=!0,this.cliEngine.setUi(f("#presets_cli_window"),f("#presets_cli_window_wrapper"),f("#presets_cli_command")),this.cliEngine.enterCliMode(),C.timeout_add("presets_enter_cli_mode_done",()=>{r()},500)})};k.reload=function(){this.resetInitialValues(),this.tryLoadPresets()};k.tryLoadPresets=function(){const r=this.presetsSourcesDialog.getActivePresetSources();this.presetsRepo=r.map(t=>ae.isUrlGithubRepo(t.url)?new mn(t.url,t.gitHubBranch,t.official,t.name):new kn(t.url,t.official,t.name)),this._divMainContent.toggle(!1),this._divGlobalLoadingError.toggle(!1),this._divGlobalLoading.toggle(!0),this._domWarningNotOfficialSource.toggle(this.presetsSourcesDialog.isThirdPartyActive);const e=[];Promise.all(this.presetsRepo.map(t=>t.loadIndex().catch(s=>e.push(t)))).then(()=>(this._domWarningFailedToLoadRepositories.toggle(e.length>0),this._domWarningFailedToLoadRepositories.html(w.getMessage("presetsFailedToLoadRepositories",{repos:e.map(t=>t.name).join("; ")})),this.presetsRepo=this.presetsRepo.filter(t=>!e.includes(t)),this.checkPresetSourceVersion())).then(()=>{this.presetsRepo.forEach(t=>se.addLastPickDate(t.index.presets,t)),this.prepareFilterFields(),this._divGlobalLoading.toggle(!1),this._divMainContent.toggle(!0)}).catch(t=>{this._divGlobalLoading.toggle(!1),this._divGlobalLoadingError.toggle(!0),console.error(t)})};k.multipleSelectComponentScrollFix=function(){return new Promise(r=>{C.timeout_add("hack_fix_multipleselect_scroll",()=>{this._selectCategory.multipleSelect("refresh"),this._selectKeyword.multipleSelect("refresh"),this._selectAuthor.multipleSelect("refresh"),this._selectFirmwareVersion.multipleSelect("refresh"),this._selectStatus.multipleSelect("refresh"),r()},100)})};k.checkPresetSourceVersion=function(){const r=this;return new Promise((e,t)=>{const s=r.presetsRepo.filter(i=>r.majorVersion!==i.index.majorVersion);if(s.length===0)e();else{const i=`${r.majorVersion}.X`,n=`${s[0].index.majorVersion}.${s[0].index.minorVersion}`,o={title:w.getMessage("presetsWarningDialogTitle"),text:w.getMessage("presetsVersionMismatch",{versionRequired:i,versionSource:n}),buttonYesText:w.getMessage("yes"),buttonNoText:w.getMessage("no"),buttonYesCallback:()=>e(),buttonNoCallback:()=>t("Preset source version mismatch")};C.showYesNoDialog(o)}})};function Re(r,e){return[...r.map(e).reduce((i,n)=>new Set([...i,...n]),new Set)].sort((i,n)=>i.localeCompare(n,void 0,{sensitivity:"base"}))}k.prepareFilterFields=function(){this._freezeSearch=!0,this.prepareFilterSelectField(this._selectCategory,Re(this.presetsRepo,r=>r.index.uniqueValues.category),3),this.prepareFilterSelectField(this._selectKeyword,Re(this.presetsRepo,r=>r.index.uniqueValues.keywords),3),this.prepareFilterSelectField(this._selectAuthor,Re(this.presetsRepo,r=>r.index.uniqueValues.author),1),this.prepareFilterSelectField(this._selectFirmwareVersion,Re(this.presetsRepo,r=>r.index.uniqueValues.firmware_version),2),this.prepareFilterSelectField(this._selectStatus,Re(this.presetsRepo,r=>r.index.settings.PresetStatusEnum),2),this.multipleSelectComponentScrollFix().then(()=>{this.preselectFilterFields(),this._inputTextFilter.on("input",()=>this.updateSearchResults()),this._freezeSearch=!1,this.updateSearchResults()})};k.preselectFilterFields=function(){const r=Pt.CONFIG.flightControllerVersion,e=[];for(const t of this.presetsRepo)for(const s of t.index.uniqueValues.firmware_version)r.startsWith(s)&&e.push(s);this._selectFirmwareVersion.multipleSelect("setSelects",e)};k.prepareFilterSelectField=function(r,e,t){r.multipleSelect("destroy"),r.multipleSelect({data:e,showClear:!0,minimumCountSelected:t,placeholder:w.getMessage("dropDownFilterDisabled"),onClick:()=>{this.updateSearchResults()},onCheckAll:()=>{this.updateSearchResults()},onUncheckAll:()=>{this.updateSearchResults()},formatSelectAll(){return w.getMessage("dropDownSelectAll")},formatAllSelected(){return w.getMessage("dropDownAll")}})};k.updateSearchResults=function(){if(!this._freezeSearch){const r={categories:this._selectCategory.multipleSelect("getSelects","text"),keywords:this._selectKeyword.multipleSelect("getSelects","text"),authors:this._selectAuthor.multipleSelect("getSelects","text"),firmwareVersions:this._selectFirmwareVersion.multipleSelect("getSelects","text"),status:this._selectStatus.multipleSelect("getSelects","text"),searchString:this._inputTextFilter.val().trim()};this.updateSelectStyle(),r.authors=r.authors.map(t=>t.toLowerCase());const e=this.getFitPresets(r);this.displayPresets(e)}};k.updateSelectStyle=function(){this.updateSingleSelectStyle(this._selectCategory),this.updateSingleSelectStyle(this._selectKeyword),this.updateSingleSelectStyle(this._selectAuthor),this.updateSingleSelectStyle(this._selectFirmwareVersion),this.updateSingleSelectStyle(this._selectStatus)};k.updateSingleSelectStyle=function(r){const t=r.multipleSelect("getSelects","text").length!==0;r.parent().find(f(".ms-choice")).toggleClass("presets_filter_select_nonempty",t)};k.displayPresets=function(r){this._presetPanels.forEach(t=>{t.remove()}),this._presetPanels=[];const e=60;this._domListTooManyFound.toggle(r.length>e),r.length=Math.min(r.length,e),this._domListNoFound.toggle(r.length===0),r.forEach(t=>{const s=new ge(this._divPresetList,t[0],t[1],!0,this.presetsSourcesDialog.isThirdPartyActive,se);s.load(),this._presetPanels.push(s),s.subscribeClick(this.presetsDetailedDialog,t[1])}),this._domListTooManyFound.appendTo(this._divPresetList)};k.getFitPresets=function(r){const e=[],t=new Set;for(const s of this.presetsRepo)for(const i of s.index.presets)this.isPresetFitSearch(i,r)&&!t.has(i.hash)&&(e.push([i,s]),t.add(i.hash));return e.sort((s,i)=>this.presetSearchPriorityComparer(s[0],i[0])),e};k.presetSearchPriorityComparer=function(r,e){return r.lastPickDate&&e.lastPickDate?e.lastPickDate-r.lastPickDate:r.lastPickDate||e.lastPickDate?r.lastPickDate?-1:1:r.priority>e.priority?-1:1};k.isPresetFitSearchStatuses=function(r,e){return e.status.length===0||e.status.includes(r.status)};k.isPresetFitSearchCategories=function(r,e){return!(e.categories.length!==0&&(r.category===void 0||!e.categories.includes(r.category)))};k.isPresetFitSearchKeywords=function(r,e){return!(e.keywords.length!==0&&(!Array.isArray(r.keywords)||e.keywords.filter(s=>r.keywords.includes(s)).length===0))};k.isPresetFitSearchAuthors=function(r,e){return!(e.authors.length!==0&&(r.author===void 0||!e.authors.includes(r.author.toLowerCase())))};k.isPresetFitSearchFirmwareVersions=function(r,e){return!(e.firmwareVersions.length!==0&&(!Array.isArray(r.firmware_version)||e.firmwareVersions.filter(s=>r.firmware_version.includes(s)).length===0))};k.isPresetFitSearchString=function(r,e){if(e.searchString){const t=r.keywords.join(" "),s=r.firmware_version.join(" "),i=[r.description,t,r.title,r.author,s,r.category].join(`
`).toLowerCase().replace("''",'"'),n=e.searchString.toLowerCase().replace("''",'"').split(" ");for(const o of n)if(!i.includes(o))return!1}return!0};k.isPresetFitSearch=function(r,e){return!(r.hidden||!this.isPresetFitSearchStatuses(r,e)||!this.isPresetFitSearchCategories(r,e)||!this.isPresetFitSearchKeywords(r,e)||!this.isPresetFitSearchAuthors(r,e)||!this.isPresetFitSearchFirmwareVersions(r,e)||!this.isPresetFitSearchString(r,e))};k.read=function(r){Ie.presets.cliEngine.readSerial(r)};k.cleanup=function(r){if(this.resetInitialValues(),!(Z.connectionValid&&Z.cliEngineActive&&Z.cliEngineValid)){r&&r();return}Ie.presets.cliEngine.close(()=>{r&&r()})};k.resetInitialValues=function(){Z.cliEngineActive=!1,Z.cliEngineValid=!1,Ie.presets.presetsRepo=[],Ie.presets.pickedPresetList.length=0,this._domProgressDialog.close()};Ie.presets=k;export{k as presets};
