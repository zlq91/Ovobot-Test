import{G as o,T as he,I as ve,aa as Ne,F as a,M as f,X as u,ab as Se}from"./DarkTheme-x8aAi6Mp.js";const J={};J.initialize=function(G){o.active_tab!="auto_test"&&(o.active_tab="auto_test");function oe(){le()}function le(){$("#content").load("./tabs/auto_test.html",fe)}oe();function fe(){ve.localizePage();const Q=$("#auto-test-button"),g=$("#model-gyro-status"),y=$("#model-adpter-status"),C=$("#model-fan-status"),T=$("#model-motor-status"),d=$("#model-cliff-status"),b=$(".test-result-empty"),L=$(".test-result-passed"),k=$(".test-result-failed"),ue=$(".yes-spray-btn"),re=$(".no-spary-btn"),de=$(".yes-voice-btn"),ce=$(".no-voice-btn"),c=$("#model-waterpump-status"),_=$("#model-voice-status");let r=[],s=[0,0,0,0,0,0,0],p=new Array(2),m=new Array(2),E=[],R=[],D=[],P=[],F=[],w=[],I=!1,U=!1,l,S=!0,V=!1,Y=0;const X=$(".dialogConfirmUnderingTest-Spary")[0],Z=$(".dialogConfirmUnderingTest-Voice")[0];x();function x(){let e,t,n=0;$("dialog").filter(function(){if($(this).prop("open"))return e=$(this),$(this).prop("open")}).length>0?t=$("#"+e.find("div.buttons").attr("id")+" a"):t=$("#auto-test-button a"),n=z(n,t),n=_e(n,t)}function z(e,t){return t.removeClass("focused"),t.eq(e).hasClass("no-click")?(e+=1,z(e,t)):(t.eq(e).addClass("focused"),t.eq(e).focus()),e}function _e(e,t){return t.on("keydown",function(n){n.key==="Tab"&&(n.preventDefault(),n.stopPropagation(),e=(e+1)%t.length,e=z(e,t))}),e}$(document).keydown(function(e){(e.which===13||e.key==="Enter")&&(e.preventDefault(),e.stopPropagation(),$(":focus").click(),x())}),Q.on("click",function(){Ae(),W(),o.interval_add("setup_auto_test_gyro_fast",se,50,!0),o.interval_add("setup_auto_test_cliff_fast",K,50,!0),o.interval_add("setup_auto_test_fast",pe,50,!0);let e=setTimeout(()=>{o.interval_remove("setup_auto_test_gyro_fast"),V=!0,me()},1e3);r.push(e),h()}),$(".retest-btn a").on("click",function(){$(this).hasClass("no-click")||(l=$(this).closest(".grid-row-content").attr("id"),Ne.isEmptyObject(l)==!1&&l!=null&&(l.indexOf("gyro")!==-1?(i(g,0),s[3]=0,E=[],R=[],D=[],P=[],F=[],w=[],o.interval_add("setup_auto_test_gyro_fast",se,50,!0),setTimeout(function(){o.interval_remove("setup_auto_test_gyro_fast"),V=!0},1e3)):l.indexOf("adpter")!==-1?(s[0]=0,i(y,0),j()):l.indexOf("fan")!==-1?(s[1]=0,i(C,0),ee()):l.indexOf("motor")!==-1?(s[2]=0,i(T,0),te()):l.indexOf("cliff")!==-1?(s[5]=0,p=[],m=[],i(d,0),o.interval_add("setup_auto_test_cliff_fast",K,50,!0),setTimeout(function(){o.interval_remove("setup_auto_test_cliff_fast"),V=!0},1e3)):l.indexOf("waterpump")!==-1?(s[4]=0,i(c,0),S=!1,W(),ie()):l.indexOf("voice")!==-1&&(s[6]=0,i(_,0),S=!1,W(),H()),h(l)))}),ue.on("click",function(){s[4]=2,i(c,2),X.close(),S&&H(),h(l)}),re.on("click",function(){s[4]=3,i(c,3),X.close(),S&&H(),h(l)}),de.on("click",function(){s[6]=2,i(_,2),Z.close(),h(l)}),ce.on("click",function(){s[6]=3,i(_,3),Z.close(),h(l)});function pe(){j(),K()}function me(){ie(),ee(),te()}function Ae(){ye(),s=[0,0,0,0,0,0,0],E=[],R=[],D=[],P=[],F=[],w=[],l=void 0,p=[],m=[],I=!1,U=!1,S=!0,i(g,0),i(y,0),i(C,0),i(T,0),i(d,0),i(c,0),i(_,0),b.removeClass("model-display"),L.addClass("model-display"),k.addClass("model-display")}function h(e){let t=setTimeout(()=>{V&&(e==g.attr("id")||e==null)&&(s[3]==2?i(g,2):s[3]==3&&i(g,3))},1010);r.push(t);let n=setTimeout(()=>{if((e==y.attr("id")||e==null)&&(s[0]==2?i(y,2):s[0]==3&&i(y,3)),(e==C.attr("id")||e==null)&&(s[1]==2?i(C,2):s[1]==3&&i(C,3)),(e==T.attr("id")||e==null)&&(s[2]==2?i(T,2):s[2]==3&&i(T,3)),e==d.attr("id")||e==null){let N=p[0]==null?!0:p[0].includes(0),M=p[1]==null?!0:p[1].includes(1);if(N||M?(s[5]=3,i(d,3)):(s[5]=2,i(d,2)),a.CONFIG.isCollision==1){let B=m[0]==null?!0:m[0].includes(0),q=m[1]==null?!0:m[1].includes(1);N||M||B||q?(s[5]=3,i(d,3)):(s[5]=2,i(d,2))}}Ce()},3010);r.push(n)}function W(){f.send_message(u.MSP_GET_FUNCTION,!1,!1,function(){a.OVOBOT_FUNCTION.isSprayFun==1?(I=!0,c.closest(".grid-row").removeClass("model-display")):(I=!1,s[4]=2,c.closest(".grid-row").addClass("model-display")),a.OVOBOT_FUNCTION.isVoiceFun==1?(U=!0,_.closest(".grid-row").removeClass("model-display")):(U=!1,s[6]=2,_.closest(".grid-row").addClass("model-display"))})}function j(){i(y,1),f.send_message(u.MSP_ADAPTER,!1,!1,function(){a.ANALOG.adapter>=18&&a.ANALOG.adapter<=26?s[0]=2:s[0]=3})}function ee(){i(C,1),O(1);let e=setTimeout(()=>{if(s[1]==2){f.send_message(u.MSP_SET_FAN,[60],!1,function(){O(1)});let t=setTimeout(()=>{f.send_message(u.MSP_SET_FAN,[0],!1,function(){O(1)})},2e3);r.push(t)}},100);r.push(e)}function te(){i(T,1),O(2);let e=setTimeout(()=>{if(s[2]==2){f.send_message(u.MSP_SET_MOTOR,[1],!1,function(){O(2)});let t=setTimeout(()=>{f.send_message(u.MSP_SET_MOTOR,[2],!1,function(){O(2)})},1e3);r.push(t);let n=setTimeout(()=>{f.send_message(u.MSP_SET_MOTOR,[0],!1,function(){O(2)})},2e3);r.push(n)}},100);r.push(e)}function O(e){f.send_message(u.MSP_ANALOG,!1,!1,function(){e==1&&(a.ANALOG.fanAdc<2500||a.ANALOG.fanAdc>3100)?s[1]=3:s[1]=2,e==2&&(a.ANALOG.leftMotorAdc<2500||a.ANALOG.leftMotorAdc>3100||a.ANALOG.rightMotorAdc<2500||a.ANALOG.rightMotorAdc>3100)?s[2]=3:s[2]=2})}function se(){i(g,1),f.send_message(u.MSP_RAW_IMU,!1,!1,function(){E.push(a.SENSOR_DATA.gyroscope[0]),R.push(a.SENSOR_DATA.gyroscope[1]),D.push(a.SENSOR_DATA.gyroscope[2]),P.push(a.SENSOR_DATA.accelerometer[0]),F.push(a.SENSOR_DATA.accelerometer[1]),w.push(a.SENSOR_DATA.accelerometer[2]),v(E,20,-20)||v(R,20,-20)||v(D,20,-20)||v(P,300,-300)||v(F,300,-300)||v(w,4396,3797)?s[3]=3:s[3]=2})}function v(e,t,n){return!!(Oe(e)||ge(e[e.length-1],t,n)==!1)}function Oe(e){let t=!1;return e.length>=2?t=e.every(n=>n===e[0])&&e[e.length-2]==e[e.length-1]:t=!0,t}function ge(e,t,n){return!(e<n||e>t)}function ie(){i(c,1);let e=setTimeout(()=>{I?f.send_message(u.MSP_SET_SPRAY,[1],!1,function(){X.showModal(),x()}):i(c,0)},200);r.push(e)}function H(){i(_,1);let e=setTimeout(()=>{U?f.send_message(u.MSP_SET_AUTO_PLAY_VOICE,[a.OVOBOT_FUNCTION.voiceIndex],!1,function(){Z.showModal(),x()}):i(_,0)},200);r.push(e)}function K(){i(d,1),f.send_message(u.MSP_FOURCORNER,!1,!1,function(){const e=A(a.ANALOG.corner,3)?0:1,t=A(a.ANALOG.corner,2)?0:1,n=A(a.ANALOG.corner,1)?0:1,N=A(a.ANALOG.corner,0)?0:1;if(a.ANALOG.corner==15&&(p[0]=[e,t,n,N]),a.ANALOG.corner==0&&(p[1]=[e,t,n,N]),a.CONFIG.isCollision==1){const M=A(a.ANALOG.hitCorner,3)?0:1,B=A(a.ANALOG.hitCorner,2)?0:1,q=A(a.ANALOG.hitCorner,1)?0:1,ne=A(a.ANALOG.hitCorner,0)?0:1;a.ANALOG.hitCorner==15&&(m[0]=[M,B,q,ne]),a.ANALOG.hitCorner==0&&(m[1]=[M,B,q,ne])}})}function A(e,t){return(e>>t&1)!=1}function i(e,t){if(e!=null)switch(t==0?e.find(".not-tested").removeClass("model-display"):e.find(".not-tested").addClass("model-display"),t==1?e.find(".under-testing").removeClass("model-display"):e.find(".under-testing").addClass("model-display"),t==2?e.find(".test-passed").removeClass("model-display"):e.find(".test-passed").addClass("model-display"),t==3?e.find(".test-failed").removeClass("model-display"):e.find(".test-failed").addClass("model-display"),t){case 0:e.find("a").removeClass("no-click");break;case 1:e.find("a").addClass("no-click");break;case 2:e.find("a").addClass("no-click");break;case 3:e.find("a").removeClass("no-click");break}}function ye(){r.forEach(e=>clearTimeout(e)),r=[]}function Ce(){s.includes(3)?(b.addClass("model-display"),k.removeClass("model-display"),L.addClass("model-display")):s.includes(1)||s.includes(0)?(b.removeClass("model-display"),L.addClass("model-display"),k.addClass("model-display")):(b.addClass("model-display"),L.removeClass("model-display"),k.addClass("model-display")),o.interval_remove("setup_auto_test_fast"),o.interval_remove("setup_auto_test_cliff_fast"),o.interval_add("setup_getRec_fast",ae,500,!0)}function ae(){f.callbacks=[],f.send_message(u.CMD_BUILD_INFO,!1,!1,function(e){Y==0&&(o.connected_to||Se(),Y=a.CONFIG.buildInfo,Y!=0&&(o.interval_remove("setup_getRec_fast"),Q.trigger("click")))})}function Te(){o.interval_add("setup_getRec_fast",ae,500,!0)}setTimeout(function(){Te()},100),o.content_ready(G)}};J.cleanup=function(G){G&&G()};he.auto_test=J;export{J as auto_test};
